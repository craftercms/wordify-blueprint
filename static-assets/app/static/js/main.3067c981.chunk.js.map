{"version":3,"sources":["shared/BaseLayout.js","shared/SearchForm.js","shared/contentTypeMap.js","../../../../../../../../../../studio-guest/utils/object.js","../../../../../../../../../../studio-guest/utils/string.js","../../../../../../../../../../studio-guest/utils/model.js","../../../../../../../../../../studio-guest/utils/communicator.js","../../../../../../../../../../studio-guest/constants.js","../../../../../../../../../../studio-guest/utils/array.js","../../../../../../../../../../studio-guest/utils/ice.js","../../../../../../../../../../studio-guest/utils/content.js","../../../../../../../../../../studio-guest/utils/contentType.js","../../../../../../../../../../studio-guest/classes/ContentController.js","../../../../../../../../../../studio-guest/utils/util.js","../../../../../../../../../../studio-guest/classes/ICERegistry.js","../../../../../../../../../../studio-guest/utils/dom.js","../../../../../../../../../../studio-guest/classes/ElementRegistry.js","../../../../../../../../../../studio-guest/react/GuestContext.js","../../../../../../../../../../studio-guest/react/CrafterCMSPortal.js","../../../../../../../../../../studio-guest/react/ZoneMarker.js","../../../../../../../../../../studio-guest/react/DropMarker.js","../../../../../../../../../../studio-guest/styles/palette.js","../../../../../../../../../../studio-guest/styles/stylesheet.js","../../../../../../../../../../studio-guest/styles/styles.js","../../../../../../../../../../studio-guest/react/AssetUploaderMask.js","../../../../../../../../../../studio-guest/store/util.js","../../../../../../../../../../studio-guest/store/subjects.js","../../../../../../../../../../studio-guest/controls/rte.js","../../../../../../../../../../studio-guest/store/epics/root.js","../../../../../../../../../../studio-guest/store/store.js","../../../../../../../../../../studio-guest/store/reducers/root.js","../../../../../../../../../../studio-guest/react/SnackBar.js","../../../../../../../../../../studio-guest/react/FieldInstanceSwitcher.js","../../../../../../../../../../studio-guest/react/Guest.js","../../../../../../../../../../studio-guest/react/Spinner.js","../../../../../../../../../../studio-guest/react/ContentType.js","../../../../../../../../../../studio-guest/react/hooks.js","../../../../../../../../../../studio-guest/react/Field.js","pages/NotFound.js","shared/DynamicRoute.js","shared/Router.js","shared/AppIntl.js","shared/App.js","index.js","shared/utils.js","shared/context.js","shared/hooks.js","fetchQuery.js","shared/queries.graphql.js","shared/CircularProgressSpinner.js","components/Header.js","components/Footer.js"],"names":["BaseLayout","model","children","useGlobalContext","theme","className","count","SearchForm","props","history","useHistory","placeholder","id","classes","Object","assign","form","input","inputWrapper","useSearchQuery","query","onChange","onSubmit","e","preventDefault","trim","push","type","value","map","lazy","nnou","object","notNullOrUndefined","nou","isNullOrUndefined","pluckProps","source","forEach","prop","reversePluckProps","key","includes","hasOwnProperty","retrieveProperty","split","reduce","setProperty","propToSet","pop","target","join","createLookupTable","list","idProp","table","item","removeLastPiece","str","splitChar","substr","lastIndexOf","popPiece","systemPropList","propName","fieldId","newValue","cleanFieldId","replace","undefined","extractCollection","index","extractCollectionPiece","extractCollectionItem","indexes","i","parseInt","fields","length","Error","Math","abs","getContentTypeId","_a","craftercms","contentTypeId","aux","field","useBroadcastChannel","window","parent","BroadcastChannel","console","warn","broadcastChannel","message$","fromEvent","pipe","filter","Boolean","data","share","meta","prepareAction","payload","post","postMessage","fromTopic","EditingStatus","HighlightMode","HOST_CHECK_IN","GUEST_CHECK_OUT","SORT_ITEM_OPERATION","INSERT_COMPONENT_OPERATION","INSERT_INSTANCE_OPERATION","MOVE_ITEM_OPERATION","DELETE_ITEM_OPERATION","UPDATE_FIELD_VALUE_OPERATION","CLEAR_SELECTED_ZONES","EDIT_MODE_CHANGED","HIGHLIGHT_MODE_CHANGED","ASSET_DRAG_STARTED","ASSET_DRAG_ENDED","COMPONENT_DRAG_STARTED","COMPONENT_DRAG_ENDED","TRASHED","INSTANCE_DRAG_ENDED","DESKTOP_ASSET_UPLOAD_COMPLETE","DESKTOP_ASSET_UPLOAD_PROGRESS","DESKTOP_ASSET_UPLOAD_STARTED","DESKTOP_ASSET_DRAG_STARTED","DESKTOP_ASSET_DRAG_ENDED","COMPONENT_INSTANCE_DRAG_STARTED","COMPONENT_INSTANCE_DRAG_ENDED","CONTENT_TYPE_DROP_TARGETS_REQUEST","CLEAR_HIGHLIGHTED_DROP_TARGETS","CONTENT_TREE_FIELD_SELECTED","CLEAR_CONTENT_TREE_FIELD_SELECTED","CONTENT_TREE_SWITCH_FIELD_INSTANCE","array","fn","emptyReturnValue","l","result","getParentModelId","modelId","models","Model","findParentModelId","childrenMap","parentId","entries","getCollectionWithoutItemAtIndex","collection","parsedIndex","slice","concat","getCollection","setCollection","fieldNames","a","b","toString","acc","cur","_model","_fieldId","Array","isArray","denormalizeModel","normalized","modelLookup","endsWith","isNodeSelector","isGroupItem","contentType","getField","contentTypes","accumulator","parsedFieldId","contentTypeWithTargetFieldId","validations","allowedContentTypes","find","ct","getDefaultValue","_b","_c","_d","_e","_f","_g","_h","_j","defaultValue","width","minWidth","height","minHeight","maxLength","text","loremIpsum","format","sentenceLowerBound","sentenceUpperBound","units","substring","crafterConf","getConfig","baseUrl","configure","location","hostname","origin","site","Cookies","get","operations$","Subject","asObservable","requestedPaths","paths$","BehaviorSubject","models$","contentTypes$","notEmpty","objects","keys","modelsObs$","contentTypesObs$","model$","pluck","getCachedModel","getCachedModels","byPathFetchIfNotLoaded","path","of","paths","tap","switchMap","take","fetchByPath","getContentInstanceByPath","getModelIdFromInheritedField","levelDescriptorPath","sourceMap","getCachedContentType","updateField","parentModelId","modelsToUpdate","parentModels","currentID","collectReferrers","fieldPieces","indexPieces","fieldPiece","indexPiece","next","args","systemProps","subscribe","modelIdByPath","X_AXIS","Y_AXIS","HORIZONTAL","VERTICAL","TOLERANCE_PERCENTS","x","y","DEFAULT_RECORD_DATA","not","condition","validationChecks","minCount","level","values","maxCount","allowedContentTypeTags","readOnly","required","maxWidth","maxHeight","rid","registry","Map","refCount","register","registration","contentTypeUtils","getReferentialEntries","name","exists","record","getById","entities","error","set","deregister","delete","getMediaDropTargets","dropTargets","getRecordDropTargets","getContentTypeDropTargets","contentController","rec","records","getRepeatGroupItemDropTargets","from","_contentType","acceptedTypes","runDropTargetsValidations","lookup","validationResult","validation","min","max","runValidation","iceId","validationId","isMovable","recordId","sortable","sibling","element","nextElementSibling","previousElementSibling","getDropMarkerPosition","arrangement","insertPosition","refElementRect","nextOrPrevRect","horizontal","before","nextRect","prevRect","difference","top","right","left","bottom","findClosestRect","parentRect","subRects","coordinates","distances","rect","p1","p2","stats","getInRectStats","inRect","sqrt","pow","indexOf","getChildArrangement","childrenRects","selfRect","topValue","marginTop","topValues","alignedTop","$","css","tolerancePercents","percents","getRelativePointerPositionPercentages","inRectTop","inRectRight","inRectBottom","inRectLeft","inInnerRectTop","inInnerRectRight","inInnerRectBottom","inInnerRectLeft","inInnerRect","mousePosition","isElementInView","fullyInView","pageTop","scrollTop","pageBottom","elementTop","offset","elementBottom","addAnimation","$element","animationClass","addClass","one","removeClass","scrollToElement","scrollElement","animate","updateDropZoneValidations","dropZone","dropZones","newDropZone","newDropZones","elementRecordId","getZoneMarkerStyle","padding","$window","scrollLeft","seq","db","label","labels","iceIds","iceRegistry","component","ContentType","setLabel","fieldIds","create","complete","inherited","some","isInheritedField","hasCachedModel","completeDeferredRegistration","splice","getDraggable","getHoverData","getBoundingClientRect","createIntermediateElementRecord","fromICEId","getRecordsFromIceId","recordsIds","getDropZoneFromRegistryEntry","elementRecord","child","compileDropZone","getHighlighted","getDragContextFromDropTargets","validationsLookup","currentRecord","response","siblings","players","containers","dropZonesFiltered","getElementFromICEProps","registryEntry","GuestReduxContext","React","createContext","useDispatch","createDispatchHook","useSelector","createSelectorHook","GuestContext","createStoreHook","useGuestContext","useContext","GuestContextProvider","useMemo","createElement","Provider","CrafterCMSPortal","portalRef","useRef","current","document","useLayoutEffect","body","portal","appendChild","removeChild","ReactDOM","createPortal","ZoneMarker","useState","zoneStyle","setZoneStyle","useEffect","style","class","marker","src","alt","DropMarker","over","prev","onDropPosition","r","targetIndex","setStyle","nextStyle","closestChildIndex","closestRect","closestChild","refElement","virtualRects","axis","rect1","rect2","half","splitRect","rectStats","findIndex","log","defaultProps","palette","white","black","blue","tint","main","shade","highlight","green","indigo","orange","pink","purple","red","teal","yellow","gray","light0","light1","light2","light3","light4","light5","light6","light7","medium1","medium2","medium3","medium4","medium5","medium6","medium7","dark1","dark2","dark3","dark4","dark5","dark6","dark7","defaults","styles","assetUploadMaskZIndex","assetUploadMaskBackgroundColor","dropMarkerZIndex","dropMarkerColor","snackBarZIndex","snackBarBackgroundColor","zoneLabelZIndex","zoneLabelTextColor","zoneLabelBackground","zoneMarkerZIndex","zoneMarkerOutlineColor","inlineTextEditorOutlineColor","inlineTextEditorFocusOutlineColor","validationMandatoryColor","validationSuggestedColor","collectRules","overrides","global","other","toBeReturned","allRules","rules","getAllGuestRules","rule","globalRule","globalRuleBody","appendStyleSheet","config","jss","setup","preset","sheet","createStyleSheet","cursor","zIndex","position","pointerEvents","background","opacity","display","transition","animation","boxSizing","outline","outlineOffset","textAlign","color","borderRadius","justifyContent","alignItems","fontSize","marginLeft","overflow","fontWeight","boxShadow","content","visibility","border","flexGrow","flexWrap","fontFamily","lineHeight","backgroundColor","transform","whiteSpace","textOverflow","fill","flexShrink","userSelect","outlineColor","stroke","strokeDasharray","strokeDashoffset","to","stylesheet","attach","AssetUploaderMask","progress","dragOk","status","SORTING_COMPONENT","PLACING_NEW_COMPONENT","PLACING_DETACHED_ASSET","PLACING_DETACHED_COMPONENT","UPLOAD_ASSET_FROM_DESKTOP","unwrapEvent","event","originalEvent","nativeEvent","dragover$","killSignal$","scrolling$","clearAndListen$","escape$","active","initializeDragSubjects","state$","takeUntil","merge","throttleTime","withLatestFrom","dragContext","scrolling","debounceTime","initTinyMCE","dispatch$","plugins","elementDisplay","tinymce","init","mode","paste_as_text","toolbar","menubar","inline","base_url","suffix","editor","on","changed","originalContent","getContent","cancel","destroy","html","unsubscribe","focus","selection","select","getBody","collapse","relatedTarget","setContent","save","stopImmediatePropagation","once","fire","test","String","fromCharCode","keyCode","stopPropagation","startWith","store","epic","combineEpics","apply","action$","ofType","LISTENING","ignoreElements","action","state","draggable","dataTransfer","setData","image","querySelector","setDragImage","NEVER","aImg","invalidDrop","inZone","dragged","moveComponent","setTimeout","shared","instance","uuid","dateCreated","dateModified","locale","processFields","file","files","stream$","reader","FileReader","onload","dataUrl","readAsDataURL","ElementRegistry","iceZoneSelected","highlightMode","ALL","alert","isStringIndex","arguments","mapTo","iceProps","scrollToIceProps","fieldSwitcher","registryEntryIds","currentElement","draggedElementIndex","originDropZone","currentDZ","containerRecord","currentIndex","currentIndexParsed","targetIndexParsed","originalModelId","originalFieldId","originalIndex","targetModelId","targetFieldId","originalIndexParsed","symmetricOriginal","symmetricTarget","currentModel","currentCollection","currentResult","targetModel","targetResult","newOriginalModel","newTargetModel","getFieldItem","originalParentModelId","targetParentModelId","set_edit_mode","editMode","initialState","editable","highlighted","ICE_GUEST_INIT","uploading","hostCheckedIn","foo","reducerFunctions","computed_dragend","computed_dragover","nextSibling","prevSibling","clientX","clientY","dz","dblclick","EDITING_COMPONENT_INLINE","dragend","dragleave","leavingDropZone","contains","dragover","dragstart","drop","set_drop_position","edit_component_inline","exit_component_inline_edit","ice_zone_selected","EDITING_COMPONENT","insert_component","insert_instance","mouseleave","mouseover","nextState","MOVABLE","move_component","start_listening","add_asset_types","click","scrolling_stopped","drop_zone_enter","currentDropZones","currentDropZone","rest","drop_zone_leave","SHOW_DROP_TARGETS","percentage","asset","mimeType","registryEntries","SELECT_FIELD","entry","nextElem","createReducer","createGuestStore","epicMiddleware","createEpicMiddleware","middleware","getDefaultMiddleware","thunk","serializableCheck","immutableCheck","configureStore","reducer","devTools","run","Observable","subscriber","getState","distinctUntilChanged","SnackBar","open","duration","message","onClose","onCloseRef","timeoutRef","clearTimeout","FieldInstanceSwitcher","onNext","onPrev","onClick","focusable","viewBox","d","initialDocumentDomain","domain","editModeClass","Guest","styleConfig","documentDomain","snack","setSnack","dispatch","hasHost","refs","contentReady","firstRender","keysPressed","context","onEvent","dispatcherElementRecordId","elementRegistry","z","keydown","keyup","addEventListener","removeEventListener","dispatchEvent","CustomEvent","detail","reload","detach","sub","href","url","getElementRegistry","scrollToDropTargets","interval","script","head","handler","subscription","types","items","dropSubscription","dragoverSubscription","dragleaveSubscription","dragContextDropZoneIceId","dragContextDropZoneElementRecordId","draggableItemElemRecId","Reastate","highlightedct","CrafterCMSGuest","isAuthoring","Spinner","xmlns","circleClassName","strokeWidth","strokeLinecap","strokeLineCap","cx","cy","NotFoundDefault","NotDevelopedDefault","contentTypeMap","notMappedComponent","NotDeveloped","notFoundComponent","NotFound","__rest","Component","handlerMap","useICE","inAuthoring","elementRef","elementRegistryId","setModel","s","useHotReloadModel","ref","node","isDraggable","persist","call","noRef","onMouseOver","onMouseLeave","onDragStart","onDragOver","onDragLeave","onDrop","onDragEnd","onDoubleClick","bypassICE","Field","modelProp","ice","passDownProps","RenderField","renderTarget","getModelValue","levelDescriptor","DynamicRoute","match","setState","destroyed","page","parse","search","pagination","limit","fetchQuery","byUrlQuery","includePosts","postsLimit","postsOffset","then","parseDescriptor","levelDescriptors","file__name","disqus","websiteShortname","websiteShortname_s","posts","total","title","pageTitle_s","pageDescription_s","description","setAttribute","scroll","CircularProgressSpinner","Router","Locales","en","es","AppIntl","messages","App","fallback","siteName","render","StrictMode","getElementById","attr","documentElement","getAttribute","createResource","factory","suspender","read","innerHTML","crafterConfig","process","createTaxonomyFilter","taxonomy","GlobalContext","GlobalContextProvider","useSpreadState","pages","pagesLoading","neverResource","Promise","initializerArg","initializer","useReducer","useNavigation","update","destroyedRef","useLocation","q","setQuery","p","setPage","useCallback","useUrlSearchQueryFetchResource","size","resource","setResource","createQuery","hits","counted","parsedHits","_source","preParseSearchResults","toPromise","useFooter","footer","footerLoading","component_footer","useRecentPosts","postsLoading","postsQuery","usePosts","paginationData","categories","tags","exclude","setPosts","categoriesFilter","category","matches","tagsFilter","tag","itemsPerPage","currentPage","pageCount","ceil","useTaxonomiesResource","graphqlServer","operation","variables","fetch","method","headers","JSON","stringify","json","commonFragments","screenHeight","strokeMiterlimit","Header","nav","showMobileMenu","setShowMobileMenu","role","socialLinks","link","socialNetwork_s","rel","url_s","data-toggle","aria-expanded","aria-controls","Link","sort","orderDefault_f","exact","activeClassName","navLabel","Footer","quickLinks_o","label_s","dangerouslySetInnerHTML","__html","copyright_html_raw"],"mappings":"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","file":"static/js/main.3067c981.chunk.js","sourcesContent":["/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport Header from '../components/Header';\nimport Footer from '../components/Footer';\nimport React from 'react';\nimport { useGlobalContext } from './context';\n\nexport default function BaseLayout({ model, children }) {\n  const [{ theme }] = useGlobalContext();\n  return (\n    <div className={`wrap theme-${theme}`}>\n      <Header model={model} />\n      <div className=\"wrap\">\n        {children}\n      </div>\n      <Footer model={model} />\n    </div>\n  );\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport React from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { useSearchQuery } from './hooks';\n\nlet count = 0;\n\nfunction SearchForm(props) {\n  const history = useHistory();\n  const { placeholder = '', id = `searchInput_${count++}` } = props;\n  const classes = Object.assign({\n    form: '',\n    input: '',\n    inputWrapper: ''\n  }, props.classes);\n  const [query, onChange] = useSearchQuery();\n  return (\n    <form\n      className={classes.form}\n      onSubmit={(e) => {\n        e.preventDefault();\n        query.trim() && history.push(`/search?q=${query}`);\n      }}\n    >\n      <div className={classes.inputWrapper}>\n        <span className=\"icon fa fa-search\" />\n        <input\n          id={id}\n          type=\"text\"\n          value={query}\n          onChange={onChange}\n          className={classes.input}\n          placeholder={placeholder}\n        />\n      </div>\n    </form>\n  );\n}\n\nexport default SearchForm;\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { lazy } from 'react';\n\nconst map = {\n  '/page/entry': lazy(() => import('../pages/Home')),\n  '/page/about': lazy(() => import('../pages/About')),\n  '/page/contact': lazy(() => import('../pages/Contact')),\n  '/page/category': lazy(() => import('../pages/Category')),\n  '/page/search': lazy(() => import('../pages/Search')),\n  '/component/header': lazy(() => import('../components/Header')),\n  '/component/footer': lazy(() => import('../components/Footer')),\n  '/component/bio': lazy(() => import('../components/Bio')),\n  '/component/image': lazy(() => import('../components/Image')),\n  '/component/responsive_columns': lazy(() => import('../components/ResponsiveColumns')),\n  '/component/rich_text': lazy(() => import('../components/RichText')),\n  '/component/slider': lazy(() => import('../components/Slider')),\n  '/component/post': lazy(() => import('../pages/Post'))\n};\n\nexport default map;","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n// Not Null Or Undefined (nnou)\nexport function nnou(object) {\n    return object != null;\n}\nexport const notNullOrUndefined = nnou;\nexport function nou(value) {\n    return value == null;\n}\nexport const isNullOrUndefined = nou;\nexport function pluckProps(source, ...props) {\n    const object = {};\n    if (isNullOrUndefined(source)) {\n        return object;\n    }\n    props.forEach((prop) => {\n        if (notNullOrUndefined(source[prop])) {\n            object[prop] = source[prop];\n        }\n    });\n    return object;\n}\nexport function reversePluckProps(source, ...props) {\n    const object = {};\n    if (isNullOrUndefined(source)) {\n        return object;\n    }\n    for (let key in source) {\n        // @ts-ignore\n        if (!props.includes(key) && source.hasOwnProperty(key)) {\n            // @ts-ignore\n            object[key] = source[key];\n        }\n    }\n    return object;\n}\nexport function retrieveProperty(object, prop) {\n    return object == null ? null : !prop ? object : prop.split('.').reduce((value, prop) => value[prop], object);\n}\nexport function deleteProperty(object, prop) {\n    delete object[prop];\n    return object;\n}\nexport function setProperty(object, prop, value) {\n    if (object) {\n        const props = prop.split('.');\n        const propToSet = props.pop();\n        let target = retrieveProperty(object, props.join('.'));\n        if (!target) {\n            setProperty(object, props.join('.'), {});\n            target = retrieveProperty(object, props.join('.'));\n        }\n        target[propToSet] = value;\n    }\n    return object;\n}\nexport function createLookupTable(list, idProp = 'id') {\n    const table = {};\n    list.forEach((item) => {\n        table[retrieveProperty(item, idProp)] = item;\n    });\n    return table;\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nexport function capitalize(str) {\n    return `${str.charAt(0).toUpperCase()}${str.substr(1)}`;\n}\nexport function removeLastPiece(str, splitChar = '.') {\n    return str.substr(0, str.lastIndexOf(splitChar));\n}\nexport function popPiece(str, splitChar = '.') {\n    return str.substr(str.lastIndexOf(splitChar) + 1);\n}\nexport function isBlank(str) {\n    return str === '';\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { isNullOrUndefined, retrieveProperty, setProperty } from './object';\nimport { removeLastPiece } from './string';\nconst systemPropList = ['id', 'path', 'contentTypeId', 'dateCreated', 'dateModified', 'label'];\nexport function prop(model, propName) {\n    if (model == null) {\n        return null;\n    }\n    else if (systemPropList.includes(propName)) {\n        propName = `craftercms.${propName}`;\n    }\n    return retrieveProperty(model, propName);\n}\nexport function value(model, fieldId, newValue) {\n    // TODO: GraphQL transforms names as left-rail_o to left__rail_o.\n    // This transform is potentially unreliable. We should discuss approach.\n    const cleanFieldId = fieldId.replace(/-/g, '__');\n    if (cleanFieldId !== fieldId && retrieveProperty(model, cleanFieldId)) {\n        fieldId = cleanFieldId;\n    }\n    if (newValue !== undefined) {\n        setProperty(model, fieldId, newValue);\n    }\n    return retrieveProperty(model, fieldId);\n}\nexport function extractCollection(model, fieldId, index) {\n    return extractCollectionPiece(model, fieldId, removeLastPiece(`${index}`));\n}\nexport function extractCollectionItem(model, fieldId, index) {\n    const indexes = index === '' || isNullOrUndefined(index) ? [] : `${index}`.split('.').map((i) => parseInt(i));\n    const fields = fieldId.split('.');\n    if (indexes.length > fields.length) {\n        throw new Error('[ModelHelper.extractCollectionItem] The number of indexes surpasses the number ' +\n            `of nested properties on model id \"${prop(model, 'id')}\", field id \"${fieldId}\". ` +\n            `Supplied index path was ${index}. `);\n    }\n    if (Math.abs(indexes.length - fields.length) > 1) {\n        throw new Error('[extractCollectionItem] The number of indexes and number of nested props mismatch ' +\n            `by more than 1 on \"${prop(model, 'id')}\", field id \"${fieldId}\". ` +\n            `Supplied index path was ${index}. Number of nested props may be greater by no more than one ` +\n            'than the number of nested indexes.');\n    }\n    return extractCollectionPiece(model, fieldId, index);\n}\nexport function getContentTypeId(model) {\n    var _a;\n    return (_a = model === null || model === void 0 ? void 0 : model.craftercms) === null || _a === void 0 ? void 0 : _a.contentTypeId;\n}\nexport function isEmbedded(model) {\n    return isNullOrUndefined(prop(model, 'path'));\n}\nfunction extractCollectionPiece(model, fieldId, index) {\n    const indexes = index === '' || isNullOrUndefined(index) ? [] : `${index}`.split('.').map((i) => parseInt(i, 10));\n    if (indexes.length === 0) {\n        return retrieveProperty(model, fieldId);\n    }\n    const fields = fieldId.split('.');\n    let aux = model;\n    if (indexes.length > fields.length) {\n        // There's more indexes than fields\n        throw new Error('[content/extractNode] Path not handled: indexes.length > fields.length. Indexes ' +\n            `is ${indexes} and fields is ${fields}`);\n    }\n    indexes.forEach((index, i) => {\n        const field = fields[i];\n        aux = aux[field][index];\n    });\n    if (indexes.length === fields.length) {\n        // @ts-ignore TODO: Fix type\n        return aux;\n    }\n    else if (indexes.length < fields.length) {\n        // There's one more field to use as there were less indexes\n        // than there were fields. For example: fieldId: `items_o.content_o`, index: 0\n        // At this point, aux would be `items_o[0]` and we need to extract `content_o`\n        const field = fields[fields.length - 1];\n        return aux[field];\n    }\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { fromEvent } from 'rxjs';\nimport { filter, map, share } from 'rxjs/operators';\nconst useBroadcastChannel = window.parent === window && window.BroadcastChannel !== undefined;\nif (window.parent === window && window.BroadcastChannel === undefined) {\n    console.warn(`Browser does not support BroadcastChannel API. Communication with host will be impaired.`);\n}\nconst broadcastChannel = useBroadcastChannel ? new BroadcastChannel('org.craftercms.accommodationChannel') : null;\nexport const message$ = fromEvent(useBroadcastChannel ? broadcastChannel : window, 'message').pipe(filter((e) => { var _a; return Boolean((_a = e.data) === null || _a === void 0 ? void 0 : _a.type); }), map((e) => e.data), share());\nconst meta = { craftercms: true, source: 'guest' };\nconst prepareAction = (type, payload) => (typeof type === 'object' ? Object.assign(Object.assign({}, type), { meta }) : { type, payload, meta });\nexport const post = useBroadcastChannel\n    ? (type, payload) => broadcastChannel.postMessage(prepareAction(type, payload))\n    : (type, payload) => window.parent.postMessage(prepareAction(type, payload), '*');\nexport function fromTopic(type) {\n    return message$.pipe(filter((e) => e.type === type));\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n// region Accommodation Actions\n// To be moved to a common file for sharing across apps\nexport const HOST_CHECK_IN = 'HOST_CHECK_IN';\nexport const GUEST_CHECK_IN = 'GUEST_CHECK_IN';\nexport const GUEST_CHECK_OUT = 'GUEST_CHECK_OUT';\nexport const SORT_ITEM_OPERATION = 'SORT_ITEM_OPERATION';\nexport const INSERT_COMPONENT_OPERATION = 'INSERT_COMPONENT_OPERATION';\nexport const INSERT_INSTANCE_OPERATION = 'INSERT_INSTANCE_OPERATION';\nexport const INSERT_ITEM_OPERATION = 'INSERT_ITEM_OPERATION';\nexport const MOVE_ITEM_OPERATION = 'MOVE_ITEM_OPERATION';\nexport const DELETE_ITEM_OPERATION = 'DELETE_ITEM_OPERATION';\nexport const UPDATE_FIELD_VALUE_OPERATION = 'UPDATE_FIELD_VALUE_OPERATION';\nexport const ICE_ZONE_SELECTED = 'ICE_ZONE_SELECTED';\nexport const CLEAR_SELECTED_ZONES = 'CLEAR_SELECTED_ZONES';\nexport const EDIT_MODE_CHANGED = 'EDIT_MODE_CHANGED';\nexport const HIGHLIGHT_MODE_CHANGED = 'HIGHLIGHT_MODE_CHANGED';\nexport const ASSET_DRAG_STARTED = 'ASSET_DRAG_STARTED';\nexport const ASSET_DRAG_ENDED = 'ASSET_DRAG_ENDED';\nexport const COMPONENT_DRAG_STARTED = 'COMPONENT_DRAG_STARTED';\nexport const COMPONENT_DRAG_ENDED = 'COMPONENT_DRAG_ENDED';\nexport const TRASHED = 'TRASHED';\nexport const CONTENT_TYPES_REQUEST = 'CONTENT_TYPES_REQUEST';\nexport const CONTENT_TYPES_RESPONSE = 'CONTENT_TYPES_RESPONSE';\nexport const INSTANCE_DRAG_BEGUN = 'INSTANCE_DRAG_BEGUN';\nexport const INSTANCE_DRAG_ENDED = 'INSTANCE_DRAG_ENDED';\nexport const GUEST_MODELS_RECEIVED = 'GUEST_MODELS_RECEIVED';\nexport const NAVIGATION_REQUEST = 'NAVIGATION_REQUEST';\nexport const RELOAD_REQUEST = 'RELOAD_REQUEST';\nexport const DESKTOP_ASSET_DROP = 'DESKTOP_ASSET_DROP';\nexport const DESKTOP_ASSET_UPLOAD_COMPLETE = 'DESKTOP_ASSET_UPLOAD_COMPLETE';\nexport const DESKTOP_ASSET_UPLOAD_PROGRESS = 'DESKTOP_ASSET_UPLOAD_PROGRESS';\nexport const DESKTOP_ASSET_UPLOAD_STARTED = 'DESKTOP_ASSET_UPLOAD_STARTED';\nexport const DESKTOP_ASSET_DRAG_STARTED = 'DESKTOP_ASSET_DRAG_STARTED';\nexport const DESKTOP_ASSET_DRAG_ENDED = 'DESKTOP_ASSET_DRAG_ENDED';\nexport const COMPONENT_INSTANCE_DRAG_STARTED = 'COMPONENT_INSTANCE_DRAG_STARTED';\nexport const COMPONENT_INSTANCE_DRAG_ENDED = 'COMPONENT_INSTANCE_DRAG_ENDED';\nexport const COMPONENT_INSTANCE_HTML_REQUEST = 'COMPONENT_INSTANCE_HTML_REQUEST';\nexport const COMPONENT_INSTANCE_HTML_RESPONSE = 'COMPONENT_INSTANCE_HTML_RESPONSE';\nexport const CONTENT_TYPE_DROP_TARGETS_REQUEST = 'CONTENT_TYPE_DROP_TARGETS_REQUEST';\nexport const CONTENT_TYPE_DROP_TARGETS_RESPONSE = 'CONTENT_TYPE_DROP_TARGETS_RESPONSE';\nexport const SCROLL_TO_DROP_TARGET = 'SCROLL_TO_DROP_TARGET';\nexport const CLEAR_HIGHLIGHTED_DROP_TARGETS = 'CLEAR_HIGHLIGHTED_DROP_TARGETS';\nexport const CONTENT_TREE_FIELD_SELECTED = 'CONTENT_TREE_FIELD_SELECTED';\nexport const CLEAR_CONTENT_TREE_FIELD_SELECTED = 'CLEAR_CONTENT_TREE_FIELD_SELECTED';\nexport const CHILDREN_MAP_UPDATE = 'CHILDREN_MAP_UPDATE';\nexport const CONTENT_TREE_SWITCH_FIELD_INSTANCE = 'CONTENT_TREE_SWITCH_FIELD_INSTANCE';\n// endregion\nexport var EditingStatus;\n(function (EditingStatus) {\n    EditingStatus[\"LISTENING\"] = \"LISTENING\";\n    EditingStatus[\"SORTING_COMPONENT\"] = \"SORTING_COMPONENT\";\n    EditingStatus[\"PLACING_NEW_COMPONENT\"] = \"PLACING_NEW_COMPONENT\";\n    EditingStatus[\"PLACING_DETACHED_COMPONENT\"] = \"PLACING_DETACHED_COMPONENT\";\n    EditingStatus[\"PLACING_DETACHED_ASSET\"] = \"PLACING_DETACHED_ASSET\";\n    EditingStatus[\"EDITING_COMPONENT\"] = \"EDITING_COMPONENT\";\n    EditingStatus[\"EDITING_COMPONENT_INLINE\"] = \"EDITING_COMPONENT_INLINE\";\n    EditingStatus[\"UPLOAD_ASSET_FROM_DESKTOP\"] = \"UPLOAD_ASSET_FROM_DESKTOP\";\n    EditingStatus[\"SHOW_DROP_TARGETS\"] = \"SHOW_DROP_TARGETS\";\n    EditingStatus[\"SELECT_FIELD\"] = \"SELECT_FIELD\";\n})(EditingStatus || (EditingStatus = {}));\nexport var HighlightMode;\n(function (HighlightMode) {\n    HighlightMode[\"ALL\"] = \"ALL\";\n    HighlightMode[\"MOVABLE\"] = \"MOVABLE\";\n})(HighlightMode || (HighlightMode = {}));\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { notNullOrUndefined } from './object';\nexport function forEach(array, fn, emptyReturnValue) {\n    if (notNullOrUndefined(emptyReturnValue) && array.length === 0) {\n        return emptyReturnValue;\n    }\n    for (let i = 0, l = array.length; i < l; i++) {\n        const result = fn(array[i], i, array);\n        if (result !== 'continue') {\n            if (result === 'break') {\n                break;\n            }\n            else if (result !== undefined) {\n                return result;\n            }\n        }\n    }\n    return emptyReturnValue;\n}\n/**\n * Receives two different arrays of string, it will combine it selecting one string of the first array\n * and then other string of the second array, until there are no more strings\n * @param a\n * @param b\n */\nexport function mergeArraysAlternatively(a, b) {\n    return (a.length > b.length ? a : b).reduce((acc, cur, i) => (a[i] && b[i] ? [...acc, a[i], b[i]] : [...acc, cur]), []);\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { isNullOrUndefined, notNullOrUndefined } from './object';\nimport * as Model from './model';\nimport { forEach, mergeArraysAlternatively } from './array';\nimport { popPiece } from './string';\nexport function findComponentContainerFields(fields) {\n    if (!Array.isArray(fields)) {\n        fields = Object.values(fields);\n    }\n    return fields.filter((field) => {\n        if (field.type === 'node-selector') {\n            return true;\n        }\n        else if (field.type === 'repeat') {\n            // TODO Should repeats be considered containers?\n            return false;\n        }\n        else {\n            return false;\n        }\n    });\n}\nexport function getParentModelId(modelId, models, children) {\n    return isNullOrUndefined(Model.prop(models[modelId], 'path')) ? findParentModelId(modelId, children, models) : null;\n}\nfunction findParentModelId(modelId, childrenMap, models) {\n    const parentId = forEach(Object.entries(childrenMap), ([id, children]) => {\n        if (notNullOrUndefined(children) && id !== modelId && children.includes(modelId)) {\n            return id;\n        }\n    }, null);\n    return notNullOrUndefined(parentId)\n        ? // If it has a path, it is not embedded and hence the parent\n            // Otherwise, need to keep looking.\n            notNullOrUndefined(Model.prop(models[parentId], 'path'))\n                ? parentId\n                : findParentModelId(parentId, childrenMap, models)\n        : // No parent found for this model\n            null;\n}\nexport function getCollectionWithoutItemAtIndex(collection, index) {\n    const parsedIndex = parseInt(popPiece(`${index}`), 10);\n    return collection.slice(0, parsedIndex).concat(collection.slice(parsedIndex + 1));\n}\nexport function getCollection(model, fieldId, index) {\n    const isStringIndex = typeof index === 'string';\n    return isStringIndex ? Model.extractCollection(model, fieldId, index) : Model.value(model, fieldId);\n}\nexport function setCollection(model, fieldId, index, collection) {\n    if (fieldId.includes('.')) {\n        const concatFieldId = mergeArraysAlternatively(fieldId.split('.'), index.toString().split('.')).join('.');\n        const fieldNames = concatFieldId.split('.');\n        const { length } = fieldNames;\n        const _model = Object.assign({}, model);\n        fieldNames.reduce((acc, _fieldId, i) => {\n            if (i === length) {\n                acc[_fieldId] = collection;\n            }\n            return (acc[_fieldId] = Array.isArray(acc[_fieldId]) ? [...acc[_fieldId]] : Object.assign({}, acc[_fieldId]));\n        }, _model);\n        return _model;\n    }\n    else {\n        return Object.assign(Object.assign({}, model), { [fieldId]: collection });\n    }\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { forEach } from './array';\nexport function modelsToLookup(models) {\n    const lookup = {};\n    models.forEach((model) => {\n        modelsToLookupModelParser(model, lookup);\n    });\n    return lookup;\n}\nfunction modelsToLookupModelParser(model, lookup) {\n    if ('craftercms' in model) {\n        if (model.craftercms.id === null) {\n            // e.g. In editorial, related-articles-widget (some\n            // items can use key/value without being \"includes\")\n            // it may simply be a key/value pair. This is an issue\n            // of the parseDescriptor function of the @craftercms/content package\n            //   <scripts_o item-list=\"true\">\n            //     <item>\n            //       <key>/scripts/components/related-articles.groovy</key>\n            //       <value>related-articles.groovy</value>\n            //     </item>\n            //   </scripts_o>\n            return;\n        }\n        lookup[model.craftercms.id] = model;\n    }\n    Object.entries(model).forEach(([prop, value]) => {\n        if (prop.endsWith('_o')) {\n            const collection = value;\n            forEach(collection, (item) => {\n                if ('craftercms' in item) {\n                    if (item.craftercms.id === null) {\n                        return 'continue';\n                    }\n                    // Add model to lookup table\n                    lookup[item.craftercms.id] = item;\n                }\n                modelsToLookupModelParser(item, lookup);\n            });\n        }\n    });\n}\nexport function normalizeModelsLookup(models) {\n    const lookup = {};\n    Object.entries(models).forEach(([id, model]) => {\n        lookup[id] = normalizeModel(model);\n    });\n    return lookup;\n}\nexport function normalizeModel(model) {\n    const normalized = Object.assign({}, model);\n    Object.entries(model).forEach(([prop, value]) => {\n        var _a, _b;\n        if (prop.endsWith('_o')) {\n            const collection = value;\n            if (collection.length) {\n                const isNodeSelector = Boolean((_b = (_a = collection[0]) === null || _a === void 0 ? void 0 : _a.craftercms) === null || _b === void 0 ? void 0 : _b.id);\n                if (isNodeSelector) {\n                    normalized[prop] = collection.map((item) => item.craftercms.id);\n                }\n                else {\n                    normalized[prop] = collection.map((item) => normalizeModel(item));\n                }\n            }\n        }\n    });\n    return normalized;\n}\nexport function denormalizeModel(normalized, modelLookup) {\n    const model = Object.assign({}, normalized);\n    Object.entries(model).forEach(([prop, value]) => {\n        if (prop.endsWith('_o')) {\n            const collection = value;\n            if (collection.length) {\n                const isNodeSelector = typeof collection[0] === 'string';\n                if (isNodeSelector) {\n                    model[prop] = collection.map((item) => denormalizeModel(modelLookup[item], modelLookup));\n                }\n                else {\n                    model[prop] = collection.map((item) => denormalizeModel(item, modelLookup));\n                }\n            }\n        }\n    });\n    return model;\n}\n/**\n * Creates a list with the ids of all the direct descendant child models\n * @param model {ContentInstance} The model to extract child ids from\n */\nexport function createChildModelIdList(model) {\n    const children = [];\n    Object.entries(model).forEach(([prop, value]) => {\n        if (prop.endsWith('_o') && Array.isArray(value)) {\n            const collection = value;\n            forEach(collection, (item) => {\n                if ('craftercms' in item && item.craftercms.id !== null) {\n                    // Node selector\n                    children.push(item.craftercms.id);\n                }\n                else {\n                    // Repeating group item\n                    forEach(Object.entries(item), ([_prop, _value]) => {\n                        if (_prop.endsWith('_o') && Array.isArray(_value)) {\n                            const _collection = _value;\n                            forEach(_collection, (_item) => {\n                                if ('craftercms' in _item && _item.craftercms.id !== null) {\n                                    children.push(_item.craftercms.id);\n                                }\n                                else {\n                                    // Not a node selector, no point to continue iterating\n                                    // Subsequent levels are calculated by calling this function\n                                    // with that model as the argument\n                                    return 'break';\n                                }\n                            });\n                        }\n                    });\n                }\n            });\n        }\n    });\n    return children;\n}\nexport function createPathIdMap(models) {\n    const map = {};\n    Object.entries(models).forEach(([id, model]) => {\n        if (model.craftercms.path) {\n            map[model.craftercms.path] = id;\n        }\n    });\n    return map;\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { createLookupTable } from './object';\nimport { loremIpsum } from 'lorem-ipsum';\nexport function getRelatedContentTypeIds(contentType) {\n    return Object.values(contentType.fields).reduce((accumulator, field) => {\n        if (field.type === 'array' &&\n            field.validations != null &&\n            'validations' in field &&\n            'allowedContentTypes' in field.validations) {\n            field.validations.allowedContentTypes.value.forEach((ctid) => !accumulator.includes(ctid) && accumulator.push(ctid));\n        }\n        return accumulator;\n    }, []);\n}\nexport function isGroupItem(contentType, fieldId) {\n    return fieldId.includes('.');\n}\nexport function isComponentHolder(contentType, fieldId) {\n    return getField(contentType, fieldId).type === 'node-selector';\n}\nexport function isGroup(contentType, fieldId) {\n    return getField(contentType, fieldId).type === 'repeat';\n}\nexport function doesFieldAccept(contentType, fieldId) {\n    // const field = getField(contentType, fieldId);\n    throw new Error('Not implemented.');\n}\nexport function getField(type, fieldId, contentTypes) {\n    const fields = fieldId.split('.');\n    let accumulator = Array.isArray(type.fields) ? createLookupTable(type.fields) : type.fields;\n    let parsedFieldId = [];\n    fields.forEach((field) => {\n        parsedFieldId.push(field);\n        if (accumulator.type === 'node-selector') {\n            if (!contentTypes) {\n                throw new Error(`Content types not provided to content type helper \\`getField\\` method. ` +\n                    `Unable to retrieve the field \\`${fieldId}\\` without full list of content types.`);\n            }\n            const contentTypeWithTargetFieldId = accumulator.validations.allowedContentTypes.value.find((ct) => Boolean(contentTypes[ct].fields[field]));\n            accumulator = contentTypes[contentTypeWithTargetFieldId].fields[field];\n        }\n        else {\n            if (accumulator.type === 'repeat') {\n                // For repeat groups, the field inside the repeat group field will be\n                // under {repeatName}.fields.{fieldName}. To abstract this complexity from devs\n                // we parse it here.\n                accumulator = accumulator.fields[field];\n            }\n            else {\n                accumulator = accumulator[field];\n            }\n        }\n    });\n    return accumulator;\n}\nexport function getFields(type, ...ids) {\n    return ids.map((id) => getField(type, id));\n}\nexport function getFieldsByType(contentType, fieldType) {\n    return Object.values(contentType.fields).filter((field) => field.type === fieldType);\n}\nexport function getDefaultValue(field) {\n    var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n    if (field.defaultValue) {\n        return field.defaultValue;\n    }\n    else {\n        switch (field.type) {\n            case 'image':\n                const width = (_d = (_b = (_a = field.validations.width) === null || _a === void 0 ? void 0 : _a.value) !== null && _b !== void 0 ? _b : (_c = field.validations.minWidth) === null || _c === void 0 ? void 0 : _c.value) !== null && _d !== void 0 ? _d : 150;\n                const height = (_h = (_f = (_e = field.validations.height) === null || _e === void 0 ? void 0 : _e.value) !== null && _f !== void 0 ? _f : (_g = field.validations.minHeight) === null || _g === void 0 ? void 0 : _g.value) !== null && _h !== void 0 ? _h : width;\n                return `https://via.placeholder.com/${width}x${height}`;\n            case 'text':\n            case 'html':\n            case 'textarea':\n                const maxLength = (_j = field.validations.maxLength) === null || _j === void 0 ? void 0 : _j.value;\n                let text = loremIpsum({\n                    count: 1,\n                    format: 'plain',\n                    sentenceLowerBound: 4,\n                    sentenceUpperBound: 4,\n                    units: 'sentences'\n                });\n                maxLength && text.substring(0, maxLength);\n                return text;\n            case 'boolean':\n                return 'false';\n        }\n    }\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { BehaviorSubject, of, Subject } from 'rxjs';\nimport { filter, map, pluck, switchMap, take, tap } from 'rxjs/operators';\nimport * as Model from '../utils/model';\nimport Cookies from 'js-cookie';\nimport { fromTopic, post } from '../utils/communicator';\nimport uuid from 'uuid/v4';\nimport { CONTENT_TYPES_RESPONSE, DELETE_ITEM_OPERATION, INSERT_COMPONENT_OPERATION, INSERT_INSTANCE_OPERATION, INSERT_ITEM_OPERATION, MOVE_ITEM_OPERATION, SORT_ITEM_OPERATION, UPDATE_FIELD_VALUE_OPERATION } from '../constants';\nimport { createLookupTable, nnou, nou } from '../utils/object';\nimport { popPiece, removeLastPiece } from '../utils/string';\nimport { getCollection, getCollectionWithoutItemAtIndex, getParentModelId, setCollection } from '../utils/ice';\nimport { createQuery, search } from '@craftercms/search';\nimport { parseDescriptor, preParseSearchResults } from '@craftercms/content';\nimport { modelsToLookup } from '../utils/content';\nimport { crafterConf } from '@craftercms/classes';\nimport { getDefaultValue } from '../utils/contentType';\n// if (process.env.NODE_ENV === 'development') {\n// TODO: Notice\n// Not so sure about this assumption. Maybe best to just leave it up to the consumer\n// app to set the crafter URL via `crafterConf` if it wants something different?\ncrafterConf.getConfig().baseUrl === '' &&\n    crafterConf.configure({\n        baseUrl: window.location.hostname === 'localhost' ? 'http://localhost:8080' : window.location.origin,\n        site: Cookies.get('crafterSite')\n    });\n// }\nconst operations$ = new Subject();\nconst operationsObs$ = operations$.asObservable();\nexport const children = {\n/* [id]: [id, id, id] */\n};\nlet requestedPaths = {};\nconst paths$ = new BehaviorSubject({\n/* 'path': 'modelId' */\n});\nconst models$ = new BehaviorSubject({\n/* 'modelId': { ...modelData } */\n});\nconst contentTypes$ = new BehaviorSubject({\n/* 'contentTypeId': { ...contentTypeData } */\n});\n// Share operator makes the behaviour subject's behaviour go away. New subscribers\n// don't receive the latest value as soon as they subscribe. Would need to multicast\n// to be able to continue using share\nconst notEmpty = (objects) => Object.keys(objects).length > 0;\nconst modelsObs$ = models$.pipe(filter(notEmpty));\nconst contentTypesObs$ = contentTypes$.pipe(filter(notEmpty));\nconst pathsObs$ = paths$.pipe(filter(notEmpty));\nexport { operationsObs$ as operations$, modelsObs$ as models$, contentTypesObs$ as contentTypes$, pathsObs$ as paths$ };\n// region Models\nexport function model$(modelId) {\n    return models$.pipe(pluck(modelId), filter((model) => Boolean(model)));\n}\nexport function hasCachedModel(modelId) {\n    return Boolean(models$.value[modelId]);\n}\nexport function getCachedModel(modelId) {\n    return models$.value[modelId];\n}\nexport function getCachedModels() {\n    return models$.value;\n}\nexport function fetchById(id) {\n    return search(createQuery('elasticsearch', {\n        query: {\n            bool: {\n                filter: [\n                    {\n                        bool: {\n                            should: {\n                                multi_match: {\n                                    query: id,\n                                    fields: ['*objectId']\n                                }\n                            }\n                        }\n                    }\n                ]\n            }\n        }\n    }),\n    // TODO: Remove hardcoded url\n    crafterConf.getConfig()).pipe(tap(({ total }) => total === 0 && console.log(`[ContentController/fetchById] Model with id ${id} not found.`)), map(({ hits }) => hits.map(({ _source }) => parseDescriptor(preParseSearchResults(_source)))), map(modelsToLookup));\n}\nexport function byPathFetchIfNotLoaded(path) {\n    if (nou(path)) {\n        return of(null);\n    } else if (requestedPaths[path]) {\n        return paths$.pipe(filter((paths) => Boolean(paths[path])), pluck(path), map((modelId) => models$.value[modelId]));\n    } else {\n        requestedPaths[path] = true;\n        return fetchByPath(path).pipe(pluck('model'));\n    }\n}\nexport function getContentInstanceByPath(path) {\n    let modelId = paths$.value[path];\n    return models$.value[modelId];\n}\nexport function isInheritedField(modelId, fieldId) {\n    var _a;\n    return !!((_a = getCachedModel(modelId).craftercms.sourceMap) === null || _a === void 0 ? void 0 : _a[fieldId]);\n}\nexport function getModelIdFromInheritedField(modelId, fieldId) {\n    var _a;\n    const levelDescriptorPath = (_a = models$.value[modelId].craftercms.sourceMap) === null || _a === void 0 ? void 0 : _a[fieldId];\n    if (levelDescriptorPath) {\n        return getContentInstanceByPath(levelDescriptorPath).craftercms.id;\n    }\n    else {\n        return modelId;\n    }\n}\nexport function fetchByPath(path) {\n    return of('nothing').pipe(tap(() => post({ type: 'FETCH_GUEST_MODEL', payload: { path } })), switchMap(() => fromTopic('FETCH_GUEST_MODEL_COMPLETE').pipe(pluck('payload'), filter((payload) => payload.path === path), take(1))));\n}\n// endregion\n// region Content Types\nexport function hasCachedContentType(contentTypeId) {\n    return Boolean(contentTypes$.value[contentTypeId]);\n}\nexport function getCachedContentType(contentTypeId) {\n    return contentTypes$.value[contentTypeId];\n}\nexport function getCachedContentTypes() {\n    return contentTypes$.value;\n}\n// endregion\n// region Operations\n// To propagate the update up the model tree for\n// reference based UI rendering libraries.\nfunction collectReferrers(modelId) {\n    const models = getCachedModels();\n    const parentModels = [];\n    const modelsToUpdate = {};\n    let currentID = getParentModelId(modelId, models, children);\n    while (currentID) {\n        parentModels.push(currentID);\n        currentID = getParentModelId(currentID, models, children);\n    }\n    parentModels.forEach((id) => (modelsToUpdate[id] = Object.assign({}, models[id])));\n    return modelsToUpdate;\n}\nexport function updateField(modelId, fieldId, index, value) {\n    const models = getCachedModels();\n    const model = Object.assign({}, models[modelId]);\n    const parentModelId = getParentModelId(modelId, models, children);\n    const modelsToUpdate = collectReferrers(modelId);\n    // Using `index` being present as the factor to determine how to treat this update.\n    // For now, fieldId should only ever have a `.` if the target zone is inside some collection\n    // (node selector, repeat group) which would in turn mean there should be an `index` present.\n    // In the future there may be some object type fields that would need this logic revisited\n    // to account for a nested field without an index.\n    if (nnou(index)) {\n        // Assuming field/index should be asymmetric (one more piece of field than index). e.g.\n        // - field = repeatingGroup_o.textField_s, index = 0\n        // - field = repeatingGroup_o.nodeSelector_o.textField_s, index = 0.0\n        const fieldPieces = fieldId.split('.');\n        const indexPieces = `${index}`.split('.');\n        let target = model;\n        for (let i = 0, length = indexPieces.length; i < length; i++) {\n            const fieldPiece = fieldPieces[i]; // repeatingGroup_o   textField_s\n            const indexPiece = indexPieces[i]; // 0\n            if (i + 1 === length) {\n                // If it is the last iteration, create a new object: avoid mutating the original.\n                // This should be an object (not an array): a repeat group item.\n                target[fieldPiece][indexPiece] = Object.assign({}, target[fieldPiece][indexPiece]);\n            }\n            target = target[fieldPiece][indexPiece];\n        }\n        const specificFieldId = fieldPieces.pop();\n        target[specificFieldId] = value;\n    }\n    else {\n        Model.value(model, fieldId, value);\n    }\n    // Update the model cache\n    models$.next(Object.assign(Object.assign(Object.assign({}, models), modelsToUpdate), { [modelId]: model }));\n    // Post the update to studio to persist it\n    post(UPDATE_FIELD_VALUE_OPERATION, {\n        modelId,\n        fieldId,\n        index,\n        value,\n        parentModelId\n    });\n    operations$.next({\n        type: UPDATE_FIELD_VALUE_OPERATION,\n        args: { modelId: getModelIdFromInheritedField(modelId, fieldId), fieldId, index, value }\n    });\n}\nexport function insertItem(modelId, fieldId, index, item) {\n    const models = getCachedModels();\n    const collection = Model.value(models[modelId], fieldId);\n    const result = collection.slice(0);\n    // Insert in desired position\n    result.splice(index, 0, item);\n    const model = setCollection(models[modelId], fieldId, typeof index === 'string' && index.includes('.') ? removeLastPiece(index) : index, result);\n    models$.next(Object.assign(Object.assign({}, models), { [modelId]: model }));\n    post(INSERT_ITEM_OPERATION, { modelId, fieldId, index, item });\n    operations$.next({\n        type: 'insert',\n        args: arguments\n    });\n}\nconst systemProps = ['fileName', 'internalName'];\nexport function insertComponent(modelId, fieldId, targetIndex, contentType, shared = false) {\n    var _a;\n    if (typeof contentType === 'string') {\n        contentType = getCachedContentType(contentType);\n    }\n    const models = getCachedModels();\n    const result = getCollection(models[modelId], fieldId, targetIndex).concat();\n    // Create Item\n    // const now = new Date().toISOString();\n    const instance = {\n        craftercms: {\n            id: uuid(),\n            path: null,\n            label: `New ${contentType.name}`,\n            contentTypeId: contentType.id,\n            dateCreated: null,\n            dateModified: null,\n            locale: 'en'\n        }\n    };\n    function processFields(instance, fields) {\n        Object.entries(fields).forEach(([id, field]) => {\n            switch (field.type) {\n                case 'repeat':\n                case 'node-selector': {\n                    instance[id] = [];\n                    if (field.type === 'repeat') {\n                        instance[id].push({});\n                        processFields(instance[id][0], field.fields);\n                    }\n                    break;\n                }\n                default:\n                    if (!systemProps.includes(field.id)) {\n                        instance[id] = getDefaultValue(field);\n                    }\n            }\n        });\n    }\n    processFields(instance, contentType.fields);\n    // Insert in desired position\n    result.splice(targetIndex, 0, instance.craftercms.id);\n    const model = setCollection(models[modelId], fieldId, typeof targetIndex === 'string' ? removeLastPiece(targetIndex) : targetIndex, result);\n    models$.next(Object.assign(Object.assign({}, models), { [instance.craftercms.id]: instance, [modelId]: model }));\n    (_a = children[modelId]) === null || _a === void 0 ? void 0 : _a.push(instance.craftercms.id);\n    post(INSERT_COMPONENT_OPERATION, {\n        modelId,\n        fieldId,\n        targetIndex,\n        contentType,\n        instance,\n        parentModelId: getParentModelId(modelId, models, children),\n        shared\n    });\n    operations$.next({\n        type: INSERT_COMPONENT_OPERATION,\n        args: { modelId, fieldId, targetIndex, contentType, shared, instance }\n    });\n}\n// insertInstance(modelId: string, fieldId: string, targetIndex: number, instance: ContentInstance): void;\n// insertInstance(modelId: string, fieldId: string, targetIndex: string, instance: ContentInstance): void;\nexport function insertInstance(modelId, fieldId, targetIndex, instance) {\n    const models = getCachedModels();\n    const result = getCollection(models[modelId], fieldId, targetIndex).concat();\n    // Insert in desired position\n    result.splice(targetIndex, 0, instance.craftercms.id);\n    const model = setCollection(models[modelId], fieldId, typeof targetIndex === 'string' ? removeLastPiece(targetIndex) : targetIndex, result);\n    models$.next(Object.assign(Object.assign({}, models), { [instance.craftercms.id]: instance, [modelId]: model }));\n    post(INSERT_INSTANCE_OPERATION, {\n        modelId,\n        fieldId,\n        targetIndex,\n        instance,\n        parentModelId: getParentModelId(modelId, models, children)\n    });\n    operations$.next({\n        type: INSERT_INSTANCE_OPERATION,\n        args: { modelId, fieldId, targetIndex, instance }\n    });\n}\nexport function insertGroup(modelId, fieldId, data) { }\nexport function sortItem(modelId, fieldId, currentIndex, targetIndex) {\n    const models = getCachedModels();\n    const currentIndexParsed = typeof currentIndex === 'number' ? currentIndex : parseInt(popPiece(currentIndex));\n    const targetIndexParsed = typeof targetIndex === 'number' ? targetIndex : parseInt(popPiece(targetIndex));\n    const collection = getCollection(models[modelId], fieldId, currentIndex);\n    const result = getCollectionWithoutItemAtIndex(collection, currentIndexParsed);\n    // Insert in desired position\n    result.splice(targetIndexParsed, 0, collection[currentIndexParsed]);\n    const model = setCollection(models[modelId], fieldId, typeof currentIndex === 'string' ? removeLastPiece(currentIndex) : currentIndex, result);\n    models$.next(Object.assign(Object.assign({}, models), { [modelId]: model }));\n    post(SORT_ITEM_OPERATION, {\n        modelId,\n        fieldId,\n        currentIndex,\n        targetIndex,\n        parentModelId: getParentModelId(modelId, models, children)\n    });\n    operations$.next({\n        type: SORT_ITEM_OPERATION,\n        args: arguments\n    });\n}\nexport function moveItem(originalModelId, originalFieldId, originalIndex, targetModelId, targetFieldId, targetIndex) {\n    const models = getCachedModels();\n    // Parse indexes to clear out dot notation for nested repeat/collection items.\n    let originalIndexParsed = typeof originalIndex === 'number' ? originalIndex : parseInt(popPiece(originalIndex));\n    let targetIndexParsed = typeof targetIndex === 'number' ? targetIndex : parseInt(popPiece(targetIndex));\n    const symmetricOriginal = originalFieldId.split('.').length === `${originalIndex}`.split('.').length;\n    const symmetricTarget = targetFieldId.split('.').length === `${targetIndex}`.split('.').length;\n    if (!symmetricOriginal) {\n        debugger;\n    }\n    else if (!symmetricTarget) {\n        debugger;\n    }\n    const currentModel = models[originalModelId];\n    const currentCollection = symmetricOriginal\n        ? Model.extractCollection(currentModel, originalFieldId, originalIndex)\n        : Model.extractCollectionItem(currentModel, originalFieldId, originalIndex);\n    // Remove item from original collection\n    const currentResult = currentCollection\n        .slice(0, originalIndexParsed)\n        .concat(currentCollection.slice(originalIndexParsed + 1));\n    const targetModel = models[targetModelId];\n    const targetCollection = symmetricTarget\n        ? Model.extractCollection(targetModel, targetFieldId, targetIndex)\n        : Model.extractCollectionItem(targetModel, targetFieldId, targetIndex);\n    // Insert item in target collection @ the desired position\n    const targetResult = targetCollection.slice(0);\n    targetResult.splice(targetIndexParsed, 0, currentCollection[originalIndexParsed]);\n    const newOriginalModel = Object.assign({}, currentModel);\n    const newTargetModel = originalModelId === targetModelId ? newOriginalModel : Object.assign({}, targetModel);\n    // This should extract the object that contains the\n    // collection so the collection can be replaced with the new one with the modifications.\n    // This is for nested cases where there's something like `field_1.field_2`.\n    const getFieldItem = (model, field, index) => {\n        let item;\n        if (symmetricOriginal) {\n            item = Model.extractCollectionItem(model, removeLastPiece(`${field}`), removeLastPiece(`${index}`));\n        }\n        else {\n            debugger;\n        }\n        return item;\n    };\n    if (originalFieldId.includes('.')) {\n        let item = getFieldItem(newOriginalModel, originalFieldId, originalIndex);\n        item[popPiece(originalFieldId)] = targetResult;\n    }\n    else {\n        newOriginalModel[originalFieldId] = currentResult;\n    }\n    if (targetModelId !== originalModelId && targetFieldId.includes('.')) {\n        let item = getFieldItem(newTargetModel, targetFieldId, targetIndex);\n        item[popPiece(targetFieldId)] = targetResult;\n    }\n    else {\n        newTargetModel[targetFieldId] = targetResult;\n    }\n    models$.next(originalModelId === targetModelId\n        ? Object.assign(Object.assign({}, models), { [originalModelId]: newOriginalModel }) : Object.assign(Object.assign({}, models), { [originalModelId]: newOriginalModel, [targetModelId]: newTargetModel }));\n    post(MOVE_ITEM_OPERATION, {\n        originalModelId,\n        originalFieldId,\n        originalIndex,\n        targetModelId,\n        targetFieldId,\n        targetIndex,\n        originalParentModelId: getParentModelId(originalModelId, models, children),\n        targetParentModelId: getParentModelId(targetModelId, models, children)\n    });\n    operations$.next({\n        type: MOVE_ITEM_OPERATION,\n        args: arguments\n    });\n}\nexport function deleteItem(modelId, fieldId, index) {\n    const isStringIndex = typeof index === 'string';\n    const parsedIndex = parseInt(popPiece(`${index}`), 10);\n    const models = getCachedModels();\n    const collection = isStringIndex\n        ? Model.extractCollection(models[modelId], fieldId, index)\n        : Model.value(models[modelId], fieldId);\n    const result = collection.slice(0, parsedIndex).concat(collection.slice(parsedIndex + 1));\n    const model = setCollection(models[modelId], fieldId, typeof index === 'string' ? removeLastPiece(index) : index, result);\n    models$.next(Object.assign(Object.assign({}, models), { [modelId]: model }));\n    post(DELETE_ITEM_OPERATION, {\n        modelId,\n        fieldId,\n        index,\n        parentModelId: getParentModelId(modelId, models, children)\n    });\n    operations$.next({\n        type: DELETE_ITEM_OPERATION,\n        args: arguments,\n        state: { item: collection[parsedIndex] }\n    });\n}\nexport function flushRequestedPaths() {\n    requestedPaths = {};\n}\n// endregion\n// Host sends over all content types upon Guest check in.\nfromTopic(CONTENT_TYPES_RESPONSE)\n    .pipe(pluck('payload'))\n    .subscribe((contentTypes) => {\n    contentTypes$.next(Array.isArray(contentTypes) ? createLookupTable(contentTypes) : contentTypes);\n});\nfromTopic('FETCH_GUEST_MODEL_COMPLETE')\n    .pipe(pluck('payload'))\n    .subscribe(({ modelLookup, childrenMap, modelIdByPath }) => {\n    Object.keys(modelIdByPath).forEach((path) => {\n        requestedPaths[path] = true;\n    });\n    Object.assign(children, childrenMap);\n    models$.next(Object.assign(Object.assign({}, models$.value), modelLookup));\n    paths$.next(Object.assign(Object.assign({}, paths$.value), modelIdByPath));\n});\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { pluckProps } from './object';\nexport const foo = (...args) => void null;\nexport const //\nX_AXIS = 'X', Y_AXIS = 'Y', HORIZONTAL = 'horizontal', VERTICAL = 'vertical', TOLERANCE_PERCENTS = { x: 5, y: 5 }, DEFAULT_RECORD_DATA = {\n    id: null,\n    modelId: null,\n    fieldId: null,\n    index: null\n};\nexport function not(condition) {\n    return !condition;\n}\nexport function createLocationArgument() {\n    return pluckProps(window.location, 'hash', 'host', 'hostname', 'href', 'origin', 'pathname', 'port', 'protocol', 'search');\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport * as contentController from './ContentController';\nimport { DEFAULT_RECORD_DATA } from '../utils/util';\nimport * as contentTypeUtils from '../utils/contentType';\nimport * as Model from '../utils/model';\nimport { isNullOrUndefined, notNullOrUndefined, nou, pluckProps } from '../utils/object';\nimport { forEach } from '../utils/array';\nimport { findComponentContainerFields } from '../utils/ice';\nconst validationChecks = {\n    minCount(id, minCount, level, length) {\n        if (length < minCount) {\n            return {\n                id,\n                level,\n                values: { minCount }\n            };\n        }\n        else {\n            return null;\n        }\n    },\n    maxCount(id, maxCount, level, length) {\n        if (length >= maxCount) {\n            return {\n                id,\n                level,\n                values: { maxCount }\n            };\n        }\n        else {\n            return null;\n        }\n    },\n    allowedContentTypeTags() { },\n    allowedContentTypes() { },\n    maxLength() { },\n    readOnly() { },\n    required() { },\n    width() { },\n    height() { },\n    minWidth() { },\n    minHeight() { },\n    maxWidth() { },\n    maxHeight() { }\n};\nlet rid = 0;\n/* private */\nconst registry = new Map();\nlet refCount = {};\nexport function register(registration) {\n    // For consistency, set `fieldId` and `index` props\n    // to null for records that don't include those values\n    const data = Object.assign({}, DEFAULT_RECORD_DATA, pluckProps(registration, 'modelId', 'fieldId', 'index'));\n    if (isNullOrUndefined(data.modelId)) {\n        throw new Error(`ICE component registration requires a model ID to be supplied. Supplied model id was ${data.modelId}.`);\n    }\n    else if (notNullOrUndefined(data.fieldId) &&\n        isNullOrUndefined(data.index) &&\n        contentTypeUtils.isGroupItem(getReferentialEntries(data).contentType, data.fieldId)) {\n        throw new Error('Repeating group item registration requires the index within the repeating group to be supplied. ' +\n            `Please supply index for '${data.fieldId}' of the ${getReferentialEntries(data).contentType.name} model.`);\n    }\n    const id = exists(data);\n    if (id !== -1) {\n        // TODO: Risk\n        // Though more efficient to just keep a refCount\n        // clients mistakenly calling deregister multiple\n        // times would set things off. The alternative was\n        // having slave records.\n        const record = getById(id);\n        refCount[id]++;\n        return record.id;\n    }\n    else {\n        const record = Object.assign(Object.assign({}, data), { id: rid++ });\n        const entities = getReferentialEntries(record);\n        // Record coherence validation\n        if (notNullOrUndefined(entities.fieldId) && isNullOrUndefined(entities.field)) {\n            console.error(`[ICERegistry] Field \"${entities.fieldId}\" was not found on the \"${entities.contentType.name}\" content type. ` +\n                `Please check the field name matches one of the content type field names ` +\n                `(${Object.keys(entities.contentType.fields).join(', ')})`);\n        }\n        registry.set(record.id, record);\n        refCount[record.id] = 1;\n        return record.id;\n    }\n}\nexport function deregister(id) {\n    const record = registry.get(id);\n    if (record) {\n        if (refCount[id] === 1) {\n            registry.delete(id);\n        }\n        else {\n            refCount[id]--;\n        }\n    }\n    return null;\n}\nexport function exists(data) {\n    for (const [, record] of registry) {\n        if (record.modelId === data.modelId &&\n            ((nou(record.fieldId) && nou(data.fieldId)) || record.fieldId === data.fieldId) &&\n            ((nou(record.index) && nou(data.index)) || record.index === data.index)) {\n            return record.id;\n        }\n    }\n    return -1;\n}\nexport function getById(id) {\n    id = typeof id === 'string' ? parseInt(id) : id;\n    return registry.get(id);\n}\nexport function isRepeatGroup(id) {\n    const { field, index } = getReferentialEntries(id);\n    return notNullOrUndefined(field) && isNullOrUndefined(index) && field.type === 'repeat';\n}\nexport function isRepeatGroupItem(id) {\n    const { field, index } = getReferentialEntries(id);\n    return (\n    // If there's no field, it's a root item (component, page)\n    notNullOrUndefined(field) &&\n        // The field must be of type repeat\n        field.type === 'repeat' &&\n        // Collection items - i.e. repeat groups & node-selectors - must specify their\n        // index withing their collection. The absence of an index would mean the tested\n        // record refers to the group itself instead of an item of a group\n        notNullOrUndefined(index) // &&\n    // TODO: Determine nested items\n    // If the index contains dot notation, the record is for a nested\n    // collection. This logic is currently not handled.\n    // `${index}`.includes('.')\n    );\n}\nexport function getMediaDropTargets(type) {\n    var _a;\n    const dropTargets = [];\n    for (const [, record] of registry) {\n        const entries = getReferentialEntries(record);\n        if (((_a = entries.field) === null || _a === void 0 ? void 0 : _a.type) === type) {\n            dropTargets.push(record);\n        }\n    }\n    return dropTargets;\n}\nexport function getRecordDropTargets(id) {\n    const record = getById(id);\n    const { index, field, fieldId, model } = getReferentialEntries(record);\n    if (isNullOrUndefined(index)) {\n        // Can't move something that's not part of a collection.\n        // Collection items will always have an index.\n        return [];\n    }\n    else if (field.type === 'node-selector') {\n        // Get content type of item\n        const models = contentController.getCachedModels();\n        const id = Model.extractCollectionItem(model, fieldId, index);\n        // @ts-ignore TODO: Fix type\n        const nestedModel = models[id];\n        const contentType = Model.getContentTypeId(nestedModel);\n        return getContentTypeDropTargets(contentType).map((rec) => rec);\n    }\n    else if (field.type === 'repeat') {\n        // const item = Model.extractCollectionItem(model, fieldId, index);\n        return getRepeatGroupItemDropTargets(record);\n    }\n    else {\n        console.error('[ICERegistry/getRecordDropTargets] Unhandled path');\n        return [];\n    }\n}\nexport function getRepeatGroupItemDropTargets(record) {\n    const entries = getReferentialEntries(record);\n    const dropTargets = [];\n    const records = registry.values();\n    for (const item of records) {\n        if (isNullOrUndefined(item.index) && item.fieldId === record.fieldId) {\n            const es = getReferentialEntries(item);\n            if (es.contentTypeId === entries.contentTypeId) {\n                dropTargets.push(item);\n            }\n        }\n    }\n    return dropTargets;\n}\nexport function getComponentItemDropTargets(record) {\n    const contentType = getReferentialEntries(record).contentType;\n    return getContentTypeDropTargets(contentType).map((rec) => rec.id);\n}\nexport function getContentTypeDropTargets(contentType) {\n    const contentTypeId = typeof contentType === 'string' ? contentType : contentType.id;\n    return Array.from(registry.values()).filter((record) => {\n        var _a, _b;\n        const { fieldId, index } = record;\n        if (notNullOrUndefined(fieldId)) {\n            const { field, contentType: _contentType, model } = getReferentialEntries(record);\n            const acceptedTypes = (_b = (_a = field === null || field === void 0 ? void 0 : field.validations) === null || _a === void 0 ? void 0 : _a.allowedContentTypes) === null || _b === void 0 ? void 0 : _b.value;\n            const accepts = acceptedTypes && (acceptedTypes.includes(contentTypeId) || acceptedTypes.includes('*'));\n            if (!accepts) {\n                return false;\n            }\n            else if (isNullOrUndefined(index)) {\n                return true;\n            }\n            else {\n                // At this point, this field has been identified as accepting the content type\n                // but the record has an index. If it has an index, it may still be a nested component\n                // holder (node-selector).\n                return (\n                // Check that the field in question is a node-selector\n                contentTypeUtils.isComponentHolder(_contentType, fieldId) &&\n                    // If it is an array, it is a receptacle, otherwise it's an item:\n                    // If it is a node selector, it may be an item of the node selector or a node\n                    // selector itself. Node selectors themselves will be arrays. If it's a value of the\n                    // node selector it would be a string representing an id of a model held by the node\n                    // selector.\n                    Array.isArray(Model.extractCollectionItem(model, fieldId, index)));\n            }\n        }\n        else {\n            return false;\n        }\n    });\n}\nexport function runDropTargetsValidations(dropTargets) {\n    const lookup = {};\n    dropTargets.forEach((record) => {\n        const validationResult = {};\n        const { fieldId, index } = record;\n        let { field: { validations }, model } = getReferentialEntries(record);\n        const collection = Model.extractCollectionItem(model, fieldId, index);\n        Object.keys(validations).forEach((key) => {\n            const validation = validations[key];\n            switch (validation.id) {\n                case 'minCount': {\n                    if (validation.value && collection.length < validation.value) {\n                        validationResult[validation.id] = {\n                            id: validation.id,\n                            level: validation.level,\n                            values: { min: validation.value }\n                        };\n                    }\n                    break;\n                }\n                case 'maxCount': {\n                    if (validation.value && collection.length >= validation.value) {\n                        validationResult[validation.id] = {\n                            id: validation.id,\n                            level: validation.level,\n                            values: { max: validation.value }\n                        };\n                    }\n                    break;\n                }\n                default:\n                    break;\n            }\n        });\n        lookup[record.id] = validationResult;\n    });\n    return lookup;\n}\nexport function runValidation(iceId, validationId, args) {\n    const record = getById(iceId);\n    let { field: { validations } } = getReferentialEntries(record);\n    if (validations[validationId]) {\n        return validationChecks[validationId](...[...Object.values(validations[validationId]), ...args]);\n    }\n    else {\n        return null;\n    }\n}\nexport function getReferentialEntries(record) {\n    var _a;\n    record = typeof record === 'object' ? record : getById(record);\n    let model = contentController.getCachedModel(record.modelId);\n    let contentTypeId = Model.getContentTypeId(model);\n    let contentType = contentController.getCachedContentType(contentTypeId);\n    let field = record.fieldId\n        ? contentTypeUtils.getField(contentType, record.fieldId, contentController.getCachedContentTypes())\n        : null;\n    if (!field && record.fieldId && ((_a = model.craftercms.sourceMap) === null || _a === void 0 ? void 0 : _a[record.fieldId])) {\n        model = contentController.getContentInstanceByPath(model.craftercms.sourceMap[record.fieldId]);\n        contentTypeId = Model.getContentTypeId(model);\n        contentType = contentController.getCachedContentType(contentTypeId);\n        field = record.fieldId ? contentTypeUtils.getField(contentType, record.fieldId) : null;\n    }\n    return Object.assign({ model,\n        field,\n        contentType,\n        contentTypeId }, record);\n}\nexport function getRecordField(record) {\n    return getReferentialEntries(record).field;\n}\nexport function isMovable(recordId) {\n    // modeId -> the main/parent model id or a sub model id\n    // fieldId -> repeatGroup or array\n    const entries = getReferentialEntries(recordId);\n    const { field, index } = entries;\n    return (field != null &&\n        (field.type === 'repeat' || field.type === 'node-selector') &&\n        field.sortable &&\n        // `index` must be a valid number. nullish value\n        // may mean it's not an item but rather the repeat\n        // group or component itself\n        notNullOrUndefined(index));\n}\n/* private */\nexport function checkComponentMovability(entries) {\n    // Can't move if\n    // - no other zones\n    // - other zones are maxed out\n    // - leaving current zone would violate minimum\n    var _a;\n    if (((_a = entries.field) === null || _a === void 0 ? void 0 : _a.type) !== 'node-selector') {\n        return false;\n    }\n    const records = Array.from(registry.values());\n    let parentField, parentModelId, parentCollection, minCount;\n    // Find the parent field and it's respective container collection\n    // The array in which this model is listed on.\n    for (let i = 0, l = records.length; i < l; i++) {\n        if (records[i].id === entries.id) {\n            continue;\n        }\n        const record = getReferentialEntries(records[i]);\n        if (isNullOrUndefined(record.field)) {\n            if (notNullOrUndefined(record.index)) {\n                // Collection item record. Cannot be the container.\n            }\n            else {\n                // Is a component...\n                // - get model fields\n                // - check if one of the fields has this value\n                const children = contentController.children[record.modelId];\n                if (children && children.includes(entries.modelId)) {\n                    parentModelId = record.modelId;\n                    const containers = findComponentContainerFields(record.contentType.fields), field = findContainerField(record.model, containers, entries.modelId);\n                    if (notNullOrUndefined(field)) {\n                        parentField = field;\n                        parentCollection = Model.prop(record.model, field.id);\n                        break;\n                    }\n                }\n            }\n        }\n        else if (record.field.type === 'node-selector') {\n            const value = Model.value(record.model, record.fieldId);\n            if (value.includes(entries.modelId) || value === entries.modelId) {\n                parentField = record.field;\n                parentModelId = record.modelId;\n                parentCollection = value;\n                break;\n            }\n        }\n    }\n    if (!parentField) {\n        throw new Error(`Unable to find the parent field for instance \"${entries.modelId}\" of ` +\n            `${entries.contentType.name} component${entries.fieldId ? ` (${entries.fieldId} field)` : ''}. ` +\n            'Did you forget to declare the field when creating the content type?\\n' +\n            'Check the state of the model data this could mean the data is corrupted.');\n    }\n    const found = forEach(records, (record) => {\n        if (record.modelId === parentModelId && record.fieldId === parentField.id) {\n            return true;\n        }\n    }, false);\n    if (!found) {\n        const componentName = `'${entries.contentType.name} ${entries.contentType.name.toLowerCase().includes('component') ? \"'\" : \"Component' \"}`;\n        console.warn(`Per definition the ${componentName} is sortable but a drop zone for it was not found. ` +\n            'Did you forget to register the zone? Please initialize the drop zone element(s) of ' +\n            `the ${componentName} with modelId=\"${parentModelId}\" and fieldId=\"${parentField.id}\".`);\n        return false;\n    }\n    minCount = (parentField.validations && parentField.validations.minCount) || 0;\n    if (parentField.type === 'node-selector') {\n        return ((parentField.sortable &&\n            // If there are more adjacent items on this zone to be able to\n            // move current guy before/after\n            parentCollection.length > 1) ||\n            // Would moving the guy away from this zone violate it's minCount?\n            (parentCollection.length - 1 >= minCount &&\n                // Does anybody else accept this type of component?\n                getComponentItemDropTargets(entries).length > 0));\n    }\n    else {\n        return (\n        // Moving this component would make the parent field value null/blank\n        // If the parent field is not required that should be ok\n        !parentField.required &&\n            // Is this guy accepted elsewhere?\n            getComponentItemDropTargets(entries).length > 0);\n    }\n}\n/* private */\nexport function checkRepeatGroupMovability(entries) {\n    const { model, field, index } = entries;\n    return ((field === null || field === void 0 ? void 0 : field.type) === 'repeat' &&\n        field.sortable &&\n        // `index` must be a valid number. nullish value\n        // may mean it's not a group item but rather the group\n        // container\n        notNullOrUndefined(index) &&\n        // No point making movable an item that can't jump\n        // zones and doesn't have any adjacent items to move it\n        // next to.\n        // TODO: What about DnD trashing, though?\n        Model.value(model, field.id).length > 1);\n}\nexport function findContainerField(model, fields, modelId) {\n    return forEach(fields, (field) => {\n        const value = Model.value(model, field.id);\n        if (field.type === 'node-selector' && (value === modelId || value.includes(modelId))) {\n            return field;\n        }\n        else if (field.type === 'repeat') {\n            // TODO ...\n        }\n    });\n}\nexport function flush() {\n    registry.clear();\n    refCount = {};\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { forEach } from './array';\nimport $ from 'jquery';\nimport { HORIZONTAL, TOLERANCE_PERCENTS, VERTICAL, X_AXIS, Y_AXIS } from './util';\nimport { getElementFromICEProps } from '../classes/ElementRegistry';\n// Regular click gets triggered even after loooong mouse downs or\n// when mousing-down and dragging cursor - without actually being on\n// a drag and drop of an element - and then mousing-up some other place.\n// This causes the ice zone selection to occur and the UX feels awkward.\n// This is a custom click event with a more opinionated click behaviour\n// that could be used instead of the regular click. The trade-of is that,\n// as is, won't handle preventDefault/stopPropagation correctly as it's a\n// delegate on the document (i.e. the event as bubbled all the way up).\n// Would need to add additional logic to set the delegation in a way that\n// events can still be stopped (see jQuery).\n// export function addClickListener(\n//   element: HTMLElement | Document,\n//   type: string,\n//   handler: (e: Event) => any\n// ): Subscription {\n//   if (element === document) {\n//     // TODO: set up as delegate, control event propagation & stopping accordingly\n//   }\n//\n//   const mouseDown$ = fromEvent(element, 'mousedown');\n//   const mouseUp$ = fromEvent(element, 'mouseup');\n//   return mouseDown$\n//     .pipe(\n//       switchMap(() => mouseUp$.pipe(takeUntil(interval(300)), take(1))),\n//       filter(\n//         (e: any) =>\n//           e.target.hasAttribute('data-craftercms-model-id') ||\n//           forEach(\n//             e.path,\n//             (el) =>\n//               el !== window && el !== document && el.hasAttribute('data-craftercms-model-id')\n//                 ? true\n//                 : 'continue',\n//             false\n//           )\n//       )\n//     )\n//     .subscribe(handler);\n// }\nexport function sibling(element, next) {\n    return next ? element.nextElementSibling : element.previousElementSibling;\n}\nexport function getDropMarkerPosition(args) {\n    const { \n    // refElement,\n    arrangement, insertPosition, refElementRect, nextOrPrevRect } = args, horizontal = arrangement === HORIZONTAL, before = insertPosition === 'before', \n    // $elementToInsert = $(refElement),\n    // This vars are just for mental clarity; to work with\n    // the right semantics in the code below.\n    // If inserting before the element, will be working with\n    // the previous element's rect (prev rect). If inserting\n    // after, will be working with the next element's rect.\n    nextRect = nextOrPrevRect, prevRect = nextOrPrevRect;\n    // If there is not next/prev rect, no need to account for it\n    // in the position calculation - set difference to 0.\n    const difference = !nextOrPrevRect\n        ? 0\n        : // Account for whether the previous rect inline with current rect...\n            // Only matters when working with horizontally laid-out elements\n            horizontal && nextOrPrevRect.top !== refElementRect.top\n                ? 0\n                : // Calculate the middle point between the two adjacent rects.\n                    // This avoids the drop marker moving by millimeters when switching from\n                    // inserting after nodes[i] to before node[i+1]\n                    before\n                        ? // Inserting before\n                            horizontal\n                                ? // Smaller number fronted to obtain a negative\n                                    // value since wish to subtract from the position\n                                    (prevRect.right - refElementRect.left) / 2\n                                : (prevRect.bottom - refElementRect.top) / 2\n                        : // Inserting after\n                            horizontal\n                                ? // Bigger number fronted to obtain a positive\n                                    // value to add to the position\n                                    (nextRect.left - refElementRect.right) / 2\n                                : (nextRect.top - refElementRect.bottom) / 2;\n    return horizontal\n        ? {\n            height: refElementRect.height,\n            top: refElementRect.top,\n            left: before ? refElementRect.left + difference : refElementRect.right + difference\n        }\n        : {\n            width: refElementRect.width,\n            top: before ? refElementRect.top + difference : refElementRect.bottom + difference,\n            left: refElementRect.left\n        };\n}\nexport function splitRect(rect, axis = X_AXIS) {\n    // x, y, width, height, top, right, bottom, left\n    let rect1 = {}, rect2 = {};\n    // noinspection DuplicatedCode\n    if (axis === X_AXIS) {\n        const half = rect.height / 2;\n        rect1.x = rect.x;\n        rect1.y = rect.y;\n        rect1.width = rect.width;\n        rect1.height = half;\n        rect1.top = rect.top;\n        rect1.right = rect.right;\n        rect1.bottom = rect.top + half;\n        rect1.left = rect.left;\n        rect2.x = rect.x;\n        rect2.y = rect.y + half;\n        rect2.width = rect.width;\n        rect2.height = half;\n        rect2.top = rect2.y;\n        rect2.right = rect.right;\n        rect2.bottom = rect.bottom;\n        rect2.left = rect.left;\n    }\n    else if (axis === Y_AXIS) {\n        const half = rect.width / 2;\n        rect1.x = rect.x;\n        rect1.y = rect.y;\n        rect1.width = half;\n        rect1.height = rect.height;\n        rect1.top = rect.top;\n        rect1.right = rect.left + half;\n        rect1.bottom = rect.bottom;\n        rect1.left = rect.left;\n        rect2.x = rect.x + half;\n        rect2.y = rect.y;\n        rect2.width = half;\n        rect2.height = rect.height;\n        rect2.top = rect.top;\n        rect2.right = rect.right;\n        rect2.bottom = rect.bottom;\n        rect2.left = rect.left + half;\n    }\n    else {\n        throw new Error(`Invalid axis suplied. Valid values are \"${X_AXIS}\" or \"${Y_AXIS}\".`);\n    }\n    return [rect1, rect2];\n}\nexport function insertDropMarker({ $dropMarker, insertPosition, refElement }) {\n    if (insertPosition === 'after') {\n        $dropMarker.insertAfter(refElement);\n    }\n    else {\n        $dropMarker.insertBefore(refElement);\n    }\n}\nexport function getDistanceBetweenPoints(p1, p2) {\n    return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\nexport function findClosestRect(parentRect, subRects, coordinates) {\n    let //\n    index = -1, distances = [];\n    subRects.forEach((rect, i) => {\n        const stats = getInRectStats(rect, coordinates);\n        stats.inRect && (index = i);\n        distances.push(getDistanceBetweenPoints(coordinates, {\n            x: rect.left + rect.width / 2,\n            y: rect.top + rect.height / 2\n        }));\n        return stats;\n    });\n    if (index === -1) {\n        index = distances.indexOf(Math.min(...distances));\n    }\n    return index;\n}\nexport function getChildArrangement(children, childrenRects, selfRect) {\n    if (children.length === 0) {\n        // If width is big enough, we may assume it may potentially have multiple\n        // columns and HORIZONTAL arrangement may be better guess; however,\n        // using the larger space to display the drop marker makes it more visible.\n        // Vertical arrangement (stacked), will cause the drop marker to be across\n        // the X axis, so logic is sort of flipped in the sense that it's said to be\n        // vertical so that drop marker displays horizontally\n        return selfRect.width > selfRect.height ? VERTICAL : HORIZONTAL;\n    }\n    let //\n    topValues = [], alignedTop = false;\n    for (let i = 0, l = children.length, topValue, marginTop; i < l; i++) {\n        marginTop = parseInt(\n        // jQuery is kind enough to always provide the value in pixels :)\n        $(children[i])\n            .css('margin-top')\n            .replace(/px/i, '') || '', 10);\n        topValue = childrenRects[i].top - marginTop;\n        if (topValues.includes(topValue)) {\n            alignedTop = true;\n            break;\n        }\n        else {\n            topValues.push(topValue);\n        }\n    }\n    return alignedTop ? HORIZONTAL : VERTICAL;\n}\nexport function getInRectStats(rect, coordinates, tolerancePercents = TOLERANCE_PERCENTS) {\n    const percents = getRelativePointerPositionPercentages(coordinates, rect), inRectTop = coordinates.y >= rect.top, inRectRight = coordinates.x <= rect.right, inRectBottom = coordinates.y <= rect.bottom, inRectLeft = coordinates.x >= rect.left, inRect = inRectLeft && inRectRight && inRectTop && inRectBottom, inInnerRectTop = percents.y >= tolerancePercents.y, inInnerRectRight = percents.x <= 100 - tolerancePercents.x, inInnerRectBottom = percents.y <= 100 - tolerancePercents.y, inInnerRectLeft = percents.x >= tolerancePercents.x, inInnerRect = inInnerRectLeft && // left\n        inInnerRectRight && // right\n        inInnerRectTop && // top\n        inInnerRectBottom; // bottom\n    return {\n        inRectTop,\n        inRectRight,\n        inRectBottom,\n        inRectLeft,\n        inRect,\n        inInnerRectTop,\n        inInnerRectRight,\n        inInnerRectBottom,\n        inInnerRectLeft,\n        inInnerRect,\n        percents\n    };\n}\nexport function getRelativePointerPositionPercentages(mousePosition, rect) {\n    const x = \n    /* mouse X distance from rect left edge */\n    ((mousePosition.x - rect.left) /\n        /* width */\n        rect.width) *\n        100, y = \n    /* mouse X distance from rect top edge */\n    ((mousePosition.y - rect.top) /\n        /* height */\n        rect.height) *\n        100;\n    return { x, y };\n}\nexport function isElementInView(element, fullyInView) {\n    const pageTop = $(window).scrollTop();\n    const pageBottom = pageTop + $(window).height();\n    const elementTop = $(element).offset().top;\n    const elementBottom = elementTop + $(element).height();\n    if (fullyInView === true) {\n        return pageTop < elementTop && pageBottom > elementBottom;\n    }\n    else {\n        return elementTop <= pageBottom && elementBottom >= pageTop;\n    }\n}\nexport function addAnimation($element, animationClass) {\n    const END_EVENT = 'webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend';\n    $element.addClass(animationClass);\n    // @ts-ignore\n    $element.one(END_EVENT, function () {\n        $element.removeClass(animationClass);\n    });\n}\nexport function scrollToIceProps(iceProps, scrollElement, animate = false) {\n    return scrollToElement(getElementFromICEProps(iceProps.modelId, iceProps.fieldId, iceProps.index), scrollElement, animate);\n}\nexport function scrollToElement(element, scrollElement, animate = false) {\n    const $element = $(element);\n    if (!element) {\n        return null;\n    }\n    else if (!isElementInView($element)) {\n        $(scrollElement).animate({\n            scrollTop: $element.offset().top - 100\n        }, 300, function () {\n            if (animate)\n                addAnimation($element, 'craftercms-content-tree-locate');\n        });\n    }\n    else if (animate) {\n        addAnimation($element, 'craftercms-content-tree-locate');\n    }\n    return $element;\n}\nexport function scrollToDropTargets(dropTargets, scrollElement, getElementRegistry) {\n    let elementInView;\n    elementInView = forEach(dropTargets, ({ id }) => {\n        let elem = getElementRegistry(id);\n        if (isElementInView(elem)) {\n            elementInView = true;\n            return 'break';\n        }\n    }, false);\n    if (!elementInView) {\n        // TODO: Do this relative to the scroll position. Don't move if things are already in viewport. Be smarter.\n        let element = getElementRegistry(dropTargets[0].id);\n        $(scrollElement).animate({\n            scrollTop: $(element).offset().top - 100\n        }, 300);\n    }\n}\nexport function updateDropZoneValidations(dropZone, dropZones, validations) {\n    const newDropZone = Object.assign({}, dropZone);\n    let newDropZones = [...dropZones];\n    newDropZone.validations = validations;\n    newDropZones = newDropZones.filter((item) => item.elementRecordId !== newDropZone.elementRecordId);\n    newDropZones.push(newDropZone);\n    return newDropZones;\n}\nexport function getZoneMarkerStyle(rect, padding = 0) {\n    const $window = $(window);\n    return {\n        height: rect.height + padding,\n        width: rect.width + padding,\n        top: rect.top + $window.scrollTop() - padding / 2,\n        left: rect.left + $window.scrollLeft() - padding / 2\n    };\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport * as iceRegistry from './ICERegistry';\nimport { getById } from './ICERegistry';\nimport { byPathFetchIfNotLoaded, getCachedContentType, getCachedModels, hasCachedModel, isInheritedField, model$ } from './ContentController';\nimport { take } from 'rxjs/operators';\nimport * as ContentType from '../utils/contentType';\nimport * as Model from '../utils/model';\nimport { isNullOrUndefined, notNullOrUndefined } from '../utils/object';\nimport { forEach } from '../utils/array';\nimport { getChildArrangement, sibling } from '../utils/dom';\nimport { removeLastPiece } from '../utils/string';\nimport $ from 'jquery';\nlet seq = 0;\nconst db = {};\nconst registry = {};\nexport function get(id) {\n    const record = db[id];\n    record && isNullOrUndefined(record.label) && setLabel(record);\n    return record;\n}\n// TODO: Unknown field names go by ignored. Trace the registration point to warn...\n// developers about field names that aren't found in the content type\nexport function setLabel(record) {\n    const labels = [];\n    const models = getCachedModels();\n    record.iceIds.forEach((iceId) => {\n        const iceRecord = iceRegistry.getById(iceId);\n        const { model, field, fieldId, index, contentType } = iceRegistry.getReferentialEntries(iceRecord);\n        if (notNullOrUndefined(field)) {\n            if (field.type === 'node-selector') {\n                if (notNullOrUndefined(index)) {\n                    let component;\n                    if (notNullOrUndefined(fieldId) && ContentType.isGroupItem(contentType, fieldId)) {\n                        // Repeat groups with possibly nested node-selector/repeat\n                        let aux = Model.extractCollectionItem(model, fieldId, index);\n                        // TODO: Only works for nested node-selector (?)...\n                        // A nested repeat group would not be a component and `aux` would rather be\n                        // an object to read the last piece of the `fieldId`\n                        // @ts-ignore TODO: Fix type\n                        component = models[aux];\n                    }\n                    else {\n                        // Ok for mono-level node selectors\n                        const id = Model.value(model, field.id)[index];\n                        component = models[id];\n                    }\n                    if (component) {\n                        labels.push(`${component.craftercms.label} (${getCachedContentType(component.craftercms.contentTypeId).name})`);\n                    }\n                    else {\n                        labels.push(`${field.name}`);\n                    }\n                }\n                else {\n                    labels.push(`${field.name}`);\n                }\n            }\n            else {\n                labels.push(field.name);\n            }\n        }\n        else {\n            labels.push(`${model.craftercms.label} (${contentType.name})`);\n        }\n    });\n    record.label = labels.join(', ');\n}\nexport function register(payload) {\n    // @ts-ignore\n    if (notNullOrUndefined(payload.id)) {\n        throw new Error('Record already has id. Was it pre-registered? Please deregister first.');\n    }\n    const { element, modelId, index, label, fieldId, path } = payload;\n    const id = seq++;\n    const iceIds = [];\n    // prettier-ignore\n    const fieldIds = fieldId == null\n        ? []\n        : Array.isArray(fieldId)\n            ? fieldId\n            : fieldId.split(',').map((str) => str.trim());\n    function create() {\n        // Create/register the physical record\n        db[id] = {\n            id,\n            element,\n            modelId,\n            index,\n            label,\n            fieldId: fieldIds,\n            iceIds,\n            complete: false,\n            inherited: fieldIds.some((fieldId) => isInheritedField(modelId, fieldId))\n        };\n    }\n    // If the relevant model is loaded, complete it's registration, otherwise,\n    // request it and complete registration when it does load.\n    if (hasCachedModel(modelId)) {\n        create();\n        completeDeferredRegistration(id);\n    }\n    else {\n        path && byPathFetchIfNotLoaded(path).subscribe();\n        model$(modelId)\n            .pipe(take(1))\n            .subscribe(() => {\n            create();\n            completeDeferredRegistration(id);\n        });\n    }\n    return id;\n}\nexport function completeDeferredRegistration(id) {\n    const record = db[id];\n    const { modelId, index, fieldId: fieldIds, iceIds } = record;\n    if (fieldIds.length > 0) {\n        fieldIds.forEach((fieldId) => {\n            const iceId = iceRegistry.register({ modelId, index, fieldId });\n            if (!registry[iceId]) {\n                registry[iceId] = [];\n            }\n            registry[iceId].push(record.id);\n            iceIds.push(iceId);\n        });\n    }\n    else {\n        const iceId = iceRegistry.register({ modelId, index });\n        if (!registry[iceId]) {\n            registry[iceId] = [];\n        }\n        registry[iceId].push(record.id);\n        iceIds.push(iceId);\n    }\n    db[id].complete = true;\n}\nexport function deregister(id) {\n    const record = db[id];\n    if (notNullOrUndefined(record)) {\n        const { iceIds } = record;\n        iceIds.forEach((iceId) => {\n            if (registry[iceId].length === 1) {\n                delete registry[iceId];\n            }\n            else if (registry[iceId].length > 1) {\n                registry[iceId].splice(registry[iceId].indexOf(record.id), 1);\n            }\n            iceRegistry.deregister(iceId);\n        });\n        delete db[id];\n    }\n    return record;\n}\nexport function getDraggable(id) {\n    const record = get(id);\n    return forEach(record.iceIds, function (iceId) {\n        if (iceRegistry.isMovable(iceId)) {\n            return iceId;\n        }\n    }, false);\n}\nexport function getHoverData(id) {\n    const record = get(id);\n    return {\n        id,\n        rect: record.element.getBoundingClientRect(),\n        inherited: record.inherited,\n        label: record.label,\n        validations: {}\n    };\n}\nexport function getRect(id) {\n    return get(id).element.getBoundingClientRect();\n}\nexport function createIntermediateElementRecord(record, iceId) {\n    if (!record) {\n        return null;\n    }\n    const { id, element, label, modelId, index } = record;\n    return { id, element, modelId, index, label, fieldId: getById(iceId).fieldId, iceId };\n}\nexport function fromICEId(iceId) {\n    var _a;\n    const record = db[(_a = registry[iceId]) === null || _a === void 0 ? void 0 : _a[0]];\n    return createIntermediateElementRecord(record, iceId);\n}\nexport function getRecordsFromIceId(iceId) {\n    const recordsIds = registry[iceId];\n    const records = [];\n    if (!recordsIds) {\n        return null;\n    }\n    else if (recordsIds.length > 1) {\n        recordsIds.forEach((recordId) => {\n            let record = db[recordId];\n            let registry = createIntermediateElementRecord(record, iceId);\n            if (registry) {\n                records.push(registry);\n            }\n        });\n        return records.length > 0 ? records : null;\n    }\n    else {\n        let registry = fromICEId(iceId);\n        return registry ? [registry] : null;\n    }\n}\nfunction getDropZoneFromRegistryEntry(elementRecord, iceId) {\n    const elementRecordId = elementRecord.id;\n    const element = elementRecord.element;\n    const children = Array.from(element.children);\n    const childrenRects = children.map((child) => child.getBoundingClientRect());\n    const rect = element.getBoundingClientRect();\n    return {\n        element,\n        children,\n        iceId,\n        elementRecordId,\n        rect,\n        arrangement: getChildArrangement(children, childrenRects, rect),\n        childrenRects,\n        validations: {}\n    };\n}\nexport function compileDropZone(iceId) {\n    const elementRecord = fromICEId(iceId);\n    return getDropZoneFromRegistryEntry(elementRecord, iceId);\n}\nexport function compileAllDropZones(iceId) {\n    const elementRecords = getRecordsFromIceId(iceId);\n    return elementRecords.map((elementRecord) => getDropZoneFromRegistryEntry(elementRecord, iceId));\n}\nexport function getSiblingRects(id) {\n    let //\n    record = get(id), element = record.element, nextSibling, prevSibling, next, prev;\n    nextSibling = sibling(element, true);\n    prevSibling = sibling(element, false);\n    forEach(Object.values(db), (record) => {\n        if (record.element === nextSibling) {\n            next = record.element.getBoundingClientRect();\n        }\n        else if (record.element === prevSibling) {\n            prev = record.element.getBoundingClientRect();\n        }\n        else if (notNullOrUndefined(next) && notNullOrUndefined(prev)) {\n            return 'break';\n        }\n    });\n    return { next, prev };\n}\nexport function fromElement(element) {\n    return forEach(Object.values(db), (record) => {\n        if (record.element === element) {\n            return get(record.id);\n        }\n    });\n}\nexport function hasElement(element) {\n    return forEach(Object.values(db), (record) => {\n        if (record.element === element) {\n            return true;\n        }\n    }, false);\n}\nexport function getHighlighted(dropZones) {\n    return dropZones.reduce((object, { elementRecordId: id, validations }) => {\n        object[id] = getHoverData(id);\n        object[id].validations = validations;\n        return object;\n    }, {});\n}\nexport function getDragContextFromDropTargets(dropTargets, validationsLookup, currentRecord) {\n    const response = {\n        dropZones: [],\n        siblings: [],\n        players: [],\n        containers: []\n    };\n    dropTargets.forEach(({ id }) => {\n        const dropZones = compileAllDropZones(id);\n        const dropZonesFiltered = currentRecord\n            ? dropZones.filter((dropZone) => dropZone.children.includes(currentRecord.element))\n            : null;\n        (dropZonesFiltered && dropZonesFiltered.length ? dropZonesFiltered : dropZones).forEach((dropZone) => {\n            var _a;\n            dropZone.origin = null;\n            dropZone.origin = currentRecord ? dropZone.children.includes(currentRecord.element) : null;\n            dropZone.validations = (_a = validationsLookup === null || validationsLookup === void 0 ? void 0 : validationsLookup[id]) !== null && _a !== void 0 ? _a : {};\n            response.dropZones.push(dropZone);\n            response.siblings = [...response.siblings, ...dropZone.children];\n            response.players = [...response.players, ...dropZone.children, dropZone.element];\n            response.containers.push(dropZone.element);\n        });\n    });\n    return response;\n}\nexport function getElementFromICEProps(modelId, fieldId, index) {\n    const recordId = iceRegistry.exists({\n        modelId: modelId,\n        fieldId: fieldId,\n        index: index\n    });\n    if (recordId !== -1) {\n        const registryEntry = fromICEId(recordId);\n        if (registryEntry) {\n            return registryEntry.element;\n        }\n        else {\n            return null;\n        }\n    }\n    else {\n        return null;\n    }\n}\nexport function getParentElementFromICEProps(modelId, fieldId, index) {\n    const recordId = iceRegistry.exists({\n        modelId: modelId,\n        fieldId: fieldId,\n        index: fieldId.includes('.') ? parseInt(removeLastPiece(index)) : null\n    });\n    return recordId === -1 ? null : $(fromICEId(recordId).element);\n}\nexport function getParentsElementFromICEProps(modelId, fieldId, index) {\n    const recordId = iceRegistry.exists({\n        modelId: modelId,\n        fieldId: fieldId,\n        index: fieldId.includes('.') ? parseInt(removeLastPiece(index)) : null\n    });\n    return recordId === -1 ? null : getRecordsFromIceId(recordId).map((registryEntry) => $(registryEntry.element));\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport React, { useContext, useMemo } from 'react';\nimport { createDispatchHook, createSelectorHook, createStoreHook } from 'react-redux';\nexport const GuestReduxContext = React.createContext(null);\nif (process.env.NODE_ENV !== 'production') {\n    GuestReduxContext.displayName = 'GuestRedux';\n}\nexport const useDispatch = createDispatchHook(GuestReduxContext);\nexport const useSelector = createSelectorHook(GuestReduxContext);\nexport const useStore = createStoreHook(GuestReduxContext);\nconst GuestContext = React.createContext(null);\nexport function useGuestContext() {\n    return useContext(GuestContext);\n}\nexport function GuestContextProvider(props) {\n    const value = useMemo(() => props.value, [props.value]);\n    return React.createElement(GuestContext.Provider, Object.assign({}, props, { value: value }));\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { useLayoutEffect, useRef } from 'react';\nimport ReactDOM from 'react-dom';\nexport function CrafterCMSPortal(props) {\n    const portalRef = useRef(null);\n    if (portalRef.current === null) {\n        portalRef.current = document.createElement('craftercms-portal');\n    }\n    useLayoutEffect(() => {\n        const body = document.body;\n        const portal = portalRef.current;\n        body.appendChild(portal);\n        return () => {\n            body.removeChild(portal);\n        };\n    }, []);\n    return ReactDOM.createPortal(props.children, portalRef.current);\n}\nexport default CrafterCMSPortal;\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport React, { useEffect, useState } from 'react';\nimport { getZoneMarkerStyle } from '../utils/dom';\nexport function ZoneMarker(props) {\n    const { rect, label, classes, inherited } = props;\n    const [zoneStyle, setZoneStyle] = useState();\n    useEffect(() => {\n        setZoneStyle(getZoneMarkerStyle(rect));\n    }, [rect]);\n    return (React.createElement(\"craftercms-zone-marker\", { style: zoneStyle, class: classes === null || classes === void 0 ? void 0 : classes.marker },\n        React.createElement(\"craftercms-zone-marker-label\", { class: classes === null || classes === void 0 ? void 0 : classes.label },\n            label,\n            inherited && (React.createElement(\"img\", { className: \"craftercms-zone-marker-icon\", src: \"/studio/static-assets/images/inheritedIcon.svg\", alt: \"\" })))));\n}\nexport default ZoneMarker;\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport React, { useEffect, useRef, useState } from 'react';\nimport { foo, HORIZONTAL, VERTICAL, X_AXIS, Y_AXIS } from '../utils/util';\nimport { notNullOrUndefined } from '../utils/object';\nimport { forEach } from '../utils/array';\nimport { findClosestRect, getDropMarkerPosition, getInRectStats, splitRect } from '../utils/dom';\nexport function DropMarker(props) {\n    const //\n    { over, prev, next, dropZone, coordinates, onDropPosition } = props, { current: r } = useRef({ targetIndex: null }), [style, setStyle] = useState({}), { element } = over;\n    // TODO: Check missing reason for missing dependencies\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    useEffect(dragOver, [prev, next, coordinates.x, coordinates.y]);\n    return (\n    // @ts-ignore\n    React.createElement(\"craftercms-drop-marker\", { style: style, class: `${dropZone.arrangement === HORIZONTAL ? VERTICAL : HORIZONTAL}` }));\n    function dragOver() {\n        let nextStyle = null, targetIndex;\n        if (element === dropZone.element) {\n            if (element.children.length > 0) {\n                const closestChildIndex = findClosestRect(dropZone.rect, dropZone.childrenRects, coordinates), closestRect = dropZone.childrenRects[closestChildIndex], closestChild = dropZone.children[closestChildIndex], before = dropZone.arrangement === HORIZONTAL\n                    ? // Is it to the left of the center of the rect?\n                        coordinates.x <= closestRect.left + closestRect.width / 2\n                    : // Is it to the north of the center of the rect?\n                        coordinates.y <= closestRect.top + closestRect.height / 2;\n                nextStyle = getDropMarkerPosition({\n                    arrangement: dropZone.arrangement,\n                    insertPosition: before ? 'before' : 'after',\n                    refElement: closestChild,\n                    refElementRect: closestRect,\n                    nextOrPrevRect: before\n                        ? dropZone.childrenRects[closestChildIndex - 1]\n                        : dropZone.childrenRects[closestChildIndex + 1]\n                });\n                targetIndex = before ? closestChildIndex : closestChildIndex + 1;\n            }\n            else {\n                // Drop zone is empty\n                // onDropPosition({ targetIndex: 0 });\n                const virtualRects = splitRect(dropZone.rect, \n                // Using the larger space to display the drop marker makes it more visible\n                dropZone.rect.width > dropZone.rect.height ? X_AXIS : Y_AXIS);\n                nextStyle = getDropMarkerPosition({\n                    arrangement: dropZone.arrangement,\n                    insertPosition: 'after',\n                    refElement: dropZone.element,\n                    refElementRect: virtualRects[0],\n                    nextOrPrevRect: virtualRects[1]\n                });\n                targetIndex = 0;\n            }\n        }\n        else {\n            let //\n            prevRect = prev, nextRect = next, rect = element.getBoundingClientRect(), rectStats = getInRectStats(rect, coordinates);\n            if (rectStats.inRect) {\n                const insertPosition = (dropZone.arrangement === HORIZONTAL && rectStats.percents.x >= 50) ||\n                    (dropZone.arrangement === VERTICAL && rectStats.percents.y >= 50)\n                    ? 'after'\n                    : 'before', before = insertPosition === 'before';\n                nextStyle = getDropMarkerPosition({\n                    insertPosition,\n                    arrangement: dropZone.arrangement,\n                    refElement: element,\n                    refElementRect: rect,\n                    nextOrPrevRect: before ? prevRect : nextRect\n                });\n                targetIndex = dropZone.children.findIndex((e) => e === element);\n                if (!before) {\n                    ++targetIndex;\n                }\n            }\n            else {\n                console.log('DropMarker:dragOver unhandled path');\n            }\n        }\n        if (notNullOrUndefined(nextStyle)) {\n            forEach(Object.keys(nextStyle), (key) => {\n                if (style[key] !== nextStyle[key]) {\n                    setStyle(nextStyle);\n                    return 'break';\n                }\n            });\n        }\n        if (r.targetIndex !== targetIndex) {\n            r.targetIndex = targetIndex;\n            onDropPosition({ targetIndex });\n        }\n    }\n}\nDropMarker.defaultProps = {\n    onDropPosition: foo\n};\nexport default DropMarker;\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n// TODO: Duplicated from studio-ui. Need to pull from studio ui when published.\nconst palette = {\n    white: '#fff',\n    black: '#000',\n    blue: { tint: '#409CFF', main: '#007AFF', shade: '#0040DD', highlight: '#E6F2FF' },\n    green: { tint: '#30DB5B', main: '#34C759', shade: '#248A3D' },\n    indigo: { tint: '#7D7AFF', main: '#5856D6', shade: '#3634A3' },\n    orange: { tint: '#FFB340', main: '#FF9500', shade: '#C93400' },\n    pink: { tint: '#FF6482', main: '#FF2D55', shade: '#D30F45' },\n    purple: { tint: '#DA8FFF', main: '#AF52DE', shade: '#8944AB' },\n    red: { tint: '#FF6961', main: '#FF3B30', shade: '#D70015', highlight: '#FFEBEA' },\n    teal: { tint: '#70D7FF', main: '#5AC8FA', shade: '#0071A4' },\n    yellow: { tint: '#FFD426', main: '#FFCC00', shade: '#A05A00' },\n    gray: {\n        light0: '#FAFAFA',\n        light1: '#F3F3F3',\n        light2: '#F2F2F7',\n        light3: '#EBEBF0',\n        light4: '#E5E5EA',\n        light5: '#D8D8DC',\n        light6: '#D1D1D6',\n        light7: '#C7C7CC',\n        medium1: '#BCBCC0',\n        medium2: '#AEAEB2',\n        medium3: '#8E8E93',\n        medium4: '#7C7C80',\n        medium5: '#6C6C70',\n        medium6: '#636366',\n        medium7: '#545456',\n        dark1: '#48484A',\n        dark2: '#444446',\n        dark3: '#3A3A3C',\n        dark4: '#363638',\n        dark5: '#2C2C2E',\n        dark6: '#242426',\n        dark7: '#1C1C1E'\n    }\n};\nexport default palette;\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport palette from './palette';\nconst getAllGuestRules = () => {\n    const rules = {\n        '[draggable=\"true\"]': undefined,\n        'craftercms-asset-uploader-mask': undefined,\n        'craftercms-asset-uploader-mask-container': undefined,\n        'craftercms-dragged-element': undefined,\n        'craftercms-drop-marker': undefined,\n        'craftercms-field-instance-switcher': undefined,\n        'craftercms-snackbar': undefined,\n        'craftercms-zone-marker': undefined,\n        'craftercms-zone-marker-label': undefined,\n        '.craftercms-content-tree-locate': undefined,\n        '.craftercms-ice-on': undefined,\n        '.craftercms-placeholder-spinner': undefined,\n        '.craftercms-required-validation-failed': undefined,\n        '.craftercms-suggestion-validation-failed': undefined,\n        '.craftercms-zone-marker-label__multi-mode': undefined,\n        '.mce-content-body': undefined,\n        '@keyframes craftercms-content-tree-locate-animation': undefined,\n        '@keyframes craftercms-placeholder-animation': undefined,\n        '@keyframes craftercms-placeholder-inner-animation': undefined,\n        '@keyframes craftercms-uploader-mask-animation': undefined\n    };\n    return Object.keys(rules);\n};\nconst defaults = {\n    styles: undefined,\n    assetUploadMaskZIndex: 1010,\n    assetUploadMaskBackgroundColor: 'white',\n    dropMarkerZIndex: 1010,\n    dropMarkerColor: palette.blue.main,\n    snackBarZIndex: 1010,\n    snackBarBackgroundColor: 'rgb(49, 49, 49)',\n    zoneLabelZIndex: 1010,\n    zoneLabelTextColor: '#00270b',\n    zoneLabelBackground: 'linear-gradient(to bottom, rgba(48,219,91,0.8) 0%, rgba(52,199,89,0.8) 100%)',\n    zoneMarkerZIndex: 1010,\n    zoneMarkerOutlineColor: palette.green.main,\n    inlineTextEditorOutlineColor: palette.blue.tint,\n    inlineTextEditorFocusOutlineColor: palette.blue.main,\n    validationMandatoryColor: palette.red.main,\n    validationSuggestedColor: palette.orange.main\n};\nfunction collectRules(styles) {\n    const overrides = {}, global = {}, other = {};\n    const toBeReturned = { overrides, global, other };\n    if (!styles) {\n        return toBeReturned;\n    }\n    const allRules = getAllGuestRules();\n    Object.entries(styles).forEach(([rule, body]) => {\n        if (rule === '@global') {\n            Object.entries(body).forEach(([globalRule, globalRuleBody]) => {\n                if (allRules.includes(globalRule)) {\n                    overrides[globalRule] = globalRuleBody;\n                }\n                else {\n                    global[globalRule] = globalRuleBody;\n                }\n            });\n        }\n        else {\n            other[rule] = body;\n        }\n    });\n    return toBeReturned;\n}\nexport default function stylesheet(config) {\n    var _a, _b, _c, _d;\n    config = Object.assign({}, defaults, config);\n    const { overrides, global, other } = collectRules(config.styles);\n    const styles = Object.assign({ \n        // Attributes\n        '[draggable=\"true\"]': Object.assign({ cursor: 'move !important' }, overrides['[draggable=\"true\"]']), \n        // Elements\n        'craftercms-asset-uploader-mask-container': Object.assign({ zIndex: config.assetUploadMaskZIndex, position: 'absolute', pointerEvents: 'none' }, overrides['craftercms-asset-uploader-mask-container']), 'craftercms-asset-uploader-mask': Object.assign({ background: config.assetUploadMaskBackgroundColor, opacity: 0.5, height: '100%', width: '100%', display: 'block', transition: 'height 0.3s ease-out', animation: 'craftercms-uploader-mask-animation 1.5s infinite ease-in-out' }, overrides['craftercms-asset-uploader-mask']), 'craftercms-zone-marker': Object.assign({ boxSizing: 'border-box', outline: `2px solid ${config.zoneMarkerOutlineColor}`, outlineOffset: '-2px', textAlign: 'center', position: 'absolute', zIndex: config.zoneMarkerZIndex, pointerEvents: 'none' }, overrides['craftercms-zone-marker']), 'craftercms-zone-marker-label': Object.assign({ boxSizing: 'border-box', background: config.zoneLabelBackground, color: config.zoneLabelTextColor, padding: '10px', borderRadius: 10, display: 'flex', justifyContent: 'center', alignItems: 'center', fontSize: '14px', position: 'fixed', top: '1em', left: '50%', right: '0', marginLeft: '-150px', textAlign: 'center', minWidth: '300px', maxWidth: '300px', overflow: 'hidden', fontWeight: 700, pointerEvents: 'none', zIndex: config.zoneLabelZIndex, boxShadow: `0 2px 4px -1px rgba(0,0,0,0.2), 0 4px 5px 0 rgba(0,0,0,0.14), 0 1px 10px 0 rgba(0,0,0,0.12)` }, overrides['craftercms-zone-marker-label']), 'craftercms-drop-marker': Object.assign({ zIndex: config.dropMarkerZIndex, position: 'fixed', pointerEvents: 'none', '&::before, &::after': {\n                content: '\"\"',\n                width: '8px',\n                height: '8px',\n                background: config.dropMarkerColor,\n                borderRadius: '8px',\n                marginTop: '-3px',\n                marginLeft: '-4.5px',\n                position: 'absolute'\n            }, '&.horizontal': {\n                height: 2,\n                visibility: 'visible',\n                background: config.dropMarkerColor,\n                boxShadow: '0 1px 2px rgba(255, 255, 255, .4),  0 -1px 2px rgba(255, 255, 255, .4)',\n                '&::before': {\n                    left: 0\n                },\n                '&::after': {\n                    right: 0\n                }\n            }, '&.vertical': {\n                width: 2,\n                minHeight: '5px',\n                marginLeft: '3px',\n                border: `1px solid ${config.dropMarkerColor}`,\n                boxShadow: '1px 0 2px rgba(255, 255, 255, .4),  -1px 0 2px rgba(255, 255, 255, .4)',\n                '&::before': {\n                    top: 0\n                },\n                '&::after': {\n                    bottom: -4\n                }\n            } }, overrides['craftercms-drop-marker']), 'craftercms-snackbar': Object.assign({ top: 10, right: 10, position: 'fixed', color: '#fff', display: 'flex', padding: '15px 20px', flexGrow: 1, flexWrap: 'wrap', fontSize: '0.875rem', alignItems: 'center', fontFamily: '\"Source Sans Pro\", \"Open Sans\", sans-serif', fontWeight: 400, lineHeight: 1.43, borderRadius: '4px', backgroundColor: config.snackBarBackgroundColor, minWidth: '288px', transform: 'none', transition: 'transform 225ms cubic-bezier(0, 0, 0.2, 1) 0ms', boxShadow: '0 3px 5px -1px rgba(0, 0, 0, 0.2), 0 6px 10px 0 rgba(0, 0, 0, 0.14), 0 1px 18px 0 rgba(0, 0, 0, 0.12)', zIndex: config.snackBarZIndex }, overrides['craftercms-snackbar']), 'craftercms-dragged-element': Object.assign({ display: 'block', maxWidth: 200, backgroundColor: '#fff', color: palette.gray.medium4, padding: '5px 10px', borderRadius: 10, whiteSpace: 'nowrap', textOverflow: 'ellipsis', overflow: 'hidden', position: 'absolute', top: -100 }, overrides['craftercms-dragged-element']), 'craftercms-field-instance-switcher': {\n            position: 'fixed',\n            bottom: '10px',\n            right: '10px',\n            backgroundColor: palette.white,\n            boxShadow: '0 2px 1px -1px rgba(0,0,0,0.2), 0 1px 1px 0 rgba(0,0,0,0.14), 0 1px 3px 0 rgba(0,0,0,0.12)',\n            padding: '10px 14px',\n            color: palette.black,\n            display: 'flex',\n            alignItems: 'center',\n            zIndex: 2,\n            '& .disable': {\n                pointerEvents: 'none',\n                opacity: '0.5'\n            },\n            '& i': {\n                display: 'inherit',\n                padding: '2px',\n                cursor: 'pointer'\n            },\n            '& svg': {\n                fill: 'currentColor',\n                width: '1em',\n                height: '1em',\n                display: 'inline-block',\n                fontSize: '1.5rem',\n                transition: 'fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms',\n                flexShrink: 0,\n                userSelect: 'none'\n            }\n        }, \n        // Classes\n        '.craftercms-zone-marker-icon': {\n            marginLeft: '10px'\n        }, '.craftercms-required-validation-failed': Object.assign({ outlineColor: config.validationMandatoryColor, '& craftercms-zone-marker-label': {\n                background: config.validationMandatoryColor\n            } }, overrides['.craftercms-required-validation-failed']), '.craftercms-suggestion-validation-failed': Object.assign({ outlineColor: config.validationSuggestedColor, '& craftercms-zone-marker-label': {\n                background: config.validationSuggestedColor\n            } }, overrides['.craftercms-suggestion-validation-failed']), '.craftercms-placeholder-spinner': Object.assign({ animation: 'craftercms-placeholder-animation 2s linear infinite', '& .path': {\n                stroke: palette.blue.main,\n                animation: 'craftercms-placeholder-inner-animation 1.5s ease-in-out infinite'\n            } }, overrides['.craftercms-placeholder-spinner']), '.craftercms-content-tree-locate': Object.assign({ animation: 'craftercms-content-tree-locate-animation 300ms 2 ease-in-out' }, overrides['.craftercms-content-tree-locate']), '.craftercms-zone-marker-label__multi-mode': Object.assign({ background: config.zoneMarkerOutlineColor, top: 0, left: 'auto', right: 0, minWidth: 0, marginLeft: 0, position: 'absolute', padding: '2px 10px', borderRadius: 0, boxShadow: 'none', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }, overrides['.craftercms-zone-marker-label__multi-mode']), '.craftercms-ice-on': overrides['.craftercms-ice-on'], '.mce-content-body': Object.assign({ outlineOffset: 5, outline: `2px solid ${config.inlineTextEditorOutlineColor}`, '&:focus': {\n                outline: `5px solid ${config.inlineTextEditorFocusOutlineColor}`\n            } }, overrides['[data-craftercms-model-id][contentEditable=\"true\"]']), \n        // Keyframes\n        '@keyframes craftercms-uploader-mask-animation': (_a = overrides['@keyframes craftercms-uploader-mask-animation']) !== null && _a !== void 0 ? _a : {\n            '0%': {\n                opacity: 0.4\n            },\n            '50%': {\n                opacity: 0.5\n            },\n            '100%': {\n                opacity: 0.4\n            }\n        }, '@keyframes craftercms-placeholder-animation': (_b = overrides['@keyframes craftercms-placeholder-animation']) !== null && _b !== void 0 ? _b : {\n            '100%': { transform: 'rotate(360deg)' }\n        }, '@keyframes craftercms-placeholder-inner-animation': (_c = overrides['@keyframes craftercms-placeholder-inner-animation']) !== null && _c !== void 0 ? _c : {\n            '0%': { strokeDasharray: '1, 150', strokeDashoffset: '0' },\n            '50%': { strokeDasharray: '90, 150', strokeDashoffset: '-35' },\n            '100%': { strokeDasharray: '90, 150', strokeDashoffset: '-124' }\n        }, '@keyframes craftercms-content-tree-locate-animation': (_d = overrides['@keyframes craftercms-content-tree-locate-animation']) !== null && _d !== void 0 ? _d : {\n            '0%': {\n                transform: 'scaleX(1)'\n            },\n            '50%': {\n                transform: 'scale3d(1.05,1.05,1.05)'\n            },\n            to: {\n                transform: 'scaleX(1)'\n            }\n        } }, global);\n    return Object.assign({ '@global': styles }, other);\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport jss from 'jss';\nimport preset from 'jss-preset-default';\nimport stylesheet from './stylesheet';\nexport function appendStyleSheet(config) {\n    jss.setup(preset());\n    const sheet = jss.createStyleSheet(stylesheet(config));\n    sheet.attach();\n    return sheet;\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport React, { useEffect, useState } from 'react';\nimport { getZoneMarkerStyle } from '../utils/dom';\nexport function AssetUploaderMask(props) {\n    const { rect, progress } = props, [zoneStyle, setZoneStyle] = useState();\n    useEffect(() => {\n        setZoneStyle(getZoneMarkerStyle(rect));\n    }, [rect]);\n    return (React.createElement(\"craftercms-asset-uploader-mask-container\", { style: zoneStyle },\n        React.createElement(\"craftercms-asset-uploader-mask\", { style: { height: `${100 - progress}%` } })));\n}\nexport default AssetUploaderMask;\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { EditingStatus } from '../constants';\nexport function dragOk(status) {\n    return [\n        EditingStatus.SORTING_COMPONENT,\n        EditingStatus.PLACING_NEW_COMPONENT,\n        EditingStatus.PLACING_DETACHED_ASSET,\n        EditingStatus.PLACING_DETACHED_COMPONENT,\n        EditingStatus.UPLOAD_ASSET_FROM_DESKTOP\n    ].includes(status);\n}\nexport function unwrapEvent(event) {\n    var _a, _b;\n    // @ts-ignore\n    return (_b = (_a = event === null || event === void 0 ? void 0 : event.originalEvent) !== null && _a !== void 0 ? _a : event === null || event === void 0 ? void 0 : event.nativeEvent) !== null && _b !== void 0 ? _b : event;\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { fromEvent, merge, Subject } from 'rxjs';\nimport { debounceTime, filter, map, share, takeUntil, throttleTime, withLatestFrom } from 'rxjs/operators';\nexport const clearAndListen$ = new Subject();\nexport const escape$ = fromEvent(document, 'keydown').pipe(filter((e) => e.key === 'Escape'));\nlet active = false;\nlet dragover$;\nconst getDragOver = () => dragover$;\nlet killSignal$;\nlet scrolling$;\nconst getScrolling = () => scrolling$;\nexport { getDragOver as dragover$, getScrolling as scrolling$ };\nexport function initializeDragSubjects(state$) {\n    if (!active) {\n        active = true;\n        killSignal$ = new Subject();\n        dragover$ = new Subject();\n        scrolling$ = fromEvent(document, 'scroll').pipe(takeUntil(killSignal$), share());\n    }\n    return merge(dragover$.pipe(throttleTime(100), map((payload) => ({ type: 'computed_dragover', payload }))), scrolling$.pipe(throttleTime(200), withLatestFrom(state$), filter(([, state]) => { var _a; return !((_a = state.dragContext) === null || _a === void 0 ? void 0 : _a.scrolling); }), map(() => ({ type: 'scrolling' }))), \n    // Scrolling ended\n    scrolling$.pipe(\n    // Emit values from scroll$ only after 200ms have\n    // passed without another source emission should give\n    // us the end of scrolling.\n    debounceTime(200), map(() => ({ type: 'scrolling_stopped' }))));\n}\nexport function destroyDragSubjects() {\n    if (active) {\n        active = false;\n        // scrolling$ is terminated by killSignal$\n        killSignal$.next();\n        killSignal$.complete();\n        killSignal$.unsubscribe();\n        killSignal$ = null;\n        dragover$.complete();\n        dragover$.unsubscribe();\n        dragover$ = null;\n    }\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport * as iceRegistry from '../classes/ICERegistry';\nimport * as contentController from '../classes/ContentController';\nimport { post } from '../utils/communicator';\nimport { Subject } from 'rxjs';\nimport { startWith } from 'rxjs/operators';\nimport $ from 'jquery';\nexport function initTinyMCE(record, validations) {\n    const dispatch$ = new Subject();\n    const { field } = iceRegistry.getReferentialEntries(record.iceIds[0]);\n    const type = field === null || field === void 0 ? void 0 : field.type;\n    const plugins = ['paste'];\n    type === 'html' && plugins.push('quickbars');\n    const elementDisplay = $(record.element).css('display');\n    if (elementDisplay === 'inline') {\n        $(record.element).css('display', 'inline-block');\n    }\n    window.tinymce.init({\n        mode: 'none',\n        target: record.element,\n        // For some reason this is not working.\n        // body_class: 'craftercms-rich-text-editor',\n        plugins,\n        paste_as_text: true,\n        toolbar: false,\n        menubar: false,\n        inline: true,\n        base_url: '/studio/static-assets/modules/editors/tinymce/v5/tinymce',\n        suffix: '.min',\n        setup(editor) {\n            editor.on('init', function () {\n                let changed = false;\n                let originalContent = getContent();\n                editor.focus(false);\n                editor.selection.select(editor.getBody(), true);\n                editor.selection.collapse(false);\n                // In some cases the 'blur' event is getting caught somewhere along\n                // the way. Focusout seems to be more reliable.\n                editor.on('focusout', (e) => {\n                    if (!e.relatedTarget) {\n                        if ((validations === null || validations === void 0 ? void 0 : validations.required) && !getContent().trim()) {\n                            post({\n                                type: 'VALIDATION_MESSAGE',\n                                payload: {\n                                    id: 'required',\n                                    level: 'required',\n                                    values: { field: record.label }\n                                }\n                            });\n                            editor.setContent(originalContent);\n                        }\n                        else {\n                            save();\n                        }\n                        e.stopImmediatePropagation();\n                        cancel();\n                    }\n                });\n                editor.once('change', () => {\n                    changed = true;\n                });\n                editor.on('keydown', (e) => {\n                    if (e.key === 'Escape') {\n                        e.stopImmediatePropagation();\n                        editor.setContent(originalContent);\n                        cancel();\n                    }\n                    else if (e.key === 'Enter') {\n                        editor.fire('focusout');\n                    }\n                    else if ((validations === null || validations === void 0 ? void 0 : validations.maxLength) &&\n                        // TODO: Check/improve regex\n                        /[a-zA-Z0-9-_ ]/.test(String.fromCharCode(e.keyCode)) &&\n                        getContent().length + 1 > parseInt(validations.maxLength.value)) {\n                        post({\n                            type: 'VALIDATION_MESSAGE',\n                            payload: {\n                                id: 'maxLength',\n                                level: 'required',\n                                values: { maxLength: validations.maxLength.value }\n                            }\n                        });\n                        e.stopPropagation();\n                        return false;\n                    }\n                });\n                function save() {\n                    const content = getContent();\n                    if (changed) {\n                        contentController.updateField(record.modelId, record.fieldId[0], record.index, content);\n                    }\n                }\n                function getContent() {\n                    return type === 'html' ? editor.getContent() : editor.getContent({ format: 'text' });\n                }\n                function destroyEditor() {\n                    editor.destroy(false);\n                }\n                function cancel() {\n                    const content = getContent();\n                    destroyEditor();\n                    // In case the user did some text bolding or other formatting which won't\n                    // be honoured on plain text, revert the content to the edited plain text\n                    // version of the input.\n                    changed && type === 'text' && $(record.element).html(content);\n                    if (elementDisplay === 'inline') {\n                        $(record.element).css('display', '');\n                    }\n                    dispatch$.next({ type: 'exit_component_inline_edit' });\n                    dispatch$.complete();\n                    dispatch$.unsubscribe();\n                }\n            });\n        }\n    });\n    return dispatch$.pipe(startWith({ type: 'edit_component_inline' }));\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { combineEpics, ofType } from 'redux-observable';\nimport { filter, ignoreElements, map, mapTo, switchMap, take, takeUntil, tap, withLatestFrom } from 'rxjs/operators';\nimport { not } from '../../utils/util';\nimport { post } from '../../utils/communicator';\nimport * as iceRegistry from '../../classes/ICERegistry';\nimport { dragOk, unwrapEvent } from '../util';\nimport * as contentController from '../../classes/ContentController';\nimport { merge, NEVER, of, Subject } from 'rxjs';\nimport { clearAndListen$, destroyDragSubjects, dragover$, escape$, initializeDragSubjects } from '../subjects';\nimport { initTinyMCE } from '../../controls/rte';\nimport { ASSET_DRAG_ENDED, ASSET_DRAG_STARTED, CLEAR_CONTENT_TREE_FIELD_SELECTED, CLEAR_SELECTED_ZONES, COMPONENT_DRAG_ENDED, COMPONENT_DRAG_STARTED, COMPONENT_INSTANCE_DRAG_ENDED, COMPONENT_INSTANCE_DRAG_STARTED, CONTENT_TREE_FIELD_SELECTED, CONTENT_TREE_SWITCH_FIELD_INSTANCE, CONTENT_TYPE_DROP_TARGETS_REQUEST, CONTENT_TYPE_DROP_TARGETS_RESPONSE, DESKTOP_ASSET_DRAG_ENDED, DESKTOP_ASSET_DRAG_STARTED, DESKTOP_ASSET_DROP, DESKTOP_ASSET_UPLOAD_COMPLETE, DESKTOP_ASSET_UPLOAD_STARTED, EditingStatus, HighlightMode, ICE_ZONE_SELECTED, INSTANCE_DRAG_BEGUN, INSTANCE_DRAG_ENDED, TRASHED } from '../../constants';\nimport { isNullOrUndefined, notNullOrUndefined, pluckProps, reversePluckProps } from '../../utils/object';\nimport * as ElementRegistry from '../../classes/ElementRegistry';\nimport { get } from '../../classes/ElementRegistry';\nimport { scrollToElement, scrollToIceProps } from '../../utils/dom';\nconst epic = combineEpics.apply(this, [\n    function multiEventPropagationStopperEpic(action$, state$) {\n        return action$.pipe(ofType('mouseover', 'mouseleave'), withLatestFrom(state$), filter((args) => args[1].status === EditingStatus.LISTENING), tap(([action]) => action.payload.event.stopPropagation()), ignoreElements());\n    },\n    // region mouseover\n    // Propagation stopped by multiEventPropagationStopperEpic\n    // (action$: Action$, state$: State$) => {},\n    // endregion\n    // region mouseleave\n    // (action$: Action$, state$: State$) => {},\n    // endregion\n    // region dragstart\n    (action$, state$) => {\n        return action$.pipe(ofType('dragstart'), withLatestFrom(state$), switchMap(([action, state]) => {\n            var _a;\n            const { payload: { event, record } } = action;\n            const iceId = (_a = state.draggable) === null || _a === void 0 ? void 0 : _a[record.id];\n            if (isNullOrUndefined(iceId)) {\n                console.error('No ice id found for this drag instance.');\n            }\n            else if (not(iceId)) {\n                // Items that browser make draggable by default (images, etc)\n                console.warn(\"Element is draggable but wasn't set draggable by craftercms\");\n            }\n            else {\n                event.stopPropagation();\n                post({ type: INSTANCE_DRAG_BEGUN, payload: iceId });\n                const e = unwrapEvent(event);\n                e.dataTransfer.setData('text/plain', `${record.id}`);\n                const image = document.querySelector('craftercms-dragged-element');\n                e.dataTransfer.setDragImage(image, 20, 20);\n                return initializeDragSubjects(state$);\n            }\n            return NEVER;\n        }));\n    },\n    // endregion\n    // region dragover\n    (action$, state$) => {\n        return action$.pipe(ofType('dragover'), withLatestFrom(state$), tap(([action, state]) => {\n            var _a;\n            const { payload: { event, record } } = action;\n            let { element } = record;\n            if (dragOk(state.status) && !((_a = state.dragContext) === null || _a === void 0 ? void 0 : _a.scrolling) && state.dragContext.players.includes(element)) {\n                event.preventDefault();\n                event.stopPropagation();\n                dragover$().next({ event, record });\n            }\n        }), ignoreElements());\n    },\n    // endregion\n    // region dragleave\n    // (action$: Action$, state$: State$) => {},\n    // endregion\n    // region drop\n    (action$, state$) => {\n        return action$.pipe(ofType('drop'), withLatestFrom(state$), switchMap(([action, state]) => {\n            if (dragOk(state.status) && !state.dragContext.invalidDrop) {\n                const { payload: { event, record } } = action;\n                event.preventDefault();\n                event.stopPropagation();\n                const status = state.status;\n                const dragContext = state.dragContext;\n                switch (status) {\n                    case EditingStatus.PLACING_DETACHED_ASSET: {\n                        const { dropZone } = dragContext;\n                        if (dropZone && dragContext.inZone) {\n                            const record = iceRegistry.getById(dropZone.iceId);\n                            contentController.updateField(record.modelId, record.fieldId, record.index, dragContext.dragged.path);\n                        }\n                        break;\n                    }\n                    case EditingStatus.SORTING_COMPONENT: {\n                        if (notNullOrUndefined(dragContext.targetIndex)) {\n                            moveComponent(dragContext);\n                            // return of({ type: 'move_component' });\n                        }\n                        break;\n                    }\n                    case EditingStatus.PLACING_NEW_COMPONENT: {\n                        if (notNullOrUndefined(dragContext.targetIndex)) {\n                            const { targetIndex, contentType, dropZone } = dragContext;\n                            const record = iceRegistry.getById(dropZone.iceId);\n                            setTimeout(() => {\n                                contentController.insertComponent(record.modelId, record.fieldId, record.fieldId.includes('.') ? `${record.index}.${targetIndex}` : targetIndex, contentType);\n                            });\n                            // return of({ type: 'insert_component' });\n                        }\n                        break;\n                    }\n                    case EditingStatus.PLACING_DETACHED_COMPONENT: {\n                        if (notNullOrUndefined(dragContext.targetIndex)) {\n                            const { targetIndex, instance, dropZone } = dragContext;\n                            const record = iceRegistry.getById(dropZone.iceId);\n                            setTimeout(() => {\n                                contentController.insertInstance(record.modelId, record.fieldId, record.fieldId.includes('.') ? `${record.index}.${targetIndex}` : targetIndex, instance);\n                            });\n                            // return of({ type: 'insert_instance' });\n                        }\n                        break;\n                    }\n                    case EditingStatus.UPLOAD_ASSET_FROM_DESKTOP: {\n                        if (dragContext.inZone) {\n                            const file = unwrapEvent(event).dataTransfer.files[0];\n                            const stream$ = new Subject();\n                            const reader = new FileReader();\n                            reader.onload = ((aImg) => (event) => {\n                                post(DESKTOP_ASSET_DROP, {\n                                    dataUrl: event.target.result,\n                                    name: file.name,\n                                    type: file.type,\n                                    record: reversePluckProps(record, 'element')\n                                });\n                                aImg.src = event.target.result;\n                                // Timeout gives the browser a chance to render the image so later rect\n                                // calculations are working with the updated paint.\n                                setTimeout(() => {\n                                    stream$.next({ type: DESKTOP_ASSET_UPLOAD_STARTED, payload: { record } });\n                                    stream$.complete();\n                                    stream$.unsubscribe();\n                                });\n                            })(record.element);\n                            reader.readAsDataURL(file);\n                            return stream$;\n                        }\n                        break;\n                    }\n                }\n            }\n            return NEVER;\n        }));\n    },\n    // endregion\n    // region dragend\n    (action$, state$) => {\n        return action$.pipe(ofType('dragend'), withLatestFrom(state$), switchMap(([action, state]) => {\n            if (dragOk(state.status)) {\n                action.payload.event.stopPropagation();\n                post({ type: INSTANCE_DRAG_ENDED });\n                return of({ type: 'computed_dragend' });\n            }\n            return NEVER;\n        }));\n    },\n    // endregion\n    // region dragend_listener\n    (action$) => {\n        return action$.pipe(ofType(ASSET_DRAG_ENDED, COMPONENT_DRAG_ENDED, COMPONENT_INSTANCE_DRAG_ENDED, DESKTOP_ASSET_DRAG_ENDED), map(() => ({ type: 'computed_dragend' })));\n    },\n    // endregion\n    // region click\n    (action$, state$) => {\n        return action$.pipe(ofType('click'), withLatestFrom(state$), filter(([, state]) => state.status === EditingStatus.LISTENING), switchMap(([action, state]) => {\n            var _a;\n            const { record } = action.payload;\n            const { field } = iceRegistry.getReferentialEntries(record.iceIds[0]);\n            const draggable = ElementRegistry.getDraggable(record.id);\n            const validations = field === null || field === void 0 ? void 0 : field.validations;\n            const type = field === null || field === void 0 ? void 0 : field.type;\n            const iceZoneSelected = () => {\n                post(ICE_ZONE_SELECTED, pluckProps(record, 'modelId', 'index', 'fieldId'));\n                return merge(escape$.pipe(takeUntil(clearAndListen$), tap(() => post(CLEAR_SELECTED_ZONES)), map(() => ({ type: 'start_listening' })), take(1)), of({ type: 'ice_zone_selected', payload: action.payload }));\n            };\n            if (state.highlightMode === HighlightMode.ALL) {\n                switch (type) {\n                    case 'html':\n                    case 'text':\n                    case 'textarea': {\n                        if (!window.tinymce) {\n                            alert('Looks like tinymce is not added on the page. ' +\n                                'Please add tinymce on to the page to enable editing.');\n                        }\n                        else if (not((_a = validations === null || validations === void 0 ? void 0 : validations.readOnly) === null || _a === void 0 ? void 0 : _a.value)) {\n                            return initTinyMCE(record, validations);\n                        }\n                        return NEVER;\n                    }\n                    default: {\n                        return iceZoneSelected();\n                    }\n                }\n            }\n            else if (draggable) {\n                return iceZoneSelected();\n            }\n            else {\n                return NEVER;\n            }\n        }));\n    },\n    // endregion\n    // region dblclick\n    // (action$: Action$, state$: State$) => {},\n    // endregion\n    // region computed_dragend\n    (action$, state$) => {\n        return action$.pipe(ofType('computed_dragend'), tap(() => destroyDragSubjects()), ignoreElements());\n    },\n    // endregion\n    // region Desktop Asset Upload (Complete)\n    (action$) => {\n        return action$.pipe(ofType(DESKTOP_ASSET_UPLOAD_COMPLETE), tap((action) => {\n            const { record, path } = action.payload;\n            contentController.updateField(record.modelId, record.fieldId[0], record.index, path);\n        }), ignoreElements());\n    },\n    // endregion\n    // region Desktop Asset Upload (Progress)\n    // (action$: Action$, state$: State$) => {},\n    // endregion\n    // region Desktop Asset Upload (Started)\n    // dropEpic does what these would\n    // (action$: Action$, state$: State$) => {},\n    // endregion\n    // region content_type_drop_targets_request\n    (action$) => {\n        return action$.pipe(ofType(CONTENT_TYPE_DROP_TARGETS_REQUEST), tap((action) => {\n            const { contentTypeId } = action.payload;\n            const dropTargets = iceRegistry.getContentTypeDropTargets(contentTypeId).map((item) => {\n                let { elementRecordId } = ElementRegistry.compileDropZone(item.id);\n                let highlight = ElementRegistry.getHoverData(elementRecordId);\n                return {\n                    modelId: item.modelId,\n                    fieldId: item.fieldId,\n                    label: highlight.label,\n                    id: item.id,\n                    contentTypeId\n                };\n            });\n            post({\n                type: CONTENT_TYPE_DROP_TARGETS_RESPONSE,\n                payload: { contentTypeId, dropTargets }\n            });\n        }), ignoreElements());\n    },\n    // endregion\n    // region Start listening\n    (action$) => {\n        return action$.pipe(ofType('start_listening'), tap(() => post(CLEAR_SELECTED_ZONES)), ignoreElements());\n    },\n    // endregion\n    // region TRASHED\n    (action$) => {\n        // onDrop doesn't execute when trashing on host side\n        // Consider behaviour when running Host Guest-side\n        return action$.pipe(ofType(TRASHED), tap((action) => {\n            const { iceId } = action.payload;\n            let { modelId, fieldId, index } = iceRegistry.getById(iceId);\n            contentController.deleteItem(modelId, fieldId, index);\n            post({ type: INSTANCE_DRAG_ENDED });\n        }), \n        // There's a raise condition where sometimes the dragend is\n        // fired and sometimes is not upon dropping on the rubbish bin.\n        // Manually firing here may incur in double firing of computed_dragend\n        // in those occasions.\n        mapTo({ type: 'computed_dragend' }));\n    },\n    // endregion\n    // region drop_zone_enter\n    (action$, state$) => {\n        // onDrop doesn't execute when trashing on host side\n        // Consider behaviour when running Host Guest-side\n        return action$.pipe(ofType('drop_zone_enter'), withLatestFrom(state$), tap(([action, state]) => {\n            const { elementRecordId } = action.payload;\n            const { validations } = state.dragContext.dropZones.find((dropZone) => dropZone.elementRecordId === elementRecordId);\n            Object.values(validations).forEach((validation) => {\n                post({ type: 'VALIDATION_MESSAGE', payload: validation });\n            });\n        }), ignoreElements());\n    },\n    // endregion\n    // region drop_zone_leave\n    (action$, state$) => {\n        return action$.pipe(ofType('drop_zone_leave'), withLatestFrom(state$), tap(([action, state]) => {\n            if (!state.dragContext) {\n                return;\n            }\n            const { elementRecordId } = action.payload;\n            const { validations } = state.dragContext.dropZones.find((dropZone) => dropZone.elementRecordId === elementRecordId);\n            if (validations.minCount) {\n                post({ type: INSTANCE_DRAG_ENDED });\n            }\n            Object.values(validations).forEach((validation) => {\n                // We dont want to show a validation message for maxCount on Leaving Dropzone\n                if (validations.maxCount) {\n                    return;\n                }\n                post({ type: 'VALIDATION_MESSAGE', payload: validation });\n            });\n        }), ignoreElements());\n    },\n    // endregion\n    // region hostComponentDragStarted\n    (action$, state$) => {\n        return action$.pipe(ofType(COMPONENT_DRAG_STARTED), withLatestFrom(state$), switchMap(([action, state]) => {\n            const contentType = state.dragContext.contentType;\n            if (isNullOrUndefined(contentType.id)) {\n                console.error('No contentTypeId found for this drag instance.');\n            }\n            else {\n                if (state.dragContext.dropZones.length === 0) {\n                    post({\n                        type: 'VALIDATION_MESSAGE',\n                        payload: {\n                            id: 'dropTargetsNotFound',\n                            level: 'info',\n                            values: { contentType: state.dragContext.contentType.name }\n                        }\n                    });\n                }\n                return initializeDragSubjects(state$);\n            }\n            return NEVER;\n        }));\n    },\n    // endregion\n    // region host_instance_drag_started\n    (action$, state$) => {\n        return action$.pipe(ofType(COMPONENT_INSTANCE_DRAG_STARTED), withLatestFrom(state$), switchMap(([action, state]) => {\n            if (isNullOrUndefined(state.dragContext.instance.craftercms.contentTypeId)) {\n                console.error('No contentTypeId found for this drag instance.');\n            }\n            else {\n                if (state.dragContext.dropZones.length === 0) {\n                    post({\n                        type: 'VALIDATION_MESSAGE',\n                        payload: {\n                            id: 'dropTargetsNotFound',\n                            level: 'info',\n                            values: { contentType: state.dragContext.contentType.name }\n                        }\n                    });\n                }\n                return initializeDragSubjects(state$);\n            }\n            return NEVER;\n        }));\n    },\n    // endregion\n    // region asset_drag_started\n    (action$, state$) => {\n        return action$.pipe(ofType(ASSET_DRAG_STARTED), withLatestFrom(state$), switchMap(([action, state]) => {\n            if (isNullOrUndefined(state.dragContext.dragged.path)) {\n                console.error('No path found for this drag asset.');\n            }\n            else {\n                return initializeDragSubjects(state$);\n            }\n            return NEVER;\n        }));\n    },\n    // endregion\n    // region desktop_asset_drag_started\n    (action$, state$) => {\n        return action$.pipe(ofType(DESKTOP_ASSET_DRAG_STARTED), withLatestFrom(state$), switchMap(([action, state]) => {\n            if (isNullOrUndefined(state.dragContext.dragged)) {\n                console.error('No file found for this drag asset.');\n            }\n            else {\n                return initializeDragSubjects(state$);\n            }\n            return NEVER;\n        }));\n    },\n    // endregion\n    // region content_tree_field_selected\n    (action$) => {\n        return action$.pipe(ofType(CONTENT_TREE_FIELD_SELECTED), switchMap((action) => {\n            const { iceProps, scrollElement, name } = action.payload;\n            if (scrollToIceProps(iceProps, scrollElement)) {\n                return escape$.pipe(takeUntil(clearAndListen$), map(() => ({ type: CLEAR_CONTENT_TREE_FIELD_SELECTED })), take(1));\n            }\n            else {\n                post({\n                    type: 'VALIDATION_MESSAGE',\n                    payload: { id: 'registerNotFound', level: 'suggestion', values: { name } }\n                });\n                return NEVER;\n            }\n        }));\n    },\n    (action$, state$) => {\n        return action$.pipe(ofType(CONTENT_TREE_SWITCH_FIELD_INSTANCE), withLatestFrom(state$), tap(([action, state]) => {\n            const { scrollElement } = action.payload;\n            let registryEntryId = state.fieldSwitcher.registryEntryIds[state.fieldSwitcher.currentElement];\n            scrollToElement(get(registryEntryId).element, scrollElement);\n        }), ignoreElements());\n    }\n    // endregion\n    // region ice_zone_selected\n    // endregion\n]);\nexport default epic;\nconst moveComponent = (dragContext) => {\n    let { dragged, dropZone, dropZones, targetIndex } = dragContext, record = dragged, draggedElementIndex = record.index, originDropZone = dropZones.find((dropZone) => dropZone.origin), currentDZ = dropZone.element;\n    if (typeof draggedElementIndex === 'string') {\n        // If the index is a string, it's a nested index with dot notation.\n        // At this point, we only care for the last index piece, which is\n        // the index of this item in the collection that's being manipulated.\n        draggedElementIndex = parseInt(draggedElementIndex.substr(draggedElementIndex.lastIndexOf('.') + 1), 10);\n    }\n    const containerRecord = iceRegistry.getById(originDropZone.iceId);\n    // Determine whether the component is to be sorted or moved.\n    if (currentDZ === originDropZone.element) {\n        // Same drop zone: Sort identified\n        // If moving the item down the array of items, need to account\n        // for all the originally subsequent items shifting up.\n        if (draggedElementIndex < targetIndex) {\n            // Hence the final target index in reality is\n            // the drop marker's index minus 1\n            --targetIndex;\n        }\n        if (draggedElementIndex !== targetIndex) {\n            setTimeout(() => {\n                contentController.sortItem(containerRecord.modelId, containerRecord.fieldId, containerRecord.fieldId.includes('.')\n                    ? `${containerRecord.index}.${draggedElementIndex}`\n                    : draggedElementIndex, containerRecord.fieldId.includes('.') ? `${containerRecord.index}.${targetIndex}` : targetIndex);\n            });\n        }\n    }\n    else {\n        // Different drop zone: Move identified\n        const rec = iceRegistry.getById(dropZone.iceId);\n        // Chrome didn't trigger the dragend event\n        // without the set timeout.\n        setTimeout(() => {\n            contentController.moveItem(containerRecord.modelId, containerRecord.fieldId, containerRecord.fieldId.includes('.') ? `${containerRecord.index}.${draggedElementIndex}` : draggedElementIndex, rec.modelId, rec.fieldId, rec.fieldId.includes('.') ? `${rec.index}.${targetIndex}` : targetIndex);\n        }, 20);\n    }\n};\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { createEpicMiddleware } from 'redux-observable';\nimport { configureStore, getDefaultMiddleware } from '@reduxjs/toolkit';\nimport epic from './epics/root';\nimport reducer from './reducers/root';\nimport { Observable } from 'rxjs';\nimport { distinctUntilChanged, pluck, share } from 'rxjs/operators';\nlet store;\nexport function createGuestStore() {\n    if (store) {\n        return store;\n    }\n    const epicMiddleware = createEpicMiddleware();\n    const middleware = [\n        ...getDefaultMiddleware({\n            thunk: false,\n            // serializable is not good companion while we have\n            // non-serializable values on the state (elements).\n            serializableCheck: false,\n            // immutable is causing max stack issues, probably also due\n            // to the non-serializable values on the state.\n            immutableCheck: false\n        }),\n        epicMiddleware\n    ];\n    store = configureStore({\n        reducer,\n        middleware,\n        devTools: { name: 'Guest Store' }\n        // devTools: process.env.NODE_ENV === 'production' ? false : { name: 'Guest Store' }\n    });\n    epicMiddleware.run(epic);\n    return store;\n}\nexport default createGuestStore;\nexport const state$ = new Observable((subscriber) => {\n    const store = createGuestStore();\n    return store.subscribe(() => {\n        const state = store.getState();\n        subscriber.next(state.models);\n    });\n}).pipe(share());\nexport const models$ = state$.pipe(pluck('content'), distinctUntilChanged());\nexport const contentTypes$ = state$.pipe(pluck('contentTypes'), distinctUntilChanged());\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport * as ElementRegistry from '../../classes/ElementRegistry';\nimport { getDragContextFromDropTargets, getHighlighted, getRecordsFromIceId } from '../../classes/ElementRegistry';\nimport { dragOk } from '../util';\nimport * as iceRegistry from '../../classes/ICERegistry';\nimport { createReducer } from '@reduxjs/toolkit';\nimport { notNullOrUndefined, reversePluckProps } from '../../utils/object';\nimport { updateDropZoneValidations } from '../../utils/dom';\nimport { ASSET_DRAG_ENDED, ASSET_DRAG_STARTED, CLEAR_CONTENT_TREE_FIELD_SELECTED, CLEAR_HIGHLIGHTED_DROP_TARGETS, COMPONENT_DRAG_ENDED, COMPONENT_DRAG_STARTED, COMPONENT_INSTANCE_DRAG_ENDED, COMPONENT_INSTANCE_DRAG_STARTED, CONTENT_TREE_FIELD_SELECTED, CONTENT_TREE_SWITCH_FIELD_INSTANCE, CONTENT_TYPE_DROP_TARGETS_REQUEST, DESKTOP_ASSET_DRAG_ENDED, DESKTOP_ASSET_DRAG_STARTED, DESKTOP_ASSET_UPLOAD_COMPLETE, DESKTOP_ASSET_UPLOAD_PROGRESS, DESKTOP_ASSET_UPLOAD_STARTED, EDIT_MODE_CHANGED, EditingStatus, HIGHLIGHT_MODE_CHANGED, HighlightMode, HOST_CHECK_IN, TRASHED } from '../../constants';\n// region mouseover\n// TODO: Not pure.\nconst mouseover = (state, action) => {\n    const { record } = action.payload;\n    if (state.status === EditingStatus.LISTENING) {\n        const highlight = ElementRegistry.getHoverData(record.id);\n        const draggable = ElementRegistry.getDraggable(record.id);\n        const nextState = Object.assign({}, state);\n        if ((state.highlightMode === HighlightMode.MOVABLE && draggable !== false) ||\n            state.highlightMode === HighlightMode.ALL) {\n            nextState.highlighted = { [record.id]: highlight };\n        }\n        if (draggable !== false) {\n            nextState.draggable = { [record.id]: draggable };\n        }\n        else if (record.id in state.draggable) {\n            nextState.draggable = reversePluckProps(state.draggable, record.id);\n        }\n        return nextState;\n    }\n    return state;\n};\n// endregion\n// region mouseleave\nconst mouseleave = (state) => {\n    if (state.status === EditingStatus.LISTENING) {\n        return Object.assign(Object.assign({}, state), { highlighted: {}, draggable: {} });\n    }\n};\n// endregion\n// region host_component_drag_started\n// TODO: Not pure.\nconst host_component_drag_started = (state, action) => {\n    const { contentType } = action.payload;\n    if (notNullOrUndefined(contentType)) {\n        const dropTargets = iceRegistry.getContentTypeDropTargets(contentType);\n        const validationsLookup = iceRegistry.runDropTargetsValidations(dropTargets);\n        const { players, siblings, containers, dropZones } = getDragContextFromDropTargets(dropTargets, validationsLookup);\n        const highlighted = getHighlighted(dropZones);\n        return Object.assign(Object.assign({}, state), { highlighted, status: EditingStatus.PLACING_NEW_COMPONENT, dragContext: Object.assign(Object.assign({}, state.dragContext), { players,\n                siblings,\n                dropZones,\n                containers,\n                contentType, inZone: false, targetIndex: null, dragged: null }) });\n    }\n    else {\n        return state;\n    }\n};\n// endregion\n// region host_instance_drag_started\n// TODO: Not pure.\nconst host_instance_drag_started = (state, action) => {\n    const { instance, contentType } = action.payload;\n    if (notNullOrUndefined(instance)) {\n        const dropTargets = iceRegistry.getContentTypeDropTargets(instance.craftercms.contentTypeId);\n        const validationsLookup = iceRegistry.runDropTargetsValidations(dropTargets);\n        const { players, siblings, containers, dropZones } = getDragContextFromDropTargets(dropTargets, validationsLookup);\n        const highlighted = getHighlighted(dropZones);\n        return Object.assign(Object.assign({}, state), { highlighted, status: EditingStatus.PLACING_DETACHED_COMPONENT, dragContext: Object.assign(Object.assign({}, state.dragContext), { players,\n                siblings,\n                dropZones,\n                containers,\n                instance,\n                contentType, inZone: false, targetIndex: null, dragged: null }) });\n    }\n    else {\n        return state;\n    }\n};\n// endregion\n// region asset_drag_started\n// TODO: Not pure\nconst asset_drag_started = (state, action) => {\n    const { asset } = action.payload;\n    if (notNullOrUndefined(asset)) {\n        let type;\n        if (asset.mimeType.includes('image/')) {\n            type = 'image';\n        }\n        else if (asset.mimeType.includes('video/')) {\n            type = 'video-picker';\n        }\n        const dropTargets = iceRegistry.getMediaDropTargets(type);\n        const { players, containers, dropZones } = getDragContextFromDropTargets(dropTargets);\n        const highlighted = getHighlighted(dropZones);\n        return Object.assign(Object.assign({}, state), { highlighted, status: EditingStatus.PLACING_DETACHED_ASSET, dragContext: Object.assign(Object.assign({}, state.dragContext), { players, siblings: [], dropZones,\n                containers, inZone: false, targetIndex: null, dragged: asset }) });\n    }\n    else {\n        return state;\n    }\n};\n// endregion\n// region desktop_asset_drag_started\n// TODO: Not pure\nconst desktop_asset_drag_started = (state, action) => {\n    const { asset } = action.payload;\n    if (notNullOrUndefined(asset)) {\n        let type;\n        if (asset.type.includes('image/')) {\n            type = 'image';\n        }\n        else if (asset.type.includes('video/')) {\n            type = 'video-picker';\n        }\n        const dropTargets = iceRegistry.getMediaDropTargets(type);\n        const { players, containers, dropZones } = getDragContextFromDropTargets(dropTargets);\n        const highlighted = getHighlighted(dropZones);\n        return Object.assign(Object.assign({}, state), { highlighted, status: EditingStatus.UPLOAD_ASSET_FROM_DESKTOP, dragContext: Object.assign(Object.assign({}, state.dragContext), { players, siblings: [], dropZones,\n                containers, inZone: false, targetIndex: null, dragged: asset }) });\n    }\n    else {\n        return state;\n    }\n};\n// endregion\n// region dragstart\n// TODO: Not pure.\nconst dragstart = (state, action) => {\n    var _a;\n    const { record } = action.payload;\n    // onMouseOver pre-populates the draggable record\n    // Items that browser make draggable by default (images, etc)\n    const iceId = (_a = state.draggable) === null || _a === void 0 ? void 0 : _a[record.id];\n    if (notNullOrUndefined(iceId)) {\n        const dropTargets = iceRegistry.getRecordDropTargets(iceId);\n        const validationsLookup = iceRegistry.runDropTargetsValidations(dropTargets);\n        const { players, siblings, containers, dropZones } = getDragContextFromDropTargets(dropTargets, validationsLookup, record);\n        const highlighted = getHighlighted(dropZones);\n        return Object.assign(Object.assign({}, state), { highlighted, status: EditingStatus.SORTING_COMPONENT, dragContext: Object.assign(Object.assign({}, state.dragContext), { players,\n                siblings,\n                dropZones,\n                containers, inZone: false, targetIndex: null, dragged: iceRegistry.getById(iceId) }) });\n    }\n    else {\n        return state;\n    }\n};\n// endregion\n// region dragover\n// const dragover: GuestReducer = (state, action) => {};\n// endregion\n// region dragleave\nconst dragleave = (state, action) => {\n    var _a, _b;\n    const leavingDropZone = !((_b = (_a = state.dragContext) === null || _a === void 0 ? void 0 : _a.dropZone) === null || _b === void 0 ? void 0 : _b.element.contains(action.payload.event.relatedTarget));\n    return dragOk(state.status)\n        ? Object.assign(Object.assign({}, state), { dragContext: Object.assign(Object.assign({}, state.dragContext), { over: null, inZone: false, targetIndex: null, dropZone: leavingDropZone ? null : state.dragContext.dropZone }) }) : state;\n};\n// endregion\n// region drop\n// const drop: GuestReducer = (state) => state;\n// endregion\n// region set_drop_position\nconst set_drop_position = (state, action) => {\n    const { targetIndex } = action.payload;\n    return Object.assign(Object.assign({}, state), { dragContext: Object.assign(Object.assign({}, state.dragContext), { targetIndex }) });\n};\n// endregion\n// region dragend\n// const dragend: GuestReducer = (state, action) => {};\n// endregion\n// region edit_component_inline\nconst edit_component_inline = (state, action) => {\n    return Object.assign(Object.assign({}, state), { status: EditingStatus.EDITING_COMPONENT_INLINE, draggable: {}, highlighted: {} });\n};\n// endregion\n// region exit_component_inline_edit\nconst exit_component_inline_edit = (state) => {\n    return Object.assign(Object.assign({}, state), { status: EditingStatus.LISTENING, highlighted: {} });\n};\n// endregion\n// region ice_zone_selected\n// TODO: Not pure\nconst ice_zone_selected = (state, action) => {\n    const { record } = action.payload;\n    const highlight = ElementRegistry.getHoverData(record.id);\n    return Object.assign(Object.assign({}, state), { status: EditingStatus.EDITING_COMPONENT, draggable: {}, highlighted: { [record.id]: highlight } });\n};\n// endregion\n// region content_tree_field_selected\n// TODO: Not pure\nconst content_tree_field_selected = (state, action) => {\n    const { iceProps } = action.payload;\n    const iceId = iceRegistry.exists(iceProps);\n    if (iceId === -1)\n        return;\n    const registryEntries = getRecordsFromIceId(iceId);\n    if (!registryEntries) {\n        return;\n    }\n    const highlight = ElementRegistry.getHoverData(registryEntries[0].id);\n    return Object.assign(Object.assign({}, state), { status: EditingStatus.SELECT_FIELD, draggable: iceRegistry.isMovable(iceId) ? { [registryEntries[0].id]: iceId } : {}, highlighted: { [registryEntries[0].id]: highlight }, fieldSwitcher: registryEntries.length > 1\n            ? {\n                iceId,\n                currentElement: 0,\n                registryEntryIds: registryEntries.map((entry) => entry.id)\n            }\n            : null });\n};\n// TODO: Not pure\nconst content_tree_switch_field = (state, action) => {\n    const { type } = action.payload;\n    let nextElem = type === 'next' ? state.fieldSwitcher.currentElement + 1 : state.fieldSwitcher.currentElement - 1;\n    let id = state.fieldSwitcher.registryEntryIds[nextElem];\n    const highlight = ElementRegistry.getHoverData(state.fieldSwitcher.registryEntryIds[nextElem]);\n    return Object.assign(Object.assign({}, state), { draggable: iceRegistry.isMovable(state.fieldSwitcher.iceId) ? { [id]: state.fieldSwitcher.iceId } : {}, highlighted: { [id]: highlight }, fieldSwitcher: Object.assign(Object.assign({}, state.fieldSwitcher), { currentElement: nextElem }) });\n};\nconst clear_content_tree_field_selected = (state) => {\n    return Object.assign(Object.assign({}, state), { status: EditingStatus.LISTENING, draggable: {}, highlighted: {}, fieldSwitcher: null });\n};\n// endregion\n// region dblclick\nconst dblclick = (state, action) => {\n    const { record } = action.payload;\n    return state.status === EditingStatus.LISTENING\n        ? Object.assign(Object.assign({}, state), { status: EditingStatus.EDITING_COMPONENT_INLINE, editable: {\n                [record.id]: record\n            } }) : state;\n};\n// endregion\n// region computed_dragend\nconst computed_dragend = (state) => {\n    return Object.assign(Object.assign({}, state), { status: EditingStatus.LISTENING, dragContext: null, highlighted: {} });\n};\n// endregion\n// region computed_dragover\n// TODO: Not pure.\nconst computed_dragover = (state, action) => {\n    if (state.dragContext.scrolling) {\n        return state;\n    }\n    else {\n        const dragContext = state.dragContext;\n        const { record, event } = action.payload;\n        const element = record.element;\n        if (dragContext.players.includes(element)) {\n            let { next, prev } = \n            // No point finding siblings for the drop zone element\n            dragContext.containers.includes(element)\n                ? { next: null, prev: null }\n                : ElementRegistry.getSiblingRects(record.id);\n            return Object.assign(Object.assign({}, state), { dragContext: Object.assign(Object.assign({}, dragContext), { next,\n                    prev, inZone: true, over: record, coordinates: { x: event.clientX, y: event.clientY }, dropZone: dragContext.dropZones.find((dz) => dz.element === element || dz.children.includes(element)) }) });\n        }\n        else {\n            return state;\n        }\n    }\n};\n// endregion\n// region desktop_asset_upload_complete\n// TODO: Carry or retrieve record for these events\nconst desktop_asset_upload_complete = (state, action) => {\n    const { record } = action.payload;\n    return Object.assign(Object.assign({}, state), { uploading: reversePluckProps(state.uploading, record.id) });\n};\n// endregion\n// region desktop_asset_upload_progress\nconst desktop_asset_upload_progress = (state, action) => {\n    const { percentage, record } = action.payload;\n    return Object.assign(Object.assign({}, state), { uploading: Object.assign(Object.assign({}, state.uploading), { [record.id]: Object.assign(Object.assign({}, state.uploading[record.id]), { progress: percentage }) }) });\n};\n// endregion\n// region desktop_asset_upload_started\n// TODO: Not pure\nconst desktop_asset_upload_started = (state, action) => {\n    const { record } = action.payload;\n    return Object.assign(Object.assign({}, state), { uploading: Object.assign(Object.assign({}, state.uploading), { [record.id]: ElementRegistry.getHoverData(record.id) }) });\n};\n// endregion\n// region clear_highlighted_drop_targets\nconst clear_highlighted_drop_targets = (state, action) => {\n    return Object.assign(Object.assign({}, state), { status: EditingStatus.LISTENING, highlighted: {} });\n};\n// endregion\n// region content_type_drop_targets_request\n// TODO: Not pure\nconst content_type_drop_targets_request = (state, action) => {\n    const { contentTypeId } = action.payload;\n    const highlighted = {};\n    iceRegistry.getContentTypeDropTargets(contentTypeId).forEach((item) => {\n        let { elementRecordId } = ElementRegistry.compileDropZone(item.id);\n        highlighted[elementRecordId] = ElementRegistry.getHoverData(elementRecordId);\n    });\n    return Object.assign(Object.assign({}, state), { dragContext: Object.assign(Object.assign({}, state.dragContext), { inZone: false }), status: EditingStatus.SHOW_DROP_TARGETS, highlighted });\n};\n// endregion\n// region start_listening\nconst start_listening = (state) => {\n    return Object.assign(Object.assign({}, state), { status: EditingStatus.LISTENING, highlighted: {} });\n};\n// endregion\n// region scrolling\nconst scrolling = (state) => {\n    return Object.assign(Object.assign({}, state), { dragContext: Object.assign(Object.assign({}, state.dragContext), { scrolling: true }) });\n};\n// endregion\n// region scrolling_end\n// TODO: Not pure\nconst scrolling_stopped = (state) => {\n    var _a, _b;\n    return Object.assign(Object.assign({}, state), { dragContext: Object.assign(Object.assign({}, state.dragContext), { scrolling: false, dropZones: (_b = (_a = state.dragContext) === null || _a === void 0 ? void 0 : _a.dropZones) === null || _b === void 0 ? void 0 : _b.map((dropZone) => (Object.assign(Object.assign({}, dropZone), { rect: dropZone.element.getBoundingClientRect(), childrenRects: dropZone.children.map((child) => child.getBoundingClientRect()) }))) }) });\n};\n// endregion\n// region drop_zone_enter\n// TODO: Not pure\nconst drop_zone_enter = (state, action) => {\n    const { elementRecordId } = action.payload;\n    const { dropZones: currentDropZones } = state.dragContext;\n    const currentDropZone = currentDropZones.find((dropZone) => dropZone.elementRecordId === elementRecordId);\n    let length = currentDropZone.children.length;\n    let invalidDrop = currentDropZone.origin ? false : state.dragContext.invalidDrop;\n    let rest = reversePluckProps(currentDropZone.validations, 'maxCount', 'minCount');\n    if (state.status === EditingStatus.SORTING_COMPONENT && currentDropZone.origin) {\n        length = length - 1;\n    }\n    const maxCount = !currentDropZone.origin\n        ? iceRegistry.runValidation(currentDropZone.iceId, 'maxCount', [length])\n        : null;\n    if (maxCount) {\n        rest.maxCount = maxCount;\n        invalidDrop = true;\n    }\n    const dropZones = updateDropZoneValidations(currentDropZone, currentDropZones, rest);\n    const highlighted = getHighlighted(dropZones);\n    return Object.assign(Object.assign({}, state), { dragContext: Object.assign(Object.assign({}, state.dragContext), { dropZones,\n            invalidDrop }), highlighted });\n};\n// endregion\n// region drop_zone_leave\n// TODO: Not pure\nconst drop_zone_leave = (state, action) => {\n    const { elementRecordId } = action.payload;\n    if (!state.dragContext) {\n        return;\n    }\n    const { dropZones: currentDropZones } = state.dragContext;\n    const currentDropZone = currentDropZones.find((dropZone) => dropZone.elementRecordId === elementRecordId);\n    let length = currentDropZone.children.length;\n    let invalidDrop = state.status === EditingStatus.SORTING_COMPONENT ? state.dragContext.invalidDrop : false;\n    let rest = reversePluckProps(currentDropZone.validations, 'minCount');\n    if (state.status === EditingStatus.SORTING_COMPONENT && currentDropZone.origin) {\n        length = length - 1;\n    }\n    const minCount = iceRegistry.runValidation(currentDropZone.iceId, 'minCount', [length]);\n    if (minCount) {\n        rest.minCount = minCount;\n        invalidDrop = !!currentDropZone.origin;\n    }\n    const dropZones = updateDropZoneValidations(currentDropZone, currentDropZones, rest);\n    const highlighted = getHighlighted(dropZones);\n    return Object.assign(Object.assign({}, state), { dragContext: Object.assign(Object.assign({}, state.dragContext), { dropZones,\n            invalidDrop }), highlighted });\n};\n// endregion\n// region set_edit_mode\nconst set_edit_mode = (state, action) => (Object.assign(Object.assign({}, state), { editMode: action.payload.editMode }));\n// endregion\n// region set_edit_mode\nconst set_highlight_mode = (state, { payload }) => (Object.assign(Object.assign({}, state), { highlightMode: payload.highlightMode }));\n// endregion\nconst initialState = {\n    dragContext: null,\n    draggable: {},\n    editable: {},\n    highlighted: {},\n    ICE_GUEST_INIT: false,\n    status: EditingStatus.LISTENING,\n    editMode: false,\n    highlightMode: HighlightMode.ALL,\n    uploading: {},\n    models: {},\n    contentTypes: {},\n    hostCheckedIn: false\n};\nconst foo = (state) => state;\nconst reducerFunctions = {\n    computed_dragend,\n    computed_dragover,\n    dblclick,\n    dragend: foo,\n    dragleave,\n    dragover: foo,\n    dragstart,\n    drop: foo,\n    set_drop_position,\n    edit_component_inline,\n    exit_component_inline_edit,\n    ice_zone_selected,\n    insert_component: foo,\n    insert_instance: foo,\n    mouseleave,\n    mouseover,\n    move_component: foo,\n    set_edit_mode,\n    start_listening,\n    add_asset_types: foo,\n    click: foo,\n    scrolling,\n    scrolling_stopped,\n    drop_zone_enter,\n    drop_zone_leave,\n    [TRASHED]: foo,\n    [ASSET_DRAG_ENDED]: foo,\n    [COMPONENT_DRAG_ENDED]: foo,\n    [COMPONENT_INSTANCE_DRAG_ENDED]: foo,\n    [DESKTOP_ASSET_DRAG_ENDED]: foo,\n    [EDIT_MODE_CHANGED]: set_edit_mode,\n    [HIGHLIGHT_MODE_CHANGED]: set_highlight_mode,\n    [CONTENT_TYPE_DROP_TARGETS_REQUEST]: content_type_drop_targets_request,\n    [CLEAR_HIGHLIGHTED_DROP_TARGETS]: clear_highlighted_drop_targets,\n    [DESKTOP_ASSET_UPLOAD_STARTED]: desktop_asset_upload_started,\n    [DESKTOP_ASSET_UPLOAD_COMPLETE]: desktop_asset_upload_complete,\n    [DESKTOP_ASSET_UPLOAD_PROGRESS]: desktop_asset_upload_progress,\n    [COMPONENT_DRAG_STARTED]: host_component_drag_started,\n    [COMPONENT_INSTANCE_DRAG_STARTED]: host_instance_drag_started,\n    [DESKTOP_ASSET_DRAG_STARTED]: desktop_asset_drag_started,\n    [ASSET_DRAG_STARTED]: asset_drag_started,\n    [CONTENT_TREE_FIELD_SELECTED]: content_tree_field_selected,\n    [CONTENT_TREE_SWITCH_FIELD_INSTANCE]: content_tree_switch_field,\n    [CLEAR_CONTENT_TREE_FIELD_SELECTED]: clear_content_tree_field_selected,\n    [HOST_CHECK_IN]: (state, action) => (Object.assign(Object.assign({}, state), { hostCheckedIn: true, highlightMode: action.payload.highlightMode, editMode: action.payload.editMode }))\n};\nexport default createReducer(initialState, reducerFunctions);\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport React, { useEffect, useRef } from 'react';\nfunction SnackBar(props) {\n    const { open, duration, message, children, onClose } = props;\n    const onCloseRef = useRef(onClose);\n    const timeoutRef = useRef();\n    onCloseRef.current = onClose;\n    useEffect(() => () => clearTimeout(timeoutRef.current), []);\n    useEffect(() => {\n        if (open) {\n            timeoutRef.current = setTimeout(onCloseRef.current, duration);\n        }\n    }, [open, duration]);\n    return open ? React.createElement(\"craftercms-snackbar\", null, message || children) : null;\n}\nexport default SnackBar;\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport React from 'react';\nexport default function FieldInstanceSwitcher(props) {\n    const { onNext, onPrev, registryEntryIds, currentElement } = props;\n    return (React.createElement(\"craftercms-field-instance-switcher\", null,\n        React.createElement(\"span\", null,\n            currentElement + 1,\n            \"/\",\n            registryEntryIds.length),\n        React.createElement(\"i\", { onClick: onPrev, className: currentElement === 0 ? 'disable' : '' },\n            React.createElement(\"svg\", { focusable: \"false\", viewBox: \"0 0 24 24\", \"aria-hidden\": \"true\" },\n                React.createElement(\"path\", { d: \"M14.71 6.71a.9959.9959 0 00-1.41 0L8.71 11.3c-.39.39-.39 1.02 0 1.41l4.59 4.59c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L10.83 12l3.88-3.88c.39-.39.38-1.03 0-1.41z\" }))),\n        React.createElement(\"i\", { onClick: onNext, className: currentElement + 1 === registryEntryIds.length ? 'disable' : '' },\n            React.createElement(\"svg\", { focusable: \"false\", viewBox: \"0 0 24 24\", \"aria-hidden\": \"true\" },\n                React.createElement(\"path\", { d: \"M9.29 6.71c-.39.39-.39 1.02 0 1.41L13.17 12l-3.88 3.88c-.39.39-.39 1.02 0 1.41.39.39 1.02.39 1.41 0l4.59-4.59c.39-.39.39-1.02 0-1.41L10.7 6.7c-.38-.38-1.02-.38-1.41.01z\" })))));\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\nimport $ from 'jquery';\nimport { fromEvent, interval, merge } from 'rxjs';\nimport { filter, pluck, share, switchMap, take, takeUntil, tap, withLatestFrom } from 'rxjs/operators';\nimport * as iceRegistry from '../classes/ICERegistry';\nimport { contentTypes$, flushRequestedPaths } from '../classes/ContentController';\nimport * as elementRegistry from '../classes/ElementRegistry';\nimport { GuestContextProvider, GuestReduxContext, useDispatch, useSelector } from './GuestContext';\nimport CrafterCMSPortal from './CrafterCMSPortal';\nimport ZoneMarker from './ZoneMarker';\nimport DropMarker from './DropMarker';\nimport { appendStyleSheet } from '../styles/styles';\nimport { fromTopic, message$, post } from '../utils/communicator';\nimport Cookies from 'js-cookie';\nimport AssetUploaderMask from './AssetUploaderMask';\nimport { ASSET_DRAG_ENDED, ASSET_DRAG_STARTED, CLEAR_CONTENT_TREE_FIELD_SELECTED, CLEAR_HIGHLIGHTED_DROP_TARGETS, CLEAR_SELECTED_ZONES, COMPONENT_DRAG_ENDED, COMPONENT_DRAG_STARTED, COMPONENT_INSTANCE_DRAG_ENDED, COMPONENT_INSTANCE_DRAG_STARTED, CONTENT_TREE_FIELD_SELECTED, CONTENT_TREE_SWITCH_FIELD_INSTANCE, CONTENT_TYPE_DROP_TARGETS_REQUEST, DESKTOP_ASSET_DRAG_ENDED, DESKTOP_ASSET_DRAG_STARTED, DESKTOP_ASSET_UPLOAD_COMPLETE, DESKTOP_ASSET_UPLOAD_PROGRESS, EDIT_MODE_CHANGED, EditingStatus, GUEST_CHECK_IN, GUEST_CHECK_OUT, HIGHLIGHT_MODE_CHANGED, HighlightMode, HOST_CHECK_IN, NAVIGATION_REQUEST, RELOAD_REQUEST, SCROLL_TO_DROP_TARGET, TRASHED } from '../constants';\nimport { createGuestStore } from '../store/store';\nimport { Provider } from 'react-redux';\nimport { clearAndListen$ } from '../store/subjects';\nimport { isNullOrUndefined, nnou } from '../utils/object';\nimport { scrollToDropTargets } from '../utils/dom';\nimport { dragOk } from '../store/util';\nimport SnackBar from './SnackBar';\nimport { createLocationArgument } from '../utils/util';\nimport FieldInstanceSwitcher from './FieldInstanceSwitcher';\nconst initialDocumentDomain = document.domain;\nconst editModeClass = 'craftercms-ice-on';\nexport function getEditModeClass() {\n    return editModeClass;\n}\nfunction Guest(props) {\n    var _a, _b, _c, _d, _e, _f, _g;\n    // TODO: support path driven Guest.\n    // TODO: consider supporting developer to provide the data source (promise/observable?)\n    const { path, styleConfig, children, documentDomain, scrollElement = 'html, body' } = props;\n    const [snack, setSnack] = useState();\n    const dispatch = useDispatch();\n    const state = useSelector((state) => state);\n    const editMode = state.editMode;\n    const highlightMode = state.highlightMode;\n    const status = state.status;\n    const hasHost = state.hostCheckedIn;\n    const draggable = state.draggable;\n    const refs = useRef({ contentReady: false, firstRender: true, keysPressed: {} });\n    // TODO: Avoid double re-render when draggable changes without coupling to redux on useICE\n    const context = useMemo(() => ({\n        hasHost,\n        editMode,\n        draggable,\n        highlightMode,\n        onEvent(event, dispatcherElementRecordId) {\n            if (hasHost && editMode && refs.current.contentReady) {\n                const { type } = event;\n                const record = elementRegistry.get(dispatcherElementRecordId);\n                if (isNullOrUndefined(record)) {\n                    console.error('No record found for dispatcher element');\n                }\n                else {\n                    if (refs.current.keysPressed.z && type === 'click') {\n                        return false;\n                    }\n                    // HighlightMode validations helps to dont stop the event propagation\n                    if (['click', 'dblclick'].includes(type) &&\n                        (highlightMode === HighlightMode.ALL || (highlightMode === HighlightMode.MOVABLE && !draggable))) {\n                        event.preventDefault();\n                        event.stopPropagation();\n                    }\n                    dispatch({ type: type, payload: { event, record } });\n                    return true;\n                }\n            }\n            return false;\n        }\n    }), [dispatch, hasHost, draggable, editMode, highlightMode]);\n    // Key press/hold keeper events\n    useEffect(() => {\n        const keydown = (e) => {\n            refs.current.keysPressed[e.key] = true;\n        };\n        const keyup = (e) => {\n            refs.current.keysPressed[e.key] = false;\n        };\n        document.addEventListener('keydown', keydown, false);\n        document.addEventListener('keyup', keyup, false);\n        return () => {\n            document.removeEventListener('keydown', keydown, false);\n            document.removeEventListener('keyup', keyup, false);\n        };\n    }, []);\n    // Sets document domain\n    useEffect(() => {\n        if (documentDomain) {\n            try {\n                document.domain = documentDomain;\n            }\n            catch (e) {\n                console.error(e);\n            }\n        }\n        else if (document.domain !== initialDocumentDomain) {\n            document.domain = initialDocumentDomain;\n        }\n    }, [documentDomain]);\n    // Add/remove edit on class\n    useEffect(() => {\n        if (editMode === false) {\n            $('html').removeClass(editModeClass);\n            document.dispatchEvent(new CustomEvent('craftercms.editMode', { detail: false }));\n            // Refreshing the page for now. Will revisit on a later release.\n            if (!refs.current.firstRender) {\n                window.location.reload();\n            }\n        }\n        else {\n            $('html').addClass(editModeClass);\n            document.dispatchEvent(new CustomEvent('craftercms.editMode', { detail: true }));\n        }\n        if (refs.current.firstRender) {\n            refs.current.firstRender = false;\n        }\n    }, [editMode]);\n    // Appends the Guest stylesheet\n    useEffect(() => {\n        const stylesheet = appendStyleSheet(styleConfig);\n        return () => {\n            stylesheet.detach();\n        };\n    }, [styleConfig]);\n    // Subscribes to host messages and routes them.\n    useEffect(() => {\n        const sub = message$.subscribe(function (action) {\n            const { type, payload } = action;\n            switch (type) {\n                case HIGHLIGHT_MODE_CHANGED:\n                case EDIT_MODE_CHANGED:\n                    dispatch(action);\n                    break;\n                case ASSET_DRAG_STARTED:\n                    dispatch({ type, payload: { asset: payload } });\n                    break;\n                case ASSET_DRAG_ENDED:\n                    dragOk(status) && dispatch(action);\n                    break;\n                case COMPONENT_DRAG_STARTED:\n                    dispatch({ type, payload: { contentType: payload } });\n                    break;\n                case COMPONENT_DRAG_ENDED:\n                    dragOk(status) && dispatch(action);\n                    break;\n                case COMPONENT_INSTANCE_DRAG_STARTED:\n                    dispatch({ type, payload });\n                    break;\n                case COMPONENT_INSTANCE_DRAG_ENDED:\n                    dragOk(status) && dispatch(action);\n                    break;\n                case TRASHED:\n                    dispatch({ type, payload: { iceId: payload } });\n                    break;\n                case CLEAR_SELECTED_ZONES:\n                    clearAndListen$.next();\n                    dispatch({ type: 'start_listening' });\n                    break;\n                case RELOAD_REQUEST: {\n                    post({ type: GUEST_CHECK_OUT });\n                    return window.location.reload();\n                }\n                case NAVIGATION_REQUEST: {\n                    post({ type: GUEST_CHECK_OUT });\n                    return (window.location.href = payload.url);\n                }\n                case CONTENT_TYPE_DROP_TARGETS_REQUEST: {\n                    dispatch({\n                        type,\n                        payload: { contentTypeId: payload }\n                    });\n                    break;\n                }\n                case SCROLL_TO_DROP_TARGET:\n                    scrollToDropTargets([payload], scrollElement, (id) => elementRegistry.fromICEId(id).element);\n                    break;\n                case CLEAR_HIGHLIGHTED_DROP_TARGETS:\n                    dispatch(action);\n                    break;\n                case CONTENT_TREE_FIELD_SELECTED: {\n                    dispatch({\n                        type,\n                        payload: {\n                            iceProps: {\n                                modelId: payload.parentId || payload.modelId,\n                                fieldId: payload.fieldId,\n                                index: payload.index\n                            },\n                            scrollElement,\n                            name: payload.name\n                        }\n                    });\n                    break;\n                }\n                case CLEAR_CONTENT_TREE_FIELD_SELECTED:\n                    clearAndListen$.next();\n                    dispatch({ type });\n                    break;\n                case DESKTOP_ASSET_UPLOAD_PROGRESS:\n                    dispatch(action);\n                    break;\n                case DESKTOP_ASSET_UPLOAD_COMPLETE:\n                    dispatch(action);\n                    break;\n            }\n        });\n        return () => {\n            sub.unsubscribe();\n        };\n    }, [dispatch, scrollElement, status]);\n    // Host detection\n    useEffect(() => {\n        if (!hasHost) {\n            // prettier-ignore\n            interval(1000).pipe(takeUntil(merge(fromTopic(HOST_CHECK_IN), fromTopic('LEGACY_CHECK_IN')).pipe(tap(dispatch), take(1))), take(1)).subscribe(() => setSnack({\n                duration: 8000,\n                message: 'In-context editing is disabled: page running out of Crafter CMS frame.'\n            }));\n        }\n    }, [dispatch, hasHost]);\n    // Load dependencies (tinymce)\n    useEffect(() => {\n        if (hasHost && !window.tinymce) {\n            const script = document.createElement('script');\n            script.src = '/studio/static-assets/modules/editors/tinymce/v5/tinymce/tinymce.min.js';\n            // script.onload = () => ...;\n            document.head.appendChild(script);\n        }\n    }, [hasHost]);\n    // Check out (dismount, beforeunload)\n    useEffect(() => {\n        // Notice this is not executed when the iFrame url is changed abruptly.\n        // This only triggers when navigation occurs from within the guest page.\n        const handler = () => post({ type: GUEST_CHECK_OUT });\n        window.addEventListener('beforeunload', handler, false);\n        return () => {\n            post(GUEST_CHECK_OUT);\n            window.removeEventListener('beforeunload', handler);\n        };\n    }, []);\n    // Registers parent zone, check in, checkout (when model is changed)\n    useEffect(() => {\n        let iceId;\n        const location = createLocationArgument();\n        const site = Cookies.get('crafterSite');\n        fromTopic('FETCH_GUEST_MODEL_COMPLETE')\n            .pipe(filter(({ payload }) => payload.path === path), pluck('payload', 'model'), withLatestFrom(contentTypes$), take(1))\n            .subscribe(([model]) => {\n            iceId = iceRegistry.register({ modelId: model.craftercms.id });\n            refs.current.contentReady = true;\n        });\n        post(GUEST_CHECK_IN, { location, path, site, documentDomain });\n        return () => {\n            post(GUEST_CHECK_OUT);\n            nnou(iceId) && iceRegistry.deregister(iceId);\n            refs.current.contentReady = false;\n            flushRequestedPaths();\n        };\n    }, [documentDomain, path]);\n    // Listen for desktop asset drag & drop\n    useEffect(() => {\n        const subscription = fromEvent(document, 'dragenter')\n            .pipe(filter((e) => { var _a; return (_a = e.dataTransfer) === null || _a === void 0 ? void 0 : _a.types.includes('Files'); }))\n            .subscribe((e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            dispatch({\n                type: DESKTOP_ASSET_DRAG_STARTED,\n                payload: { asset: e.dataTransfer.items[0] }\n            });\n        });\n        return () => subscription.unsubscribe();\n    }, [dispatch]);\n    // Listen for drag events for desktop asset drag & drop\n    useEffect(() => {\n        if (EditingStatus.UPLOAD_ASSET_FROM_DESKTOP === status) {\n            const dropSubscription = fromEvent(document, 'drop').subscribe((e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                dragOk(status) && dispatch({ type: DESKTOP_ASSET_DRAG_ENDED });\n            });\n            const dragover$ = fromEvent(document, 'dragover').pipe(tap((e) => {\n                e.preventDefault();\n                e.stopPropagation();\n            }), share());\n            const dragoverSubscription = dragover$.subscribe();\n            const dragleaveSubscription = fromEvent(document, 'dragleave')\n                .pipe(switchMap(() => interval(100).pipe(takeUntil(dragover$))))\n                .subscribe(() => {\n                dragOk(status) && dispatch({ type: DESKTOP_ASSET_DRAG_ENDED });\n            });\n            return () => {\n                dropSubscription.unsubscribe();\n                dragoverSubscription.unsubscribe();\n                dragleaveSubscription.unsubscribe();\n            };\n        }\n    }, [dispatch, status]);\n    // Listen for mouse switching between drop zones\n    const dragContextDropZoneIceId = (_b = (_a = state.dragContext) === null || _a === void 0 ? void 0 : _a.dropZone) === null || _b === void 0 ? void 0 : _b.iceId;\n    const dragContextDropZoneElementRecordId = (_d = (_c = state.dragContext) === null || _c === void 0 ? void 0 : _c.dropZone) === null || _d === void 0 ? void 0 : _d.elementRecordId;\n    useEffect(() => {\n        if (nnou(dragContextDropZoneIceId)) {\n            dispatch({\n                type: 'drop_zone_enter',\n                payload: { elementRecordId: dragContextDropZoneElementRecordId }\n            });\n            return () => {\n                dispatch({\n                    type: 'drop_zone_leave',\n                    payload: { elementRecordId: dragContextDropZoneElementRecordId }\n                });\n            };\n        }\n    }, [dispatch, dragContextDropZoneElementRecordId, dragContextDropZoneIceId]);\n    const draggableItemElemRecId = (_f = Object.entries((_e = state.draggable) !== null && _e !== void 0 ? _e : {}).find(([, ice]) => ice !== false)) === null || _f === void 0 ? void 0 : _f[0];\n    return (React.createElement(GuestContextProvider, { value: context },\n        children,\n        editMode && (React.createElement(CrafterCMSPortal, null,\n            draggableItemElemRecId && (React.createElement(\"craftercms-dragged-element\", null, (_g = elementRegistry.get(parseInt(draggableItemElemRecId))) === null || _g === void 0 ? void 0 : _g.label)),\n            Object.values(state.uploading).map((highlight) => (React.createElement(AssetUploaderMask, Object.assign({ key: highlight.id }, highlight)))),\n            state.fieldSwitcher && (React.createElement(FieldInstanceSwitcher, { onNext: () => dispatch({\n                    type: CONTENT_TREE_SWITCH_FIELD_INSTANCE,\n                    payload: { type: 'next', scrollElement }\n                }), onPrev: () => dispatch({\n                    type: CONTENT_TREE_SWITCH_FIELD_INSTANCE,\n                    payload: { type: 'prev', scrollElement }\n                }), registryEntryIds: state.fieldSwitcher.registryEntryIds, currentElement: state.fieldSwitcher.currentElement })),\n            Object.values(state.highlighted).map((highlight, index, array) => (React.createElement(ZoneMarker, Object.assign({ key: highlight.id }, highlight, { classes: {\n                    label: array.length > 1 && 'craftercms-zone-marker-label__multi-mode',\n                    marker: Object.values(highlight.validations).length\n                        ? Object.values(highlight.validations).some(({ level }) => level === 'required')\n                            ? 'craftercms-required-validation-failed'\n                            : 'craftercms-suggestion-validation-failed'\n                        : null\n                } })))),\n            [\n                EditingStatus.SORTING_COMPONENT,\n                EditingStatus.PLACING_NEW_COMPONENT,\n                EditingStatus.PLACING_DETACHED_COMPONENT\n            ].includes(status) &&\n                state.dragContext.inZone &&\n                !state.dragContext.invalidDrop && (Reastate.highlightedct.createElement(DropMarker, { onDropPosition: (payload) => dispatch({ type: 'set_drop_position', payload }), dropZone: state.dragContext.dropZone, over: state.dragContext.over, prev: state.dragContext.prev, next: state.dragContext.next, coordinates: state.dragContext.coordinates })))),\n        snack && (React.createElement(SnackBar, Object.assign({ open: true, onClose: () => setSnack(null) }, snack), snack.message))));\n}\nfunction CrafterCMSGuest(props) {\n    const { isAuthoring, children } = props;\n    const store = useMemo(() => isAuthoring && createGuestStore(), [isAuthoring]);\n    return isAuthoring ? (React.createElement(Provider, { store: store, context: GuestReduxContext },\n        React.createElement(Guest, Object.assign({}, props)))) : children;\n}\nexport { CrafterCMSGuest as Guest };\nexport default CrafterCMSGuest;\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport React from 'react';\nexport function Spinner(props) {\n    return (React.createElement(\"svg\", { className: props.className, width: props.width, height: props.height, viewBox: \"0 0 66 66\", xmlns: \"http://www.w3.org/2000/svg\" },\n        React.createElement(\"circle\", { className: props.circleClassName, fill: \"none\", strokeWidth: props.strokeWidth, strokeLinecap: props.strokeLineCap, cx: \"33\", cy: \"33\", r: \"30\" })));\n}\nSpinner.defaultProps = {\n    width: 50,\n    height: 50,\n    strokeWidth: 6,\n    className: 'spinner',\n    strokeLineCap: 'round',\n    circleClassName: 'path'\n};\nexport default Spinner;\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { __rest } from \"tslib\";\nimport React from 'react';\nexport function NotFoundDefault() {\n    return (React.createElement(\"section\", null,\n        React.createElement(\"p\", null, \"Content not found.\")));\n}\nexport function NotDevelopedDefault() {\n    return React.createElement(\"section\", null, \"The page you've selected needs to be created by the site developers.\");\n}\nexport function ContentType(props) {\n    var _a;\n    if (!props.contentTypeMap) {\n        console.error(`The content type map was not supplied to ContentType component. ${Boolean(props.model)\n            ? `\"${props.model.craftercms.label}\" component of type \"${props.model.craftercms.contentTypeId}\" won't render.`\n            : ''}`);\n    }\n    const { model, contentTypeMap = {}, notMappedComponent: NotDeveloped = NotDevelopedDefault, notFoundComponent: NotFound = NotFoundDefault } = props, rest = __rest(props, [\"model\", \"contentTypeMap\", \"notMappedComponent\", \"notFoundComponent\"]);\n    // prettier-ignore\n    const Component = (model === null) ? NotFound : ((_a = contentTypeMap[model.craftercms.contentTypeId]) !== null && _a !== void 0 ? _a : NotDeveloped);\n    return React.createElement(Component, Object.assign({ model: model }, rest));\n}\nexport default ContentType;\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { useEffect, useRef, useState } from 'react';\nimport { useGuestContext } from './GuestContext';\nimport { deregister, register } from '../classes/ElementRegistry';\nimport { nnou, nou, pluckProps } from '../utils/object';\nimport { byPathFetchIfNotLoaded, model$, models$ } from '../classes/ContentController';\nimport { distinctUntilChanged, map, withLatestFrom } from 'rxjs/operators';\nimport { denormalizeModel } from '../utils/content';\nimport * as Model from '../utils/model';\n// endregion\nconst handlerMap = {\n    mouseover: 'onMouseOver',\n    mouseleave: 'onMouseLeave',\n    dragstart: 'onDragStart',\n    dragover: 'onDragOver',\n    dragleave: 'onDragLeave',\n    drop: 'onDrop',\n    dragend: 'onDragEnd',\n    click: 'onClick',\n    dblclick: 'onDoubleClick'\n};\nfunction bypassICE(props) {\n    return {\n        model: props.model,\n        props: pluckProps(props, 'ref', 'onMouseOver', 'onMouseLeave', 'onDragStart', 'onDragOver', 'onDragLeave', 'onDrop', 'onDragEnd', 'onClick', 'onDoubleClick')\n    };\n}\nexport function useICE(props) {\n    const context = useGuestContext();\n    const inAuthoring = context && context.editMode && context.hasHost;\n    const { onEvent, draggable } = context !== null && context !== void 0 ? context : {};\n    const elementRef = useRef();\n    const elementRegistryId = useRef();\n    const model = useHotReloadModel(props);\n    // Register\n    useEffect(() => {\n        elementRegistryId.current = register({\n            element: elementRef.current,\n            modelId: props.model.craftercms.id,\n            fieldId: props.fieldId,\n            index: props.index\n        });\n        return () => {\n            // Deregister\n            deregister(elementRegistryId.current);\n        };\n    }, [props.index, props.fieldId, props.model.craftercms.id]);\n    const ref = (node) => {\n        // During React update cycles, it may momentarily set the ref to\n        // null and then back to the previous element. We're only paying attention\n        // to the times that there is an element. Final de-registration occurs\n        // at the unmount time.\n        if (node) {\n            elementRef.current = node;\n        }\n        if (props.ref) {\n            if (typeof props.ref === 'function') {\n                props.ref(node);\n            }\n            else {\n                props.ref.current = node;\n            }\n        }\n    };\n    if (inAuthoring) {\n        const isDraggable = nnou(draggable[elementRegistryId.current]) && draggable[elementRegistryId.current] !== false;\n        const handler = (event) => {\n            var _a;\n            // Registering here would be elegant (lazy registration) however\n            // it would take a toll on the ContentTree panel\n            if (onEvent(event, elementRegistryId.current)) {\n                event.persist();\n            }\n            else {\n                (_a = props[handlerMap[event.type]]) === null || _a === void 0 ? void 0 : _a.call(props);\n            }\n        };\n        return {\n            model,\n            props: props.noRef !== true\n                ? Object.assign(Object.assign({ ref }, (isDraggable ? { draggable: true } : {})), { onMouseOver: handler, onMouseLeave: handler, onDragStart: handler, onDragOver: handler, onDragLeave: handler, onDrop: handler, onDragEnd: handler, onClick: handler, onDoubleClick: handler }) : null\n        };\n    }\n    else {\n        return bypassICE(Object.assign(Object.assign({}, props), { ref }));\n    }\n}\nexport function useHotReloadModel(props) {\n    const context = useGuestContext();\n    const inAuthoring = Boolean(context) && Boolean(context.hasHost);\n    const [model, setModel] = useState(props.model);\n    useEffect(() => {\n        if (inAuthoring) {\n            // Insure the model gets loaded.\n            props.model.craftercms.path && byPathFetchIfNotLoaded(props.model.craftercms.path).subscribe();\n            const s = model$(props.model.craftercms.id)\n                .pipe(distinctUntilChanged((prev, next) => {\n                if (nou(props.fieldId)) {\n                    return prev === next;\n                } /* if (nnou(props.index) && nnou(props.fieldId)) {\n                  return prev[props.fieldId] === next[props.fieldId];\n                } else */\n                else {\n                    // Accounting for multiple (comma separated) fields\n                    return !props.fieldId\n                        .replace(/\\s/g, '')\n                        .split(',')\n                        .some((field) => prev[field] !== next[field]);\n                }\n            }), withLatestFrom(models$), map(([model, models]) => denormalizeModel(model, models)))\n                .subscribe(setModel);\n            return () => s.unsubscribe();\n        }\n    }, [inAuthoring, props.fieldId, props.model.craftercms.id, props.model.craftercms.path]);\n    return model;\n}\nexport function useFieldValue(props) {\n    const { model, fieldId } = props;\n    return Model.value(model, fieldId);\n}\n// TODO: Future authoring-less version of the hooks for live?\n// if (process.env.NODE_ENV === 'craftercms_live') {\n//   export { bypassICE as useICE }\n// } else {\n//   export { useICE }\n// }\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\nimport { __rest } from \"tslib\";\nimport React, { Fragment } from 'react';\nimport { useICE } from './hooks';\nimport { extractCollectionItem, value as getModelValue } from '../utils/model';\nimport { nnou, setProperty } from '../utils/object';\n// Field component is a slightly lighter/simpler version of RenderField. It has less options to render (e.g. no renderTarget, format)\n// Registers the zone but doesn't render the field value, so values don't get repainted when changed.\nexport function Field(props) {\n    const { model: modelProp, fieldId, index, component = 'div' } = props, other = __rest(props, [\"model\", \"fieldId\", \"index\", \"component\"]);\n    const { props: ice, model } = useICE({ model: modelProp, fieldId, index });\n    const Component = component;\n    const passDownProps = Object.assign(Object.assign(Object.assign({}, other), ice), (typeof component === 'string' ? {} : { model }));\n    return React.createElement(Component, Object.assign({}, passDownProps));\n}\nexport function RenderField(props) {\n    const { model: modelProp, fieldId, index, component = 'div', \n    // The renderTarget property for the field value. Can be multiple (CSVs),\n    // just like fieldId. Should have a 1-to-1 correspondence with fieldId.\n    renderTarget = 'children', format = (value) => value } = props, other = __rest(props, [\"model\", \"fieldId\", \"index\", \"component\", \"renderTarget\", \"format\"]);\n    const { props: ice, model } = useICE({ model: modelProp, fieldId, index });\n    const Component = component;\n    const passDownProps = Object.assign({}, other, ice);\n    const fields = fieldId.replace(/\\s/g, '').split(',');\n    const targets = renderTarget.replace(/\\s/g, '').split(',');\n    targets.forEach((target, targetIndex) => {\n        const fieldId = fields[targetIndex];\n        setProperty(passDownProps, target, format(nnou(index) ? extractCollectionItem(model, fieldId, index) : getModelValue(model, fieldId), fieldId));\n    });\n    return React.createElement(Component, Object.assign({}, passDownProps));\n}\nexport function Model(props) {\n    const { model, component = Fragment } = props, other = __rest(props, [\"model\", \"component\"]);\n    useICE({ model, fieldId: null, index: null, noRef: true });\n    const Component = component;\n    const passDownProps = other;\n    return React.createElement(Component, Object.assign({}, passDownProps));\n}\nexport default Field;\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport React from 'react';\nimport BaseLayout from '../shared/BaseLayout';\n\nexport default function NotFound({ meta: { levelDescriptor } }) {\n  return (\n    <BaseLayout model={levelDescriptor}>\n      <section style={{ textAlign: 'center', padding: '50px 0' }}>\n        <h1>Not Found</h1>\n        <p>The page you're looking for does not exist.</p>\n      </section>\n    </BaseLayout>\n  );\n}\n\nexport function NotDeveloped() {\n  return (\n    <section>\n      The page you've selected needs to be created by the site developers.\n    </section>\n  );\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport React, { useEffect, useState } from 'react';\n\nimport CircularProgressSpinner from './CircularProgressSpinner';\nimport { fetchQuery } from '../fetchQuery';\nimport byUrlQuery from './queries.graphql';\nimport { parseDescriptor } from '@craftercms/content';\nimport { parse } from 'query-string';\nimport { isAuthoring } from './utils';\nimport { ContentType, Guest } from '@craftercms/studio-guest/react';\nimport contentTypeMap from './contentTypeMap';\nimport NotFound from '../pages/NotFound';\n\nconst limit = 8;\n\nexport default function DynamicRoute(props) {\n  const { match, location } = props;\n  const [state, setState] = useState(null);\n  let url = match.path.includes(':')\n    ? match.path.substring(0, match.path.indexOf(':') - 1)\n    : match.url;\n\n  useEffect(() => {\n    let destroyed = false;\n    let page = parseInt(parse(location.search).page ?? 1) - 1;\n    const pagination = { limit, offset: page ? (page * limit) : 0 };\n    fetchQuery(\n      { text: byUrlQuery },\n      {\n        url: `.*${url === '/' ? 'website/index' : url}.*`,\n        includePosts: true,\n        postsLimit: pagination.limit,\n        postsOffset: pagination.offset\n      }\n    ).then(({ data }) => {\n      if (!destroyed) {\n        const model = parseDescriptor(data.content.items?.[0]);\n        const levelDescriptor = parseDescriptor(\n          data.levelDescriptors.items\n            .filter(levelDescriptor => levelDescriptor.file__name === 'crafter-level-descriptor.level.xml')\n            .pop()\n        );\n\n        setState({\n          model,\n          meta: {\n            levelDescriptor,\n            disqus: {\n              websiteShortname: levelDescriptor.websiteShortname_s\n            },\n            posts: {\n              total: data.posts.total,\n              ...pagination\n            }\n          }\n        });\n        if (model) {\n          document.title = model.pageTitle_s ?? 'Wordify Crafter CMS';\n          if (model.pageDescription_s) {\n            const description = document.head.querySelector('meta[name=\"description\"]');\n            description && description.setAttribute('content', model.pageDescription_s ?? '');\n          }\n        }\n      }\n    });\n    return () => {\n      destroyed = true;\n    };\n  }, [url, location.search]);\n\n  useEffect(() => {\n    window.scroll(0, 0);\n  }, [url]);\n\n  if (state === null) {\n    return <CircularProgressSpinner />;\n  } else {\n    return (\n      <Guest\n        isAuthoring={isAuthoring()}\n        path={state.model?.craftercms.path}\n      >\n        <ContentType\n          {...state}\n          {...props}\n          contentTypeMap={contentTypeMap}\n          notFoundComponent={NotFound}\n        />\n      </Guest>\n    );\n  }\n\n}\n\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport React from 'react';\n\nimport { BrowserRouter, Route, Switch } from 'react-router-dom';\nimport DynamicRoute from './DynamicRoute';\n\nexport default function Router() {\n  return (\n    <BrowserRouter>\n      <Switch>\n        <Route path=\"/category/:id?\" component={DynamicRoute} />\n        <Route path=\"/tag/:id?\" component={DynamicRoute} />\n        <Route path=\"/*\" component={DynamicRoute} />\n      </Switch>\n    </BrowserRouter>\n  );\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport React from 'react';\nimport { IntlProvider } from 'react-intl';\nimport { useGlobalContext } from './context';\nimport en from '../assets/locales/en';\nimport es from '../assets/locales/es';\n\nconst Locales = {\n  en,\n  es\n};\n\nconst AppIntl = (props) => {\n  const [{ locale }] = useGlobalContext();\n  return <IntlProvider {...props} locale={locale} messages={Locales[locale]}/>;\n};\n\nexport default AppIntl;","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport React, { Suspense } from 'react';\nimport Router from './Router';\nimport CircularProgressSpinner from './CircularProgressSpinner';\nimport { GlobalContextProvider } from './context';\nimport AppIntl from './AppIntl';\n\nexport default function App() {\n  return (\n    <GlobalContextProvider>\n      <AppIntl>\n        <Suspense\n          fallback={\n            <CircularProgressSpinner />\n          }\n        >\n          <Router />\n        </Suspense>\n      </AppIntl>\n    </GlobalContextProvider>\n  );\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './shared/App';\nimport Cookies from 'js-cookie';\nimport { siteName } from './shared/utils';\n// import * as serviceWorker from './serviceWorker';\n\nif (Cookies.get('crafterSite') !== siteName) {\n  Cookies.set('crafterSite', siteName);\n}\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister();\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { crafterConf } from '@craftercms/classes';\nimport Cookies from 'js-cookie';\n\nexport function isAuthoring() {\n  const html = document.documentElement;\n  const attr = html.getAttribute('data-craftercms-preview');\n  return (\n    // eslint-disable-next-line no-template-curly-in-string\n    attr === '${modePreview?c}' || // Otherwise disable/enable if you want to see pencils in dev server.\n    attr === 'true'\n  );\n}\n\nexport function createResource(factory) {\n  let result;\n  let status = \"pending\";\n  let suspender = factory().then(\n    response => {\n      status = \"success\";\n      result = response;\n    },\n    error => {\n      status = \"error\";\n      result = error;\n    }\n  );\n  return {\n    read() {\n      if (status === \"pending\") {\n        throw suspender;\n      } else if (status === \"error\") {\n        throw result;\n      } else if (status === \"success\") {\n        return result;\n      }\n    }\n  };\n}\n\nexport const siteName =\n  document.getElementById('2fb5164e').innerHTML ||\n  process.env.REACT_APP_CRAFTERCMS_SITE_ID ||\n  Cookies.get('crafterSite');\nif (!siteName) {\n  throw new Error('Site not set.');\n}\n\nexport const crafterConfig = {\n  baseUrl: process.env.REACT_APP_CRAFTERCMS_BASE_URL ?? '',\n  site: siteName\n};\n\ncrafterConf.configure(crafterConfig);\n\nexport function createTaxonomyFilter(name) {\n  return (taxonomy => taxonomy.craftercms.path.includes(name));\n};","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport React, { createContext, useContext, useMemo } from 'react';\nimport { isAuthoring } from './utils';\nimport { useSpreadState } from './hooks';\n\nexport const GlobalContext = createContext();\n\nfunction useGlobalContext() {\n  const context = useContext(GlobalContext);\n  if (!context) {\n    throw new Error(`useGlobalContext must be used within a GlobalContextProvider`);\n  }\n  return context;\n}\n\nfunction GlobalContextProvider(props) {\n  const [state, setState] = useSpreadState({\n    isAuthoring: isAuthoring(),\n    locale: 'en',\n    pages: null,\n    pagesLoading: false,\n    theme: 'light'\n  });\n  const value = useMemo(() => [state, setState], [state, setState]);\n  return <GlobalContext.Provider value={value} {...props} />;\n}\n\nexport { GlobalContextProvider, useGlobalContext };\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { useCallback, useEffect, useReducer, useRef, useState } from 'react';\nimport { fetchQuery } from '../fetchQuery';\nimport { useGlobalContext } from './context';\nimport { parse } from 'query-string';\nimport { useLocation } from 'react-router-dom';\nimport { crafterConfig, createResource } from './utils';\nimport { map } from 'rxjs/operators';\nimport { createQuery, search } from '@craftercms/search';\nimport { parseDescriptor, preParseSearchResults } from '@craftercms/content';\nimport { postsQuery } from './queries.graphql';\n\nexport const neverResource = createResource(() => new Promise(() => void 0));\n\nconst reducer = (state, nextState) => {\n  return { ...state, ...nextState };\n}\n\nexport function useSpreadState(initializerArg, initializer) {\n  return useReducer(reducer, initializerArg, initializer);\n}\n\nexport function useNavigation() {\n  const [{ pages, pagesLoading }, update] = useGlobalContext();\n  const destroyedRef = useRef(false);\n  useEffect(() => {\n    return () => {\n      destroyedRef.current = true;\n    };\n  }, []);\n  useEffect(() => {\n    if (!pages && !pagesLoading) {\n      update({ pagesLoading: true });\n      fetchQuery({\n        text: `\n          query Nav {\n            pages {\n              total\n              items {\n                navLabel\n                contentTypeId: content__type\n                url: localId(transform: \"storeUrlToRenderUrl\")\n                placeInNav(filter: { equals: true }) @skip(if: true)\n                orderDefault_f\n              }\n            }\n          }\n        `\n      }).then(({ data }) => {\n        (!destroyedRef.current) && update({ pages: data.pages.items });\n      });\n    }\n  }, [update, pages, pagesLoading]);\n  return pages;\n}\n\nexport function useSearchQuery() {\n  const { search } = useLocation();\n  const [query, setQuery] = useState(() => parse(search).q ?? '');\n  const [page, setPage] = useState(() => parse(search).p ?? 0);\n  const onChange = useCallback((e) => setQuery(e.target.value), []);\n  useEffect(() => {\n    setQuery(parse(search).q ?? '');\n    setPage(parse(search).p ?? 0);\n  }, [search]);\n\n  return [query, onChange, setQuery, page];\n}\n\nconst contentTypes = ['/component/post'];\nexport function useUrlSearchQueryFetchResource(size = 1) {\n  const [query, , , page] = useSearchQuery();\n  const [resource, setResource] = useState(neverResource);\n  // https://github.com/facebook/react/issues/14413\n  useEffect(() => {\n    // FYI: A GraphQL query could also be used instead of a direct Elasticsearch\n    setResource(createResource(\n      () => search(\n        createQuery('elasticsearch', {\n          query: {\n            'bool': {\n              'filter': [\n                { 'bool': { 'should': contentTypes.map(id => ({ 'match': { 'content-type': id } })) } },\n                { 'multi_match': { 'query': query, 'type': 'phrase_prefix'} }\n              ]\n            }\n          },\n          size,\n          from: page\n        }),\n        crafterConfig\n      ).pipe(\n        map(({ hits, ...rest }) => {\n          const counted = {};\n          const parsedHits = hits.map(({ _source }) => parseDescriptor(\n            preParseSearchResults(_source)\n          )).filter((content) => {\n            // TODO: Search currently coming with duplicates. Should address at the elastic query level.\n            if (content.craftercms.id in counted) {\n              return false;\n            } else {\n              counted[content.craftercms.id] = true;\n              return true;\n            }\n          });\n          return { ...rest, hits: parsedHits };\n        })\n      ).toPromise()\n    ));\n  }, [query, page, size]);\n  return resource;\n}\n\nexport function useFooter() {\n  const [{ footer, footerLoading }, update] = useGlobalContext();\n  const destroyedRef = useRef(false);\n\n  useEffect(() => {\n    return () => {\n      destroyedRef.current = true;\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!footer && !footerLoading) {\n      update({ footerLoading: true });\n      fetchQuery({\n        text: `\n          query Footer {\n            component_footer {\n              items {\n                guid: objectId\n                path: localId\n                contentTypeId: content__type\n                dateCreated: createdDate_dt\n                dateModified: lastModifiedDate_dt\n                label: internal__name              \n                aboutTitle_s\n                about_t\n                aboutImage_s\n                quickLinksTitle_s\n                socialLinksTitle_s\n                file__name(filter: {matches: \"site-footer.xml\"})\n                internal__name\n                localId\n                quickLinks_o {\n                  item {\n                    label_s\n                    url_s\n                  }\n                }\n                copyright_html_raw\n              }\n            }\n          }\n        `\n      }).then(({ data }) => {\n        (!destroyedRef.current) && update({ footer: parseDescriptor(data.component_footer.items)[0] });\n      });\n    }\n  }, [update, footer, footerLoading]);\n  return footer;\n}\n\n// stores posts in globalContext to avoid multiple calls\nlet useRecentPostsLoading = false;\nexport function useRecentPosts() {\n  const [{ posts }, update] = useGlobalContext();\n  const destroyedRef = useRef(false);\n\n  useEffect(() => {\n    return () => {\n      destroyedRef.current = true;\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!posts && !useRecentPostsLoading) {\n      update({ postsLoading: true });\n      fetchQuery({\n        text: postsQuery\n      }).then(({ data }) => {\n        (!destroyedRef.current) && update({ posts: parseDescriptor(data.posts.items) });\n      });\n    }\n  }, [update, posts]);\n  return posts;\n}\n\nexport function usePosts(paginationData, categories, tags, exclude) {\n  const [posts, setPosts] = useState();\n\n  useEffect(() => {\n    let categoriesFilter = categories\n      ? Array.isArray(categories)\n        ? categories.map(category => ({ matches: category.key }))\n        : [{ matches: categories.key }]\n      : [];\n    let tagsFilter = tags\n      ? Array.isArray(tags)\n        ? tags.map(tag => ({ matches: tag.key }))\n        : [{ matches: tags.key }]\n      : [];\n\n    fetchQuery(\n      { text: postsQuery },\n      {\n        postsLimit: paginationData.itemsPerPage,\n        postsOffset: (paginationData.currentPage * paginationData.itemsPerPage),\n        categoriesFilter,\n        tagsFilter,\n        exclude: exclude??\"\"\n      }\n    ).then(({ data }) => {\n      setPosts({\n        items: parseDescriptor(data.posts.items),\n        total: data.posts.total,\n        pageCount: Math.ceil(data.posts.total/paginationData.itemsPerPage)\n      });\n    });\n  }, [paginationData, categories, tags, exclude]);\n\n  return posts;\n}\n\nexport function useTaxonomiesResource() {\n  const [resource, setResource] = useState(neverResource);\n\n  useEffect(() => {\n    const resource = createResource(\n      () => fetchQuery({\n        text: `\n        query Taxonomies {\n          taxonomy {\n            total\n            items {\n              guid: objectId\n              path: localId\n              contentTypeId: content__type\n              dateCreated: createdDate_dt\n              dateModified: lastModifiedDate_dt\n              label: internal__name\n              items {\n                item {\n                  key\n                  value\n                  image_s\n                }\n              }\n            }\n          }\n        }\n      `\n      })\n    );\n    setResource(resource);\n  }, []);\n  return resource;\n}","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport { siteName } from './shared/utils';\n\nlet graphqlServer = process.env.REACT_APP_GRAPHQL_SERVER;\nif (!graphqlServer.includes(siteName)) {\n  graphqlServer += `?crafterSite=${siteName}`;\n}\n\nexport function fetchQuery(\n  operation,\n  variables\n) {\n  return fetch(graphqlServer, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      query: operation.text,\n      variables\n    })\n  }).then(response => response.json());\n}","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n// language=GraphQL\nconst commonFragments = `\n    fragment PostComponentFragment on component_post {\n        ...ContentItemFieldsFragment\n        slug: localId(transform: \"storeUrlToRenderUrl\")\n        pageTitle_s\n        pageDescription_s\n        blurb_t\n        headline_s\n        mainImage_s\n        content_o {\n            item {\n                key\n                component {\n                    ...on component_rich_text {\n                        ...RichTextComponentFragment\n                    }\n                    ...on component_image {\n                        ...ImageComponentFragment\n                    }\n                    ...on component_responsive_columns {\n                        ...ResponsiveColumnsComponentFragment\n                    }\n                }\n            }\n        }\n        authorBio_o {\n            item {\n                key\n                component {\n                    ...BioComponentFragment\n                }\n            }\n        }\n        categories_o {\n            item {\n                key(filter: {or: $categoriesFilter})\n                value_smv\n            }\n        }\n        tags_o {\n            item {\n                value_smv\n                key(filter: {or: $tagsFilter})\n            }\n        }\n    }\n\n    fragment ContentItemFieldsFragment on ContentItem {\n        guid: objectId\n        path: localId(filter: {not: [{equals: $exclude}]})\n        contentTypeId: content__type\n        dateCreated: createdDate_dt\n        dateModified: lastModifiedDate_dt\n        label: internal__name\n    }\n\n    fragment BioComponentFragment on component_bio {\n        guid: objectId\n        contentTypeId: content__type\n        label: internal__name\n        path: localId\n        bio_t\n        name_s\n        profilePic_s\n        linkButtonText_s\n        linkButtonUrl_s\n        showLinkButton_b\n        facebookLink_s\n        twitterLink_s\n        instagramLink_s\n        youTubeLink_s\n    }\n\n    fragment RichTextComponentFragment on component_rich_text {\n        ...ContentItemFieldsFragment\n        content_html: content_html_raw\n    }\n\n    fragment ImageComponentFragment on component_image {\n        ...ContentItemFieldsFragment\n        image_s\n        alternativeText_s\n    }\n\n    fragment ResponsiveColumnsComponentFragment on component_responsive_columns {\n        ...ContentItemFieldsFragment\n        columns_o {\n            item {\n                columnSize_s\n                content_o {\n                    item {\n                        key\n                        component {\n                            ...on component_rich_text {\n                                ...RichTextComponentFragment\n                            }\n                            ...on component_image {\n                                ...ImageComponentFragment\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n`\n\n// language=GraphQL\nconst main = `\n    ${commonFragments}\n\n    fragment HomepageFragment on page_entry  {\n        pageTitle_s\n        pageDescription_s\n        bios_o {\n            item {\n                key\n                component {\n                    ...BioComponentFragment\n                }\n            }\n        }\n        slider_o {\n            item {\n                key\n                component {\n                    ...ContentItemFieldsFragment\n                    ...on component_slider {\n                        ...SliderComponentFragment\n                    }\n                }\n            }\n        }\n    }\n\n    fragment AboutPageFragment on page_about {\n        pageTitle_s\n        pageDescription_s\n        headline_s\n        bios_o {\n            item {\n                key\n                component {\n                    ...BioComponentFragment\n                }\n            }\n        }\n        content_o {\n            item {\n                key\n                component {\n                    ...on component_rich_text {\n                        ...RichTextComponentFragment\n                    }\n                    ...on component_image {\n                        ...ImageComponentFragment\n                    }\n                    ...on component_responsive_columns {\n                        ...ResponsiveColumnsComponentFragment\n                    }\n                }\n            }\n        }\n    }\n\n    fragment ContactPageFragment on page_contact {\n        pageTitle_s\n        pageDescription_s\n        message_t\n        headline_s\n    }\n\n    fragment CategoryPageFragment on page_category {\n        pageTitle_s\n        pageDescription_s\n    }\n\n    fragment SliderComponentFragment on component_slider {\n        ...ContentItemFieldsFragment\n        posts_o {\n            item {\n                key\n                component {\n                    ...ContentItemFieldsFragment\n                    slug: localId(transform: \"storeUrlToRenderUrl\")\n                    pageTitle_s\n                    pageDescription_s\n                    blurb_t\n                    headline_s\n                    mainImage_s\n                    authorBio_o {\n                        item {\n                            key,\n                            component {\n                                ...BioComponentFragment\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    query byUrlQuery(\n        $url: String\n        $skipContentType: Boolean = true\n        $includePosts: Boolean = true\n        $postsLimit: Int = 8\n        $postsOffset: Int = 0\n        $exclude: String = \"\"\n        $categoriesFilter: [TextFilters!] = []\n        $tagsFilter: [TextFilters!] = []\n    ) {\n        content: contentItems {\n            total\n            items {\n                ...ContentItemFieldsFragment\n                url: localId(\n                    transform: \"storeUrlToRenderUrl\",\n                    filter:{ regex: $url }\n                )\n                content__type(\n                    filter:{\n                        regex: \".*(bio|post|entry|category|contact|about|search).*\"\n                    }\n                ) @skip (if: $skipContentType)\n                ...on page_entry {\n                    ...HomepageFragment\n                }\n                ...on page_about {\n                    ...AboutPageFragment\n                }\n                ...on page_contact {\n                    ...ContactPageFragment\n                }\n                ...on page_category {\n                    ...CategoryPageFragment\n                }\n                ...on component_post {\n                    ...PostComponentFragment\n                }\n            }\n        }\n        levelDescriptors: component_level__descriptor {\n            items {\n                ...ContentItemFieldsFragment\n                siteTitle_s\n                file__name\n                websiteShortname_s\n                socialLinks_o {\n                    item {\n                        socialNetwork_s\n                        label_s\n                        url_s\n                    }\n                }\n            }\n        }\n        posts: component_post(\n            limit: $postsLimit,\n            offset: $postsOffset,\n            sortOrder: DESC,\n            sortBy: \"lastModifiedDate_dt\"\n        ) @include(if: $includePosts) {\n            total\n            items {\n                ...PostComponentFragment\n            }\n        }\n    }\n`;\n\n//language=GraphQL\nexport const postsQuery = `\n    ${commonFragments}\n\n    query postsQuery(\n        $postsLimit: Int = 8\n        $postsOffset: Int = 0\n        $exclude: String = \"\"\n        $categoriesFilter: [TextFilters!] = []\n        $tagsFilter: [TextFilters!] = []\n    ) {\n        posts: component_post(\n            limit: $postsLimit,\n            offset: $postsOffset,\n            sortOrder: DESC,\n            sortBy: \"lastModifiedDate_dt\"\n        ) {\n            total\n            items {\n                ...PostComponentFragment\n            }\n        }\n    }\n`;\n\nexport default main;\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport React from 'react';\n\nexport default function CircularProgressSpinner(props) {\n  const { message, screenHeight = true } = props;\n  return (\n    <div className={`circular-progress-spinner ${screenHeight ? 'circular-progress-spinner__screen-height' : ''}`}>\n      <div className=\"circular-progress-spinner--graphic-container\">\n        <svg className=\"circular-progress-spinner--graphic\">\n          <circle className=\"circular-progress-spinner--path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" strokeWidth=\"2\" strokeMiterlimit=\"10\"/>\n        </svg>\n      </div>\n      {\n        message &&\n        <p className=\"circular-progress-spinner--message\">{message}</p>\n      }\n    </div>\n  );\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport React, { useState } from 'react';\nimport { Link, NavLink } from 'react-router-dom';\nimport { useNavigation } from '../shared/hooks';\nimport SearchForm from '../shared/SearchForm';\nimport { RenderField } from '@craftercms/studio-guest/react';\n\nexport default function Header({ model }) {\n  const nav = useNavigation();\n  const [showMobileMenu, setShowMobileMenu] = useState(false);\n  const toggleNavBar = () => setShowMobileMenu(!showMobileMenu);\n  return (\n    <header role=\"banner\">\n      <div className=\"top-bar\">\n        <div className=\"container\">\n          <div className=\"row\">\n            <RenderField\n              className=\"col-9 social\"\n              model={model}\n              fieldId=\"socialLinks_o\"\n              format={(socialLinks) => socialLinks?.map((link, index) =>\n                <RenderField\n                  component=\"a\"\n                  key={`${link.socialNetwork_s}_${index}`}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  href={link.url_s}\n                  model={model}\n                  fieldId=\"socialLinks_o\"\n                  index={index}\n                  format={(link) => <span className={`fa fa-${link.socialNetwork_s}`} />}\n                />\n              )}\n            />\n            <div className=\"col-3 search-top\">\n              <SearchForm\n                classes={{ form: 'search-top-form' }}\n                placeholder=\"Type keyword to search...\"\n              />\n            </div>\n          </div>\n        </div>\n      </div>\n      <div className=\"container logo-wrap\">\n        <div className=\"row pt-5\">\n          <div className=\"col-12 text-center\">\n            <a\n              className=\"absolute-toggle d-block d-md-none\"\n              data-toggle=\"collapse\"\n              href=\"#navbarMenu\"\n              onClick={toggleNavBar}\n              role=\"button\"\n              aria-expanded=\"false\"\n              aria-controls=\"navbarMenu\"\n            ><span className=\"burger-lines\"/></a>\n            <h1 className=\"site-logo\">\n              <RenderField model={model} fieldId=\"siteTitle_s\" component={Link} to=\"/\" />\n            </h1>\n          </div>\n        </div>\n      </div>\n      <nav className=\"navbar navbar-expand-md navbar-light bg-light\">\n        <div className=\"container\">\n          <div className={`collapse navbar-collapse ${showMobileMenu ? 'show' : ''}`} id=\"navbarMenu\">\n            <ul className=\"navbar-nav mx-auto\">\n              {\n                nav?.sort(\n                  (\n                    { orderDefault_f: a },\n                    { orderDefault_f: b }\n                  ) => (a < b) ? -1 : ((a > b) ? 1 : 0)\n                ).map((page) =>\n                  <li className=\"nav-item\" key={page.url}>\n                    <NavLink\n                      exact\n                      className=\"nav-link\"\n                      activeClassName=\"active\"\n                      to={page.url}\n                    >\n                      {page.navLabel}\n                    </NavLink>\n                  </li>\n                )\n              }\n            </ul>\n          </div>\n        </div>\n      </nav>\n    </header>\n  );\n}\n","/*\n * Copyright (C) 2007-2020 Crafter Software Corporation. All Rights Reserved.\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License version 3 as published by\n * the Free Software Foundation.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport React from 'react';\nimport { Link } from 'react-router-dom';\nimport { useFooter } from '../shared/hooks';\nimport { Field, RenderField } from '@craftercms/studio-guest/react';\n\nexport default function Footer({ model }) {\n  const footer = useFooter();\n  return (\n    <>\n      {\n        footer &&\n        <Field\n          model={footer}\n          className='site-footer'\n        >\n          <div className=\"container\">\n            <div className=\"row mb-5\">\n              <div className=\"col-md-4\">\n                <RenderField component=\"h3\" model={footer} fieldId=\"aboutTitle_s\" />\n                <p className=\"mb-4\">\n                  <RenderField\n                    component=\"img\"\n                    model={footer}\n                    renderTarget=\"src\"\n                    fieldId=\"aboutImage_s\"\n                    alt=\"\"\n                    className=\"img-fluid\"\n                  />\n                </p>\n                <RenderField component=\"p\" model={footer} fieldId=\"about_t\" />\n              </div>\n              <div className=\"col-md-6 ml-auto\">\n                <div className=\"row\">\n                  <div className=\"col-md-6\">\n                    <RenderField component=\"h3\" model={footer} fieldId=\"quickLinksTitle_s\" />\n                    <RenderField\n                      component=\"ul\"\n                      className=\"list-unstyled\"\n                      model={footer}\n                      fieldId=\"quickLinks_o\"\n                      format={(quickLinks_o) => quickLinks_o.map((link, i) =>\n                        <Field\n                          key={i}\n                          component=\"li\"\n                          model={footer}\n                          fieldId=\"quickLinks_o\"\n                          index={i}\n                        >\n                          <RenderField\n                            component={Link}\n                            model={footer}\n                            fieldId=\"quickLinks_o.label_s,quickLinks_o.url_s\"\n                            index={i}\n                            renderTarget=\"children,to\"\n                          />\n                        </Field>\n                      )}\n                    />\n                  </div>\n                  <div className=\"col-md-1\"/>\n                  <div className=\"col-md-5\">\n                    <div className=\"mb-5\">\n                      <RenderField component=\"h3\" model={footer} fieldId=\"socialLinksTitle_s\" />\n                      <RenderField\n                        component=\"ul\"\n                        className=\"list-unstyled footer-social\"\n                        model={model}\n                        fieldId=\"socialLinks_o\"\n                        format={(socialLinks) => socialLinks?.map((link, index) =>\n                          <RenderField\n                            component=\"li\"\n                            key={link.socialNetwork_s}\n                            model={model}\n                            fieldId=\"socialLinks_o\"\n                            index={index}\n                            format={(link) =>\n                              <a href={link.url_s} target=\"_blank\" rel=\"noopener noreferrer\">\n                                <span className={`fa fa-${link.socialNetwork_s}`}/> {link.label_s}\n                              </a>\n                            }\n                          />\n                        )}\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div className=\"row\">\n              <div\n                className=\"col-md-12 text-center\"\n                dangerouslySetInnerHTML={{ __html: footer.copyright_html_raw }}\n              />\n            </div>\n          </div>\n        </Field>\n      }\n    </>\n  );\n}\n"],"sourceRoot":""}